---
title: "Neonate Data Analysis Colorado 2022"
author: "Robin Bedard & Savannah Weaver"
output: 
  rmdformats::html_clean:
    highlight: tango
    thumbnails: FALSE
    toc: TRUE
    toc_depth: 3
---




# Packages



```{r, include=FALSE}
knitr::opts_chunk$set(include = TRUE, message = FALSE, warning = FALSE)
```


```{r}
library("tidyverse") # for dplyr workflow + ggplot
library("rmdformats") # pretty Rmd format
library("lme4") # LMM
library("lmerTest") # LMM stats
library("emmeans") # pairwise comparisons
library("broom") # clean stats presentation
library("AICcmodavg") # model selection
library("MuMIn") # GLMM R-squared
library("effects") # partial regression plots
library("ggpubr") # figure arranging & exporting
```



# Fig Theme

```{r}
my_ggplot_theme <- theme_classic() + # start with a preset theme to make things easy
                     theme(axis.title = element_text(size = 10), # text size for axis labels
                           axis.text = element_text(size = 8, # text size for axis values
                                                    color = "black", # need to specifically set color
                                                    family = "sans"), # and family
                           legend.title = element_text(size = 8), # text size for the legend title
                           legend.text = element_text(size = 8), # text size for legend items
                           text = element_text(color = "black", # color for all text (except axis values)
                                               family = "sans") # family
                           )
```

Now, apply the theme. This sets the theme for the entire Rmd document.

```{r}
theme_set(my_ggplot_theme)
```


# Acronyms

DAB = day after birth
PS = post-shed / 1 week after birth




# Load & Tidy Data

## DAB osmolality

This is the osmolality of each individual neonate the day after birth. 

```{r}
neonate_dab_osmol <- read_rds("data/neonate_DAB_osmolality.RDS")
head(neonate_dab_osmol)
```


## DAB body size

This is the body size and body temperature at time of CEWL measurements for each individual neonate. 

```{r}
neonate_dab_all0 <- read_rds("data/neonate_DAB_body_size.RDS")

neonate_dab_all <- neonate_dab_all0 %>% 
  # fix a typo of where the decimal was put
  mutate(SVL_cm = case_when(SVL_cm == 2.4 ~ SVL_cm*10, TRUE ~ SVL_cm)) %>% 
  rename(Date_Born_Shed = Date_Born) %>% 
  mutate(timept = "DAB")

# robin removed this one...
#neonate_dab_all[77, ]

summary(neonate_dab_all)
```



## PS lumped

```{r}
neonate_postshed <- read_rds("data/neonate_PS_all_data.RDS")
```


## PS osmolality

first, separate out and get mean osmolality per individual

```{r}
postshed_osmol <- neonate_postshed %>% 
  select(CEWL_Blood_Collect_Date, Indiv_ID, 
         Plasma_Osmol_Rep1, Plasma_Osmol_Rep2, 
         Plasma_Osmol_Rep3, Plasma_Osmol_Rep4) %>% 
  pivot_longer(3:6, names_to = "rep", values_to = "osml") %>% 
  filter(complete.cases(osml)) %>% 
  group_by(CEWL_Blood_Collect_Date, Indiv_ID) %>% 
  summarise(Plasma_Osmol_Rep_mean = mean(osml))

head(postshed_osmol)
```


## PS body size

```{r}
neonate_postshed_clean <- neonate_postshed %>% 
  select(Indiv_ID, Date_Born_Shed = Date_Shed,
         CEWL_Blood_Collect_Date, 
         Tail_Length_cm, SVL_cm, Tail_SVL_Ratio, 
         Mass_g, Sex, Pee, Tb_CEWL_c, 
         Mother_ID, Treatment) %>% 
  mutate(timept = "PS") %>% 
  # fix a typo
  mutate(Treatment = case_when(Mother_ID == 128 ~ "W", TRUE ~ Treatment)) %>% 
  mutate(Treatment = factor(Treatment))
summary(neonate_postshed_clean)
```









## CEWL

```{r}
all_data_CEWL0 <- read_rds("data/CEWL_data_all.RDS")

all_data_CEWL <- all_data_CEWL0 %>% 
  rename(CEWL_Blood_Collect_Date = date)

summary(all_data_CEWL)
```


## Mother Data!

```{r}
mother_values <- read_rds("data/mother_values.RDS")
neo_counts <- read_csv("data/neonate_count.csv", 
                       col_types = "fddd") %>% 
  mutate(
    total_embryos = (live_neonates+dead_at_birth+slugs),
    prop_live = live_neonates/total_embryos
  )

summary(neo_counts)

neo_counts %>% 
  filter(slugs > 0 | dead_at_birth > 0)

neo_counts %>% 
  filter(slugs > 0 | dead_at_birth > 0) %>% 
  summary()
```








# Join/Arrange Dataframes


## DAB 

All DAB:
*missing CEWL for neonate 332*
```{r}
dab_all <- neonate_dab_all %>% 
  left_join(neonate_dab_osmol, 
            by = c('Indiv_ID', 'CEWL_Blood_Collect_Date')) %>% 
  left_join(all_data_CEWL, 
            by = c('Indiv_ID', 'CEWL_Blood_Collect_Date')) %>% 
  # remove one erroneous point
  filter(Plasma_Osmol_Rep_mean < 400) %>% 
  left_join(mother_values, by = "Mother_ID") %>% 
  left_join(neo_counts, by = "Mother_ID") 

summary(dab_all)
```




## PS

All PS:

```{r}
ps_all <- neonate_postshed_clean %>% 
  left_join(postshed_osmol,
            by = c('Indiv_ID', 'CEWL_Blood_Collect_Date')) %>% 
  left_join(all_data_CEWL, 
            by = c('Indiv_ID', 'CEWL_Blood_Collect_Date'))

ps_all_mother <- ps_all %>% 
  left_join(mother_values, by = "Mother_ID")
```


## B vs P

subset of neonates/clutches with measurements at BOTH time points:

```{r}
dab_ps_compare <- dab_all %>% 
  # only keep clutches with post-shed msmts
  filter(Mother_ID %in% ps_all$Mother_ID) %>%
  # remove some cols that do not have matches in ps data
  select(-prop_live, -total_embryos, -slugs, -dead_at_birth, -live_neonates, -Mother_Days_in_Treatment, -Mother_osml, -Mother_SVL, -Mother_mass, -Mother_CEWL) %>% 
  # add those post-shed data
  rbind(ps_all) %>% 
  # formatting
  mutate(timept = factor(timept))

summary(dab_ps_compare)
```




# Clutch Avgs

Get min/max, sd, and mean per clutch per variable. 


## DAB Proportions

```{r}
dab_all_props <- dab_all %>% 
  #group_by(Mother_ID, Treatment, timept, Sex) %>%
  #count() %>% 
  group_by(Mother_ID, Treatment, timept) %>%
  summarise(
    n_neonates = n(), # number MEASURED, not n birthed
    Prop_Pee = sum(Pee == "Y")/n_neonates,
    Prop_F = sum(Sex == "F")/n_neonates
  )

summary(dab_all_props)
```



## DAB Means

```{r}
dab_all_clutch_avg <- dab_all %>% 
  group_by(Mother_ID, Treatment, timept) %>%
  mutate(n = n()) %>% 
  group_by(Mother_ID, Treatment, timept, n) %>% 
  summarise_at(
    vars(Tail_Length_cm, SVL_cm, Mass_g, Tb_CEWL_c, 
         Plasma_Osmol_Rep_mean, CEWL_g_m2h, 
         msmt_temp_C, msmt_RH_percent, VPD_kPa), 
    list(mean = mean, sd = sd, min = min, max = max),
    na.rm = T
  )

length(unique(dab_all_clutch_avg$Mother_ID)) == nrow(dab_all_clutch_avg)

summary(dab_all_clutch_avg)
```


## Add Mother Data!

```{r}
dab_clutch_mom <- dab_all_clutch_avg %>% 
  left_join(mother_values, by = "Mother_ID") %>% 
  left_join(dab_all_props, by = c("Mother_ID", "Treatment", "timept")) %>% 
  left_join(neo_counts, by = "Mother_ID") %>% 
  mutate(Mother_mass_kg = Mother_mass/1000)

summary(dab_clutch_mom)
```






## PS Means

```{r}
ps_all_clutch_avg <- ps_all %>% 
  group_by(Mother_ID, Treatment, timept) %>%
  mutate(n = n()) %>% 
  group_by(Mother_ID, Treatment, timept, n) %>% 
  summarise_at(
    vars(Tail_Length_cm, SVL_cm, Mass_g, Tb_CEWL_c, 
         Plasma_Osmol_Rep_mean, CEWL_g_m2h, 
         msmt_temp_C, msmt_RH_percent, VPD_kPa), 
    list(mean = mean, sd = sd, min = min, max = max),
    na.rm = T
  )

length(unique(ps_all_clutch_avg$Mother_ID)) == nrow(ps_all_clutch_avg)
```


## B vs P

```{r}
dab_ps_compare_means <- dab_all_clutch_avg %>% 
  # only keep clutches with post-shed msmts
  filter(Mother_ID %in% ps_all$Mother_ID) %>%
  # add those post-shed data
  rbind(ps_all_clutch_avg) %>% 
  # formatting
  mutate(timept = factor(timept))

summary(dab_ps_compare_means)
```








# Exp Info

```{r}
dab_ps_compare %>% 
  group_by(Mother_ID) %>% 
  summarise(
    min_date = min(CEWL_Blood_Collect_Date),
    max_date = max(CEWL_Blood_Collect_Date)
  ) %>% 
  mutate(range = max_date - min_date) %>% 
  arrange(range)

dab_ps_compare %>% 
  summarise(
    min_date = min(CEWL_Blood_Collect_Date),
    max_date = max(CEWL_Blood_Collect_Date)
  ) %>% 
  mutate(range = max_date - min_date)
```







# Test Repro Output


```{r}
summary(lm(data = dab_clutch_mom, Prop_Pee~Treatment))
summary(lm(data = dab_clutch_mom, Prop_F~Treatment))
summary(lm(data = dab_clutch_mom, live_neonates~Treatment))
summary(lm(data = dab_clutch_mom, dead_at_birth~Treatment))
summary(lm(data = dab_clutch_mom, slugs~Treatment))
summary(lm(data = dab_clutch_mom, total_embryos~Treatment))
```

```{r}
still_neo_mom_mass_lm <- lm(data = dab_clutch_mom, 
                  dead_at_birth ~ Treatment * Mother_mass)
car::Anova(still_neo_mom_mass_lm, type = "2", test = "F")

slug_mom_mass_lm <- lm(data = dab_clutch_mom, 
                  slugs ~ Treatment * Mother_mass)
car::Anova(slug_mom_mass_lm, type = "2", test = "F")
```




## Live ~ Tmt * Mass


```{r}
live_neo_mom_mass_lm <- lm(data = dab_clutch_mom, 
                  live_neonates ~ Treatment * Mother_mass)

summary(live_neo_mom_mass_lm)
car::Anova(live_neo_mom_mass_lm, type = "2", test = "F")
```


```{r}
emt <- emtrends(live_neo_mom_mass_lm, "Treatment", var = "Mother_mass")
tidy(emt)
pairs(emt)
```


```{r}
0.025922949*100 # change in mother grams
0.001812418*100
```




## Plot


```{r}
plot(effect("Treatment:Mother_mass", live_neo_mom_mass_lm), multiline = T)
```



```{r}
ggplot(
  dab_clutch_mom,
  aes(x = Mother_mass, y = live_neonates, color = Treatment)
) +
  geom_point() +
  geom_text(
    aes(label = Mother_ID),
    nudge_x = 0.25, nudge_y = 0.25, 
    check_overlap = T, show.legend = F
  ) +
  geom_smooth(
    method = "lm",
    se = F,
    formula = 'y~x'
  )
neo_counts %>% 
  filter(slugs > 0 | dead_at_birth > 0)
```























```{r}
prop_live_mom_mass_lm <- lm(data = dab_clutch_mom, 
                  prop_live ~ Treatment * Mother_mass)
summary(prop_live_mom_mass_lm)
car::Anova(prop_live_mom_mass_lm, type = "2", test = "F")
```





## Live ~ SVL

```{r}
live_neo_mom_SVL_lm <- lm(data = dab_clutch_mom, 
                  live_neonates ~ Mother_SVL)
summary(live_neo_mom_SVL_lm)
car::Anova(live_neo_mom_SVL_lm, type = "2", test = "F")
```

```{r}
prop_live_mom_SVL_lm <- lm(data = dab_clutch_mom, 
                  prop_live ~ Mother_SVL)
summary(prop_live_mom_SVL_lm)
car::Anova(prop_live_mom_SVL_lm, type = "2", test = "F")
```



```{r}
dab_clutch_mom %>% 
  group_by(Treatment, slugs, dead_at_birth) %>% 
  count()
```





# DAB CEWL clutch ~ mother

*this is what was done originally, but we now use all neonate data and do not avg by clutch*

```{r}
DAB_CEWL_LM_1 <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 
                      Treatment *
                      Mother_CEWL +
                      Tb_CEWL_c_mean +
                      msmt_temp_C_mean +
                      msmt_RH_percent_mean + 
                      VPD_kPa_mean)
                     
car::vif(DAB_CEWL_LM_1, type = "predictor")
drop1(DAB_CEWL_LM_1)
car::Anova(DAB_CEWL_LM_1, type = "2")
```

The first variable to drop from the model is humidity. 

```{r}
DAB_CEWL_LM_2 <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 
                      Treatment *
                      Mother_CEWL +
                      Tb_CEWL_c_mean +
                      msmt_temp_C_mean +
                      VPD_kPa_mean)
                     
car::vif(DAB_CEWL_LM_2, type = "predictor")
drop1(DAB_CEWL_LM_2)
car::Anova(DAB_CEWL_LM_2, type = "2")
```


```{r}
DAB_CEWL_LM_3 <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 
                      Treatment *
                      Mother_CEWL +
                      Tb_CEWL_c_mean +
                      msmt_temp_C_mean)
                     
drop1(DAB_CEWL_LM_3)
car::Anova(DAB_CEWL_LM_3, type = "2")
```



```{r}
DAB_CEWL_LM_4 <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 
                      Treatment *
                      Mother_CEWL +
                      Tb_CEWL_c_mean)
                     
drop1(DAB_CEWL_LM_4)
car::Anova(DAB_CEWL_LM_4, type = "2")
```



```{r}
DAB_CEWL_LM_5 <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 
                      Treatment +
                      Mother_CEWL +
                      Tb_CEWL_c_mean)
                     
drop1(DAB_CEWL_LM_5)
car::Anova(DAB_CEWL_LM_5, type = "2")
```



```{r}
DAB_CEWL_LM_6 <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 
                      Mother_CEWL +
                      Tb_CEWL_c_mean)

drop1(DAB_CEWL_LM_6)
car::Anova(DAB_CEWL_LM_6, type = "2")
```


```{r}
DAB_CEWL_LM_7 <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 
                      Mother_CEWL)

car::Anova(DAB_CEWL_LM_7, type = "2")
```



Null model 
```{r}
DAB_CEWL_LM_null <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 1)
```



## Model Selection

```{r}
clutch_cewl_models_all <- list(DAB_CEWL_LM_2, 
                               DAB_CEWL_LM_3, 
                               DAB_CEWL_LM_4, 
                               DAB_CEWL_LM_5, 
                               DAB_CEWL_LM_6, 
                               DAB_CEWL_LM_7, 
                               DAB_CEWL_LM_null)

#specify model names
clutch_cewl_mod_names_all <- c('model2', 'model3',
                               'model4', 'model5',
                               'model6', 'model7',
                               'modelnull')

#calculate AIC of each model
clutch_cewl_AICc_all <- data.frame(aictab(cand.set = clutch_cewl_models_all, 
                                 modnames = clutch_cewl_mod_names_all))
clutch_cewl_AICc_all
```

So the top three equivalent models are 7, 6, & 5. 6/7 are almost exactly the same, with 5 trailing a bit behind.

Model 7 is clutch avg CEWL ~ mother CEWL. Model 6 adds clutch average body temperature at the time of measurement. Model 5 adds Tb and mother's treatment. However, Tb and mother's treatment did not have significant effects.


## Final Model

```{r}
DAB_CEWL_LM_BEST <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 
                      Mother_CEWL)

car::Anova(DAB_CEWL_LM_BEST, type = "2")
summary(DAB_CEWL_LM_BEST)
```


## Model Assumptions

Check linear regression assumptions/conditions:

```{r}
plot(DAB_CEWL_LM_BEST)
shapiro.test(residuals(DAB_CEWL_LM_BEST))
```









# Check Tb

```{r}
Tb_Ta_lm <- lm(data = dab_all, Tb_CEWL_c ~ msmt_temp_C)
summary(Tb_Ta_lm)
```


```{r}
DAB_Tb <- lmerTest::lmer(data = dab_all,
                      Tb_CEWL_c ~ 
                      Treatment +
                        (1|Mother_ID))
                     
anova(DAB_Tb, test = "F", type = "2")
emmeans(DAB_Tb, pairwise ~ Treatment)
```






# CEWL ~ osml

```{r}
CEWL_osml_lm <- lm(data = dab_all, CEWL_g_m2h ~ Plasma_Osmol_Rep_mean)
summary(CEWL_osml_lm)
CEWL_osml_lm2 <- lm(data = ps_all, CEWL_g_m2h ~ Plasma_Osmol_Rep_mean)
summary(CEWL_osml_lm2)
```






# DAB CEWL DIFFS


```{r}
DAB_CEWL_LMM_0 <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                      Treatment *
                      Mother_CEWL +
                      Tb_CEWL_c +
                      msmt_temp_C +
                      msmt_RH_percent +
                      VPD_kPa +
                        (1|Mother_ID))
                     
car::vif(DAB_CEWL_LMM_0)
drop1(DAB_CEWL_LMM_0)
anova(DAB_CEWL_LMM_0, test = "F", type = "2")
```


```{r}
DAB_CEWL_LMM_1 <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                      Treatment +
                      Mother_CEWL +
                      Tb_CEWL_c +
                      msmt_temp_C +
                      msmt_RH_percent +
                      VPD_kPa +
                        (1|Mother_ID))
DAB_CEWL_LMM_11 <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                      Treatment *
                      Mother_CEWL +
                      Tb_CEWL_c +
                      msmt_temp_C +
                      VPD_kPa +
                        (1|Mother_ID))
                     
car::vif(DAB_CEWL_LMM_1)
car::vif(DAB_CEWL_LMM_11)
drop1(DAB_CEWL_LMM_11)
```


## start good models 

(good = no collinearity)

```{r}
DAB_CEWL_LMM_1a <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                      Treatment + Mother_CEWL +
                      Tb_CEWL_c +
                      msmt_temp_C + # remove RH to fix multicollinearity
                      VPD_kPa +
                        (1|Mother_ID))
                     
car::vif(DAB_CEWL_LMM_1a)
drop1(DAB_CEWL_LMM_1a)
anova(DAB_CEWL_LMM_1a, test = "F", type = "2")
```




```{r}
DAB_CEWL_LMM_2 <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                        Treatment + Mother_CEWL +
                      Tb_CEWL_c +
                      msmt_temp_C +
                        (1|Mother_ID))

DAB_CEWL_LMM_2v <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                        Treatment + Mother_CEWL +
                      Tb_CEWL_c +
                      VPD_kPa +
                        (1|Mother_ID))
                     
summary(DAB_CEWL_LMM_2v)
drop1(DAB_CEWL_LMM_2)
anova(DAB_CEWL_LMM_2, test = "F", type = "2")
```


```{r}
DAB_CEWL_LMM_3 <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                        Treatment + Mother_CEWL +
                      Tb_CEWL_c +
                        (1|Mother_ID))

DAB_CEWL_LMM_3int <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                        Treatment * Mother_CEWL +
                      Tb_CEWL_c +
                        (1|Mother_ID))
                     
summary(DAB_CEWL_LMM_3)
drop1(DAB_CEWL_LMM_3)
anova(DAB_CEWL_LMM_3, test = "F", type = "2")
```

```{r}
DAB_CEWL_LMM_4 <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                        Mother_CEWL +
                      Tb_CEWL_c +
                        (1|Mother_ID))
                     
summary(DAB_CEWL_LMM_4)
drop1(DAB_CEWL_LMM_4)
anova(DAB_CEWL_LMM_4, test = "F", type = "2")
```


```{r}
DAB_CEWL_LMM_5 <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                        Mother_CEWL +
                        (1|Mother_ID))
                     
summary(DAB_CEWL_LMM_5)
anova(DAB_CEWL_LMM_5, test = "F", type = "2")
```

```{r}
DAB_CEWL_LMM_NULL <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 1 + (1|Mother_ID))
```



## Model Selection

```{r}
cewl_models_all <- list(DAB_CEWL_LMM_1a, DAB_CEWL_LMM_2, DAB_CEWL_LMM_2v,
                        DAB_CEWL_LMM_3, DAB_CEWL_LMM_4, DAB_CEWL_LMM_5,
                        DAB_CEWL_LMM_NULL)

#specify model names
cewl_mod_names_all <- c('model1', 
                    'model2', 'model2 VPD', 
                    'model3',
                    'model4',
                    'model5',
                    'modelnull')

#calculate AIC of each model
cewl_AICc_all <- data.frame(aictab(cand.set = cewl_models_all, 
                                 modnames = cewl_mod_names_all))
cewl_AICc_all
```


Okay! after some additional investigations, it seems like the model needs to include VPD.

DAB_CEWL_LMM_2v <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                        Treatment + Mother_CEWL +
                      Tb_CEWL_c +
                      VPD_kPa +
                        (1|Mother_ID))




## Final Model + emmeans

```{r}
DAB_CEWL_LMM_BEST_simple <- lmerTest::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                        Treatment +
                        Mother_CEWL +
                        Tb_CEWL_c +
                        VPD_kPa +
                          (1|Mother_ID))

summary(DAB_CEWL_LMM_BEST_simple)
anova(DAB_CEWL_LMM_BEST_simple, test = "F", type = "2")
r.squaredGLMM(DAB_CEWL_LMM_BEST_simple)
emmeans(DAB_CEWL_LMM_BEST_simple, pairwise ~ Treatment)
DAB_CEWL_emmeans <- emmeans(DAB_CEWL_LMM_BEST_simple, "Treatment")
DAB_CEWL_emmeans_CI <- tidy(confint(DAB_CEWL_emmeans))
```



```{r}
DAB_CEWL_LMM_BEST_full <- lmerTest::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                      Treatment +
                      Mother_CEWL +
                      Tb_CEWL_c +
                      msmt_temp_C +
                      VPD_kPa +
                        (1|Mother_ID))

summary(DAB_CEWL_LMM_BEST_full)
r.squaredGLMM(DAB_CEWL_LMM_BEST_full)
anova(DAB_CEWL_LMM_BEST_full, test = "F", type = "2")
```


## Model Assumptions

```{r}
plot(DAB_CEWL_LMM_BEST_simple)
shapiro.test(residuals(DAB_CEWL_LMM_BEST_simple))
```

looks fine, but not great




## Partial Regression


```{r}
plot(effect("Mother_CEWL", DAB_CEWL_LMM_BEST_simple))
plot(effect("Tb_CEWL_c", DAB_CEWL_LMM_BEST_simple))
plot(effect("VPD_kPa", DAB_CEWL_LMM_BEST_simple))
plot(effect("Treatment", DAB_CEWL_LMM_BEST_simple))
```


```{r}
mother_effects_data <- summary(effect("Mother_CEWL",
                              DAB_CEWL_LMM_BEST_simple))
mother_effects_df <- data_frame(
  meanval = mother_effects_data$effect,
  lowCI = mother_effects_data$lower,
  highCI = mother_effects_data$upper
) %>% 
  mutate(Mother_CEWL = c(10, 15, 19, 23, 28))

mother_effects_df
```


```{r}
Tb_effects_data <- summary(effect("Tb_CEWL_c",
                        DAB_CEWL_LMM_BEST_simple))
Tb_effects_df <- data_frame(
  meanval = Tb_effects_data$effect,
  lowCI = Tb_effects_data$lower,
  highCI = Tb_effects_data$upper
) %>% 
  mutate(Tb_CEWL_c = c(26, 27, 29, 30, 31))

Tb_effects_df
```



```{r}
VPD_effects_data <- summary(effect("VPD_kPa",
                        DAB_CEWL_LMM_BEST_simple))
VPD_effects_df <- data_frame(
  meanval = VPD_effects_data$effect,
  lowCI = VPD_effects_data$lower,
  highCI = VPD_effects_data$upper
) %>% 
  mutate(VPD_kPa = c(1.6, 1.8, 1.9, 2.1, 2.3))

VPD_effects_df
```







## Check PS

```{r}
PS_CEWL_LMM_mother_simp <- lmerTest::lmer(data = ps_all_mother,
                      CEWL_g_m2h ~ 
                        Mother_CEWL +
                          (1|Mother_ID))


summary(PS_CEWL_LMM_mother_simp)
anova(PS_CEWL_LMM_mother_simp, test = "F", type = "2")
```



```{r}
PS_CEWL_LMM_mother <- lmerTest::lmer(data = ps_all_mother,
                      CEWL_g_m2h ~ 
                        Treatment +
                        Mother_CEWL +
                        Tb_CEWL_c +
                        VPD_kPa +
                          (1|Mother_ID))


summary(PS_CEWL_LMM_mother)
anova(PS_CEWL_LMM_mother, test = "F", type = "2")
r.squaredGLMM(PS_CEWL_LMM_mother)
emmeans(PS_CEWL_LMM_mother, pairwise ~ Treatment)
```


```{r}
PS_CEWL_LMM_mother2 <- lme4::lmer(data = ps_all_mother,
                      CEWL_g_m2h ~ 
                        Treatment +
                        Mother_CEWL +
                        Tb_CEWL_c +
                        VPD_kPa +
                          (1|Mother_ID))
drop1(PS_CEWL_LMM_mother2)
```

```{r}
PS_CEWL_LMM_mother3 <- lme4::lmer(data = ps_all_mother,
                      CEWL_g_m2h ~ 
                        Treatment +
                        Mother_CEWL +
                        VPD_kPa +
                          (1|Mother_ID))
drop1(PS_CEWL_LMM_mother3)
anova(PS_CEWL_LMM_mother3)
```














# PUB FIG



## CEWL CLUTCH ~ MOTHER



```{r}
ggplot(
  dab_clutch_mom,
  aes(
    x = Mother_CEWL,
    y = CEWL_g_m2h_mean
  )
) +
  geom_abline(
    slope = 1, intercept = 0, 
    linetype = "dashed", color = "darkgrey"
  ) +
  geom_pointrange(
    aes(ymin = CEWL_g_m2h_mean-CEWL_g_m2h_sd,
        ymax = CEWL_g_m2h_mean+CEWL_g_m2h_sd,
        color = Treatment, shape = Treatment),
    #color = "springgreen3",
    alpha = 0.6, size = 0.2, linewidth = 0.3
  ) +
  geom_point(aes(color = Treatment, shape = Treatment)) +
  geom_smooth(
    se = F,
    formula = 'y~x',
    method = "lm",
    color = "black",
    linewidth = 1
  ) +
  scale_x_continuous(
    limits = c(0, 30),
    breaks = c(0, 10, 20, 30),
    name = expression('Mother CEWL (g '*m^-2*' '*h^-1*')')
  ) +
  scale_y_continuous(
    limits = c(0, 21),
    breaks = c(0, 10, 20),
    name = expression('Neonate CEWL (g '*m^-2*' '*h^-1*')')
  ) -> neo_mom_CEWL
neo_mom_CEWL
```





## partreg CEWL~MOM


```{r}
ggplot() +
  geom_abline(
    slope = 1, intercept = 0, 
    linetype = "dashed", color = "darkgrey"
  ) +
  geom_pointrange(
    data = dab_clutch_mom,
  aes(
    x = Mother_CEWL,
    y = CEWL_g_m2h_mean,
    ymin = CEWL_g_m2h_mean-CEWL_g_m2h_sd,
    ymax = CEWL_g_m2h_mean+CEWL_g_m2h_sd,
    color = Treatment, shape = Treatment),
  alpha = 0.6, size = 0.2, linewidth = 0.3, show.legend = FALSE
  ) +
  geom_point(
    data = dab_clutch_mom,
  aes(
    x = Mother_CEWL,
    y = CEWL_g_m2h_mean,
    color = Treatment, shape = Treatment
  )) +
  
  geom_ribbon(
    data = mother_effects_df,
    aes(x = Mother_CEWL, ymin = lowCI, ymax = highCI),
    alpha = 0.2
  ) +
  geom_line(
    data = mother_effects_df,
    aes(x = Mother_CEWL, y = meanval),
    color = "black",
    linewidth = 1
  ) +
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  theme(
    legend.position = "inside",
    legend.position.inside = c(0.75, 0.15),
    legend.background = element_blank()
  ) +
  # annotate(
  #   geom = "text", label = expression(''*R^2*'=0.5'),
  #   x = 2, y = 13, size = 3
  # ) +
  scale_x_continuous(
    limits = c(0, 30),
    breaks = c(0, 10, 20, 30),
    name = expression('Mother CEWL (g '*m^-2*' '*h^-1*')')
  ) +
  scale_y_continuous(
    limits = c(0, 21),
    breaks = c(0, 10, 20),
    name = expression('Neonate CEWL (g '*m^-2*' '*h^-1*')')
  ) -> neo_mom_CEWL_partreg
neo_mom_CEWL_partreg
```


export it:

```{r}
ggsave(
  filename = "Fig5_neonate_mother_CEWL.pdf",
  plot = neo_mom_CEWL_partreg,
  path = "./results_figures",
  device = "pdf",
  dpi = 600,
  units = "mm",
  width = 150,
  height = 100
)
ggsave(
  filename = "Fig5_neonate_mother_CEWL.tiff",
  plot = neo_mom_CEWL_partreg,
  path = "./results_figures",
  device = "tiff",
  dpi = 600,
  units = "mm",
  width = 150,
  height = 100
)
```











## partreg CEWL~Tb


```{r}
ggplot() +
  geom_pointrange(
    data = dab_clutch_mom,
  aes(
    x = Tb_CEWL_c_mean,
    y = CEWL_g_m2h_mean,
    ymin = CEWL_g_m2h_mean-CEWL_g_m2h_sd,
    ymax = CEWL_g_m2h_mean+CEWL_g_m2h_sd,
    color = Treatment, shape = Treatment),
  alpha = 0.6, size = 0.2, linewidth = 0.3
  ) +
  geom_point(
    data = dab_clutch_mom,
  aes(
    x = Tb_CEWL_c_mean,
    y = CEWL_g_m2h_mean,
    color = Treatment, shape = Treatment
  )) +
  
  geom_ribbon(
    data = Tb_effects_df,
    aes(x = Tb_CEWL_c, ymin = lowCI, ymax = highCI),
    alpha = 0.2
  ) +
  geom_line(
    data = Tb_effects_df,
    aes(x = Tb_CEWL_c, y = meanval),
    color = "black",
    linewidth = 1
  ) +
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  theme(
    legend.position = "inside",
    legend.position.inside = c(0.1, 0.1),
    legend.background = element_blank()
  ) +
  # scale_x_continuous(
  #   limits = c(26, 30),
  #   breaks = c(0, 10, 20, 30),
  #   name = expression('Mother CEWL (g '*m^-2*' '*h^-1*')')
  # ) +
  scale_y_continuous(
    #limits = c(0, 21),
    breaks = c(0, 10, 20),
    name = expression('Neonate CEWL (g '*m^-2*' '*h^-1*')')
  ) -> neo_Tb_CEWL_partreg
neo_Tb_CEWL_partreg
```








## partreg CEWL~VPD


```{r}
ggplot() +
  geom_pointrange(
    data = dab_clutch_mom,
  aes(
    x = VPD_kPa_mean,
    y = CEWL_g_m2h_mean,
    ymin = CEWL_g_m2h_mean-CEWL_g_m2h_sd,
    ymax = CEWL_g_m2h_mean+CEWL_g_m2h_sd,
    color = Treatment, shape = Treatment),
  alpha = 0.6, size = 0.2, linewidth = 0.3
  ) +
  geom_point(
    data = dab_clutch_mom,
  aes(
    x = VPD_kPa_mean,
    y = CEWL_g_m2h_mean,
    color = Treatment, shape = Treatment
  )) +
  
  geom_ribbon(
    data = VPD_effects_df,
    aes(x = VPD_kPa, ymin = lowCI, ymax = highCI),
    alpha = 0.2
  ) +
  geom_line(
    data = VPD_effects_df,
    aes(x = VPD_kPa, y = meanval),
    color = "black",
    linewidth = 1
  ) +
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  theme(
    legend.position = "inside",
    legend.position.inside = c(0.1, 0.1),
    legend.background = element_blank()
  ) +
  # scale_x_continuous(
  #   limits = c(0, 30),
  #   breaks = c(0, 10, 20, 30),
  #   name = expression('Mother CEWL (g '*m^-2*' '*h^-1*')')
  # ) +
  scale_y_continuous(
    #limits = c(0, 21),
    breaks = c(0, 10, 20),
    name = expression('Neonate CEWL (g '*m^-2*' '*h^-1*')')
  ) -> neo_VPD_CEWL_partreg
neo_VPD_CEWL_partreg
```














# DAB osml clutch ~ mother

*this is what was done originally, but we now use all neonate data and do not avg by clutch*

```{r}
DAB_osml_LM_1 <- lm(data = dab_clutch_mom,
                      Plasma_Osmol_Rep_mean_mean ~ 
                      Treatment *
                      (Mother_osml + Mother_Days_in_Treatment) +
                      Mass_g_mean)
                     
car::vif(DAB_osml_LM_1, type = "predictor")
drop1(DAB_osml_LM_1)
anova(DAB_osml_LM_1)
```


```{r}
DAB_osml_LM_2a <- lm(data = dab_clutch_mom,
                      Plasma_Osmol_Rep_mean_mean ~ 
                      Treatment * Mother_Days_in_Treatment +
                      Mother_osml + 
                      Mass_g_mean)
                     
drop1(DAB_osml_LM_2a)
car::Anova(DAB_osml_LM_2a, type = "2")

DAB_osml_LM_2b <- lm(data = dab_clutch_mom,
                      Plasma_Osmol_Rep_mean_mean ~ 
                      Treatment *
                      (Mother_osml + Mother_Days_in_Treatment))
drop1(DAB_osml_LM_2b)
car::Anova(DAB_osml_LM_2b, type = "2")
```


```{r}
DAB_osml_LM_3 <- lm(data = dab_clutch_mom,
                      Plasma_Osmol_Rep_mean_mean ~ 
                      Treatment * Mother_Days_in_Treatment +
                      Mother_osml)
                     
drop1(DAB_osml_LM_3)
car::Anova(DAB_osml_LM_3, type = "2")
```


```{r}
DAB_osml_LM_4 <- lm(data = dab_clutch_mom,
                      Plasma_Osmol_Rep_mean_mean ~ 
                      Treatment * Mother_Days_in_Treatment)
                     
drop1(DAB_osml_LM_4)
car::Anova(DAB_osml_LM_4, type = "2")
```


```{r}
DAB_osml_LM_5 <- lm(data = dab_clutch_mom,
                      Plasma_Osmol_Rep_mean_mean ~ 
                      Treatment + Mother_Days_in_Treatment)
                     
drop1(DAB_osml_LM_5)
car::Anova(DAB_osml_LM_5, type = "2")
```


```{r}
DAB_osml_LM_6 <- lm(data = dab_clutch_mom,
                      Plasma_Osmol_Rep_mean_mean ~ 
                      Treatment)

car::Anova(DAB_osml_LM_6, type = "2")
```


```{r}
DAB_osml_LM_null <- lm(data = dab_clutch_mom, Plasma_Osmol_Rep_mean_mean ~ 1)
```




## Model Selection

```{r}
clutch_osmol_models_all <- list(DAB_osml_LM_1, DAB_osml_LM_2a, DAB_osml_LM_3, DAB_osml_LM_4, DAB_osml_LM_5, DAB_osml_LM_6, DAB_osml_LM_null)

#specify model names
clutch_osmol_mod_names_all <- c('model1', 
                    'model2', 
                    'model3',
                    'model4',
                    'model5',
                    'model6',
                    'modelnull')

#calculate AIC of each model
clutch_osmol_AICc_all <- data.frame(aictab(cand.set = clutch_osmol_models_all, 
                                 modnames = clutch_osmol_mod_names_all))
clutch_osmol_AICc_all
```


The best top/equivalent models are 5 (tmt + mother days in tmt), 6 (tmt only), and 4 (tmt * mother days in tmt).


## Final Model

```{r}
DAB_osml_LM_BEST <- lm(data = dab_clutch_mom,
                       Plasma_Osmol_Rep_mean_mean ~ 
                          Treatment)

car::Anova(DAB_osml_LM_BEST, type = "2")
summary(DAB_osml_LM_BEST)
```


```{r}
DAB_osml_LM_BEST_add <- lm(data = dab_clutch_mom,
                       Plasma_Osmol_Rep_mean_mean ~ 
                          Treatment + Mother_Days_in_Treatment)

car::Anova(DAB_osml_LM_BEST_add, type = "2")
summary(DAB_osml_LM_BEST_add)
```


```{r}
DAB_osml_LM_BEST_int <- lm(data = dab_clutch_mom,
                       Plasma_Osmol_Rep_mean_mean ~ 
                          Treatment * Mother_Days_in_Treatment)

car::Anova(DAB_osml_LM_BEST_int, type = "2")
summary(DAB_osml_LM_BEST_int)
```






## Model Assumptions


```{r}
plot(DAB_osml_LM_BEST)
plot(DAB_osml_LM_BEST_add)
plot(DAB_osml_LM_BEST_int)
```







# DAB OSML DIFFS


first, check whether tmt and mother osml are collinear

```{r}
tmt_momosmol <- lm(data = dab_all, Mother_osml ~ Treatment)
summary(tmt_momosmol)
```

Yep, as expected, so I think I need to run one model selection with tmt and one with mother osml?? 


## Tmt + Mom Osml

```{r}
DAB_OSMOL_LMM_1 <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Treatment * 
  (Mother_osml+Mother_Days_in_Treatment+live_neonates+total_embryos) + 
                        Mass_g +
                        (1|Mother_ID))

car::vif(DAB_OSMOL_LMM_1)                     
drop1(DAB_OSMOL_LMM_1)
```


```{r}
DAB_OSMOL_LMM_1a <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Treatment * 
                        (live_neonates + total_embryos) + 
                        Mother_osml + Mother_Days_in_Treatment +
                        Mass_g +
                        (1|Mother_ID))

car::vif(DAB_OSMOL_LMM_1a)                     
drop1(DAB_OSMOL_LMM_1a)
```




```{r}
DAB_OSMOL_LMM_1b <- lme4::lmer(data = dab_all,
                    Plasma_Osmol_Rep_mean ~ 
                      Treatment + 
                      Mother_osml + Mother_Days_in_Treatment +
                      live_neonates + total_embryos + 
                      Mass_g +
                        (1|Mother_ID))

car::vif(DAB_OSMOL_LMM_1b)                     
drop1(DAB_OSMOL_LMM_1b)
anova(DAB_OSMOL_LMM_1b, test = "F", type = "2")
```


the two different clutch size assessments are too collinear, I need to choose one...

```{r}
test_live <- lme4::lmer(data = dab_all,
                    Plasma_Osmol_Rep_mean ~ 
                      Treatment + 
                      Mother_osml +
                      live_neonates + 
                        (1|Mother_ID))
summary(test_live)
anova(test_live, test = "F", type = "2")

test_total <- lme4::lmer(data = dab_all,
                    Plasma_Osmol_Rep_mean ~ 
                      Treatment + 
                      Mother_osml +
                      total_embryos + 
                        (1|Mother_ID))
summary(test_total)
anova(test_total, test = "F", type = "2")
```






I think it makes sense to use the live neonates since mothers might have stopped devoting resources to slugs.



## start good models 

(good = no collinearity)


```{r}
DAB_OSMOL_LMM_1c <- lme4::lmer(data = dab_all,
                    Plasma_Osmol_Rep_mean ~ 
                      Treatment + 
                      Mother_osml + Mother_Days_in_Treatment +
                      live_neonates +
                      Mass_g +
                        (1|Mother_ID))

car::vif(DAB_OSMOL_LMM_1c)                     
drop1(DAB_OSMOL_LMM_1c)
anova(DAB_OSMOL_LMM_1c, test = "F", type = "2")
```


```{r}
DAB_OSMOL_LMM_2 <- lme4::lmer(data = dab_all,
                    Plasma_Osmol_Rep_mean ~ 
                      Treatment + 
                      Mother_osml +
                      live_neonates + 
                      Mass_g + 
                        (1|Mother_ID))

drop1(DAB_OSMOL_LMM_2)
anova(DAB_OSMOL_LMM_2, test = "F", type = "2")
```


```{r}
DAB_OSMOL_LMM_3 <- lme4::lmer(data = dab_all,
                    Plasma_Osmol_Rep_mean ~ 
                      Treatment + 
                      Mother_osml +
                      Mass_g + 
                        (1|Mother_ID))

DAB_OSMOL_LMM_3a <- lme4::lmer(data = dab_all,
                    Plasma_Osmol_Rep_mean ~ 
                      Treatment + 
                      Mother_osml +
                      live_neonates +
                        (1|Mother_ID))

summary(DAB_OSMOL_LMM_3)
drop1(DAB_OSMOL_LMM_3)
anova(DAB_OSMOL_LMM_3, test = "F", type = "2")
anova(DAB_OSMOL_LMM_3a, test = "F", type = "2")
```



```{r}
DAB_OSMOL_LMM_4 <- lme4::lmer(data = dab_all,
                    Plasma_Osmol_Rep_mean ~ 
                      Treatment + 
                      Mother_osml +
                        (1|Mother_ID))

drop1(DAB_OSMOL_LMM_4)
car::Anova(DAB_OSMOL_LMM_4, test = "F", type = "2")
```



```{r}
DAB_OSMOL_LMM_5 <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Treatment +
                        (1|Mother_ID))
```

```{r}
DAB_OSMOL_LMM_null <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 1 + (1|Mother_ID))
```


## Model Selection

```{r}
osml_models_all <- list(DAB_OSMOL_LMM_1c, DAB_OSMOL_LMM_2,
                        DAB_OSMOL_LMM_3, DAB_OSMOL_LMM_3a, 
                        DAB_OSMOL_LMM_4, DAB_OSMOL_LMM_5,
                        DAB_OSMOL_LMM_null)

#specify model names
osml_mod_names_all <- c('model1', 'model2',  
                    'model3', 'model3a', 'model4', 'model5', 
                    'modelnull')

#calculate AIC of each model
osml_AICc_all <- data.frame(aictab(cand.set = osml_models_all, 
                                 modnames = osml_mod_names_all))
osml_AICc_all
```



They are literally all equivalent... lol







## Tmt only

```{r}
DAB_OSMOL_tmt_LMM_1 <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Treatment * 
                        (Mother_Days_in_Treatment + live_neonates) + 
                        Mass_g +
                        (1|Mother_ID))

car::vif(DAB_OSMOL_tmt_LMM_1)                     
drop1(DAB_OSMOL_tmt_LMM_1)
```

```{r}
DAB_OSMOL_tmt_LMM_1a <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Treatment * 
                        Mother_Days_in_Treatment + 
                        live_neonates + 
                        Mass_g +
                        (1|Mother_ID))

car::vif(DAB_OSMOL_tmt_LMM_1a)                     
drop1(DAB_OSMOL_tmt_LMM_1a)
```


```{r}
DAB_OSMOL_tmt_LMM_2a <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Treatment * 
                        Mother_Days_in_Treatment + 
                        live_neonates + 
                        (1|Mother_ID))

car::vif(DAB_OSMOL_tmt_LMM_2a)                     
drop1(DAB_OSMOL_tmt_LMM_2a)

DAB_OSMOL_tmt_LMM_2b <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Treatment + 
                        Mother_Days_in_Treatment + 
                        live_neonates + 
                        Mass_g +
                        (1|Mother_ID))

car::vif(DAB_OSMOL_tmt_LMM_2b)                     
drop1(DAB_OSMOL_tmt_LMM_2b)
```


```{r}
DAB_OSMOL_tmt_LMM_3a <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Treatment * 
                        Mother_Days_in_Treatment + 
                        (1|Mother_ID))

drop1(DAB_OSMOL_tmt_LMM_3a)

DAB_OSMOL_tmt_LMM_3b <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Treatment + 
                        Mother_Days_in_Treatment + 
                        live_neonates + 
                        (1|Mother_ID))

drop1(DAB_OSMOL_tmt_LMM_3b)
```




```{r}
DAB_OSMOL_tmt_LMM_4 <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Treatment +
                        Mother_Days_in_Treatment + 
                        (1|Mother_ID))

drop1(DAB_OSMOL_tmt_LMM_4)
anova(DAB_OSMOL_tmt_LMM_4, test = "F", type = "2")
```



```{r}
DAB_OSMOL_tmt_LMM_5 <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Treatment +
                        (1|Mother_ID))

DAB_OSMOL_tmt_LMM_null <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      1 +
                        (1|Mother_ID))
```



## Model Selection

```{r}
osml_tmt_models_all <- list(DAB_OSMOL_tmt_LMM_1a, 
                            DAB_OSMOL_tmt_LMM_2a, DAB_OSMOL_tmt_LMM_2b,
                        DAB_OSMOL_tmt_LMM_3a, DAB_OSMOL_tmt_LMM_3b, 
                        DAB_OSMOL_tmt_LMM_4, DAB_OSMOL_tmt_LMM_5,
                        DAB_OSMOL_tmt_LMM_null)

#specify model names
osml_tmt_mod_names_all <- c('model1', 'model2a', 'model2b',    
                    'model3a', 'model3b', 'model4', 'model5', 
                    'modelnull')

#calculate AIC of each model
data.frame(aictab(cand.set = osml_tmt_models_all, 
                  modnames = osml_tmt_mod_names_all))
```











## Mom Osml only


```{r}
DAB_OSMOL_mom_LMM_1 <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Mother_osml +
                        Mother_Days_in_Treatment + live_neonates + 
                        Mass_g +
                        (1|Mother_ID))

car::vif(DAB_OSMOL_mom_LMM_1)                     
drop1(DAB_OSMOL_mom_LMM_1)
```


```{r}
DAB_OSMOL_mom_LMM_2 <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Mother_osml +
                      live_neonates + 
                      Mass_g +
                        (1|Mother_ID))

drop1(DAB_OSMOL_mom_LMM_2)
anova(DAB_OSMOL_mom_LMM_2, test = "F", type = "2")
```



```{r}
DAB_OSMOL_mom_LMM_3 <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Mother_osml +
                      Mass_g +
                        (1|Mother_ID))

drop1(DAB_OSMOL_mom_LMM_3)
```


```{r}
DAB_OSMOL_mom_LMM_4 <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Mother_osml +
                        (1|Mother_ID))
anova(DAB_OSMOL_mom_LMM_4, test = "F", type = "2")
```

```{r}
DAB_OSMOL_mom_LMM_null <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      1 +
                        (1|Mother_ID))
```




## Model Selection

```{r}
osml_mom_models_all <- list(DAB_OSMOL_mom_LMM_1, 
                            DAB_OSMOL_mom_LMM_2, 
                            DAB_OSMOL_mom_LMM_3, 
                            DAB_OSMOL_mom_LMM_4, 
                            DAB_OSMOL_mom_LMM_null)

#specify model names
osml_mom_mod_names_all <- c('model1', 'model2', 
                            'model3', 'model4', 
                            'modelnull')

#calculate AIC of each model
data.frame(aictab(cand.set = osml_mom_models_all, 
                  modnames = osml_mom_mod_names_all))
```










## Final Modelsss...


Okay, so if we use either tmt or mother osml, then the top models are one with Treatment * Mother_Days_in_Treatment and one with only Mother_osml!

```{r}
DAB_OSMOL_LMM_BEST_tmt <- lmerTest::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Treatment * Mother_Days_in_Treatment + 
                        (1|Mother_ID))
DAB_OSMOL_LMM_BEST_mom <- lmerTest::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Mother_osml +
                        (1|Mother_ID))

anova(DAB_OSMOL_LMM_BEST_tmt, test = "F", type = "2")
anova(DAB_OSMOL_LMM_BEST_mom, test = "F", type = "2")
```


## emmeans


```{r}
summary(DAB_OSMOL_LMM_BEST_tmt)

emmeans(DAB_OSMOL_LMM_BEST_tmt, 
        pairwise ~ Treatment | Mother_Days_in_Treatment)

osml_tmt_trends <- emtrends(DAB_OSMOL_LMM_BEST_tmt, 
         var = "Mother_Days_in_Treatment", "Treatment")
tidy(osml_tmt_trends)

pairs(osml_tmt_trends)

DAB_OSMOL_emmeans_tmt <- emmeans(DAB_OSMOL_LMM_BEST_tmt, 
                      "Treatment", by = "Mother_Days_in_Treatment")
DAB_OSMOL_emmeans_CI <- tidy(confint(DAB_OSMOL_emmeans_tmt))
```


```{r}
summary(DAB_OSMOL_LMM_BEST_mom)
r.squaredGLMM(DAB_OSMOL_LMM_BEST_mom)
r.squaredGLMM(DAB_OSMOL_LMM_BEST_tmt)
```





## Model Assumptions

```{r}
plot(DAB_OSMOL_LMM_BEST_tmt)
shapiro.test(residuals(DAB_OSMOL_LMM_BEST_tmt))

plot(DAB_OSMOL_LMM_BEST_mom)
shapiro.test(residuals(DAB_OSMOL_LMM_BEST_mom))
```

looks great




## Partial Regression

actually, I do not need to get partreg values because these relationships are simple/straightforward to plot

```{r}
plot(effect("Mother_osml", DAB_OSMOL_LMM_BEST_mom))
plot(effect("Treatment:Mother_Days_in_Treatment", 
            DAB_OSMOL_LMM_BEST_tmt), multiline = T)
```






# PUB FIG



## osml ~ mom osml



```{r}
ggplot(
  dab_clutch_mom,
  aes(
    x = Mother_osml,
    y = Plasma_Osmol_Rep_mean_mean
  )
) +
  geom_abline(
    slope = 1, intercept = 0,
    linetype = "dashed", color = "darkgrey"
  ) +
  geom_pointrange(
    aes(ymin = Plasma_Osmol_Rep_mean_mean-Plasma_Osmol_Rep_mean_sd,
        ymax = Plasma_Osmol_Rep_mean_mean+Plasma_Osmol_Rep_mean_sd,
        color = Treatment, shape = Treatment),
    alpha = 0.6, size = 0.2, linewidth = 0.3, show.legend = FALSE
  ) +
  geom_point(aes(color = Treatment, shape = Treatment)) +
  geom_smooth(
    se = T,
    formula = 'y~x',
    method = "lm",
    linewidth = 1,
    color = "black",
    show.legend = FALSE
  ) +
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  theme(
    legend.position = "inside",
    legend.position.inside = c(0.75, 0.15),
    legend.background = element_blank()
  ) +
  
  scale_x_continuous(
    limits = c(260, 360),
    breaks = c(260, 280, 300, 320, 340, 360),
    name = expression('Mother Osmolality (mmol '*kg^-1*')'),
  ) +
  scale_y_continuous(
    limits = c(260, 360),
    breaks = c(260, 280, 300, 320, 340, 360),
    name = expression('Neonate Osmolality (mmol '*kg^-1*')'),
  ) -> neo_mom_osml
neo_mom_osml
```




export it:

```{r}
ggsave(
  filename = "Fig3_neonate_mother_osml.pdf",
  plot = neo_mom_osml,
  path = "./results_figures",
  device = "pdf",
  dpi = 600,
  units = "mm",
  width = 150,
  height = 100
)
ggsave(
  filename = "Fig3_neonate_mother_osml.tiff",
  plot = neo_mom_osml,
  path = "./results_figures",
  device = "tiff",
  dpi = 600,
  units = "mm",
  width = 150,
  height = 100
)
```










## osml ~ tmt * days



```{r}
ggplot(
  dab_clutch_mom,
  aes(
    x = Mother_Days_in_Treatment,
    y = Plasma_Osmol_Rep_mean_mean,
    color = Treatment, 
    shape = Treatment
  )
) +
  # geom_abline(
  #   slope = 1, intercept = 0, 
  #   linetype = "dashed", color = "darkgrey"
  # ) +
  geom_pointrange(
    aes(ymin = Plasma_Osmol_Rep_mean_mean-Plasma_Osmol_Rep_mean_sd,
        ymax = Plasma_Osmol_Rep_mean_mean+Plasma_Osmol_Rep_mean_sd),
    alpha = 0.6, size = 0.2, linewidth = 0.3, show.legend = FALSE
  ) +
  geom_point() +
  geom_smooth(
    se = F,
    formula = 'y~x',
    method = "lm",
    linewidth = 1,
    show.legend = FALSE
  ) +
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  theme(
    legend.position = "inside",
    legend.position.inside = c(0.15, 0.85),
    legend.background = element_blank()
  ) +
  
  scale_x_continuous(
    limits = c(2, 15),
    breaks = c(2, 6, 10, 14),
    name = "Mother Days in Treatment Before Birthing"
  ) +
  scale_y_continuous(
    limits = c(269, 360),
    breaks = c(280, 300, 320, 340, 360),
    name = expression('Neonate Osmolality (mmol '*kg^-1*')'),
  ) -> neo_tmt_osml
neo_tmt_osml
```




















# PUB FIG DAB

## Osmolality

```{r}
ggplot() +
  # geom_pointrange(
  #   data = dab_all_clutch_avg,
  #   aes(
  #     x = Treatment,
  #     y = Plasma_Osmol_Rep_mean_mean,
  #     ymin = Plasma_Osmol_Rep_mean_min,
  #     ymax = Plasma_Osmol_Rep_mean_max,
  #     group = Mother_ID,
  #     color = Treatment,
  #     shape = Treatment
  #   ),
  #   position = position_jitter(width = 0.3),
  #   size = 0.2, linewidth = 0.3,
  #   alpha = 0.8,
  #   show.legend = FALSE
  # ) +
  geom_point(
    data = dab_all_clutch_avg,
    aes(
      x = Treatment,
      y = Plasma_Osmol_Rep_mean_mean,
      group = Mother_ID,
      color = Treatment,
      shape = Treatment
    ),
    position = position_jitter(width = 0.3),
    alpha = 0.8,
    show.legend = FALSE
  ) +
  geom_errorbar(
    data = DAB_OSMOL_emmeans_CI,
    aes(x = Treatment, ymin = conf.low, ymax = conf.high,
        color = Treatment),
    width = 0.3
  ) +
  geom_point(
    data = DAB_OSMOL_emmeans_CI,
    aes(x = Treatment, y = estimate, 
        color = Treatment, shape = Treatment),
    size = 2.5
  ) +

  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  labs(
    x = NULL, 
    y = expression('Osmolality (mmol '*kg^-1*')'),
    color = "Treatment"
  ) +
  scale_y_continuous(
    #limits = c(260, 360), # for pointrange
    limits = c(280, 325), 
    breaks = seq(260, 360, by = 20)
  ) +
  scale_x_discrete(labels = c("C" = "Control", "W" = "Hydration")) +
  
  theme(legend.position = "none") +
  
  # statistical labels
  annotate(geom = "text", x = 1.5, y = 318, label = "*", size = 6) -> dab_osml
  
dab_osml
```




## CEWL

```{r}
ggplot() +
  # geom_pointrange(
  #   data = dab_all_clutch_avg,
  #   aes(
  #     x = Treatment,
  #     y = CEWL_g_m2h_mean,
  #     ymin = CEWL_g_m2h_min,
  #     ymax = CEWL_g_m2h_max,
  #     group = Mother_ID,
  #     color = Treatment,
  #     shape = Treatment
  #   ),
  #   position = position_jitter(width = 0.3),
  #   size = 0.2, linewidth = 0.3,
  #   alpha = 0.8,
  #   show.legend = FALSE
  # ) +
  geom_point(
    data = dab_all_clutch_avg,
    aes(
      x = Treatment,
      y = CEWL_g_m2h_mean,
      group = Mother_ID,
      color = Treatment,
      shape = Treatment
    ),
    position = position_jitter(width = 0.3),
    alpha = 0.8,
    show.legend = FALSE
  ) +
  geom_errorbar(
    data = DAB_CEWL_emmeans_CI,
    aes(x = Treatment, ymin = conf.low, ymax = conf.high,
        color = Treatment),
    width = 0.3
  ) +
  geom_point(
    data = DAB_CEWL_emmeans_CI,
    aes(x = Treatment, y = estimate, 
        color = Treatment, shape = Treatment),
    size = 2.5
  ) +

  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  labs(
    x = NULL, 
    y = expression('CEWL (g '*m^-2*' '*h^-1*')'), 
    color = "Treatment"
  ) +
  scale_y_continuous(
    #limits = c(4, 25), # for pointrange
    limits = c(4, 16), 
    breaks = seq(0, 30, by = 5)
  ) +
  scale_x_discrete(labels = c("C" = "Control", "W" = "Hydration")) +
  
  theme(legend.position = "none") +
  
  # statistical labels
  annotate(geom = "text", x = 1.5, y = 15, label = "NS", size = 2) -> dab_cewl
  
dab_cewl
```



## Arrange 


```{r}
set.seed(135) # to get a nice jitter: 10, 35, 44, 359, 135

ggarrange(
  dab_osml, dab_cewl,
  nrow = 2,
  ncol = 1,
  labels = c("A", "B"),
  align = "hv"
) -> dab_diffs

ggsave(
  filename = "Fig4_neonate_dab_diffs.pdf",
  plot = dab_diffs,
  path = "./results_figures",
  device = "pdf",
  dpi = 600,
  units = "mm",
  width = 80,
  height = 120
)

ggsave(
  filename = "Fig4_neonate_dab_diffs.tiff",
  plot = dab_diffs,
  path = "./results_figures",
  device = "tiff",
  dpi = 600,
  units = "mm",
  width = 80,
  height = 120
)
```

























# TMT EFFECTS


## Calculate Deltas

Only 3 individuals were for sure measured at the before and after time points, so the change from before to after cannot be calculated for individual neonates. 

```{r}
deltas_means <- dab_ps_compare_means %>%
  arrange(Mother_ID, timept) %>% 
  group_by(Mother_ID) %>%
  mutate(
    delta_mass = Mass_g_mean - lag(Mass_g_mean),
    delta_osml = Plasma_Osmol_Rep_mean_mean - lag(Plasma_Osmol_Rep_mean_mean),
    delta_CEWL = CEWL_g_m2h_mean - lag(CEWL_g_m2h_mean)
  ) 

deltas_befaft <- deltas_means %>% 
  ungroup() %>% 
  mutate(
    delta_mass = case_when(is.na(delta_mass) ~ 0, TRUE ~ delta_mass),
    delta_osml = case_when(is.na(delta_osml) ~ 0, TRUE ~ delta_osml),
    delta_CEWL = case_when(is.na(delta_CEWL) ~ 0, TRUE ~ delta_CEWL)
  )

deltas <- deltas_means %>%
  filter(complete.cases(delta_mass))

summary(deltas_befaft)
summary(deltas)
```


## MASS

```{r}
mass_lm_time_tmt <- lmerTest::lmer(data = dab_ps_compare, 
            Mass_g ~ timept * Treatment + (1|Mother_ID))
r.squaredGLMM(mass_lm_time_tmt)

mass_means_time <- emmeans(mass_lm_time_tmt, 
                       pairwise ~ timept | Treatment)
mass_means_time$contrasts

mass_means_tmt <- emmeans(mass_lm_time_tmt, 
                       pairwise ~ Treatment | timept)
mass_means_tmt$contrasts

mass_means <- emmeans(mass_lm_time_tmt, "Treatment", by = "timept")
mass_lm_time_tmt_CI <- tidy(confint(mass_means))
#mass_lm_time_tmt_CI <- tidy(mass_means_time$emmeans) # either would work

anova(mass_lm_time_tmt, test = "F", type = "2")
```



## MASS CHANGE

```{r}
delta_mass_lm <- lm(data = deltas, delta_mass ~ Treatment)

summary(delta_mass_lm)
car::Anova(delta_mass_lm, test = "F", type = "2")
emmeans(delta_mass_lm, pairwise ~ Treatment)
```




## OSML

```{r}
osml_lm_time_tmt <- lmerTest::lmer(data = dab_ps_compare, 
    Plasma_Osmol_Rep_mean ~ timept * Treatment + (1|Mother_ID))
r.squaredGLMM(osml_lm_time_tmt)

osml_means_time <- emmeans(osml_lm_time_tmt, 
                       pairwise ~ timept | Treatment)
osml_means_time$contrasts

osml_means_tmt <- emmeans(osml_lm_time_tmt, 
                       pairwise ~ Treatment | timept)
osml_means_tmt$contrasts

osml_means <- emmeans(osml_lm_time_tmt, "Treatment", by = "timept")
osml_lm_time_tmt_CI <- tidy(confint(osml_means))

anova(osml_lm_time_tmt, test = "F", type = "2")
```



## OSML CHANGE

```{r}
delta_osml_lm <- lm(data = deltas, delta_osml ~ Treatment)

summary(delta_osml_lm)
car::Anova(delta_osml_lm, test = "F", type = "2")
emmeans(delta_osml_lm, pairwise ~ Treatment)
```





## CEWL

*NOTE* I did test the inclusion of Tb, msmt temp, and msmt VPD in this model specifically, and none had an influence on CEWL compared to the time difference.

```{r}
cewl_lm_time_tmt <- lmerTest::lmer(data = dab_ps_compare, 
          CEWL_g_m2h ~ timept * Treatment + (1|Mother_ID))
r.squaredGLMM(cewl_lm_time_tmt)

cewl_means_time <- emmeans(cewl_lm_time_tmt, 
                       pairwise ~ timept | Treatment)
cewl_means_time$contrasts

cewl_means_tmt <- emmeans(cewl_lm_time_tmt, 
                       pairwise ~ Treatment | timept)
cewl_means_tmt$contrasts

cewl_means <- emmeans(cewl_lm_time_tmt, "Treatment", by = "timept")
cewl_lm_time_tmt_CI <- tidy(confint(cewl_means))

anova(cewl_lm_time_tmt, test = "F", type = "2")
```





## CEWL CHANGE 

```{r}
delta_cewl_lm <- lm(data = deltas, delta_CEWL ~ Treatment)

summary(delta_cewl_lm)
car::Anova(delta_cewl_lm, test = "F", type = "2")
emmeans(delta_cewl_lm, pairwise ~ Treatment)
```









## Tb


```{r}
tb_lm_time_tmt <- lmerTest::lmer(data = dab_ps_compare, 
          Tb_CEWL_c ~ timept * Treatment + (1|Mother_ID))
r.squaredGLMM(tb_lm_time_tmt)

tb_means_time <- emmeans(tb_lm_time_tmt, 
                       pairwise ~ timept | Treatment)
tb_means_time$contrasts

tb_means_tmt <- emmeans(tb_lm_time_tmt, 
                       pairwise ~ Treatment | timept)
tb_means_tmt$contrasts

tb_means <- emmeans(tb_lm_time_tmt, "Treatment", by = "timept")
tb_lm_time_tmt_CI <- tidy(confint(tb_means))

anova(tb_lm_time_tmt, test = "F", type = "2")
```






## Shedding time

Is there a difference in time between birth and shedding based on tmt group?

```{r}
date_tmt <- dab_ps_compare %>% 
  group_by(Mother_ID, Treatment) %>% 
  summarise(
    min_date = min(Date_Born_Shed),
    max_date = max(Date_Born_Shed)
  ) %>% 
  mutate(range = as.numeric(max_date - min_date)) %>% 
  arrange(range)

shedtimelm <- lm(data = date_tmt, range ~ Treatment)
summary(shedtimelm)
anova(shedtimelm)
```






















# PUB FIG 6


## mass raw

```{r}
ggplot() +
  # geom_pointrange(
  #   data = dab_ps_compare_means,
  #   aes(
  #     x = timept,
  #     y = Mass_g_mean,
  #     ymin = Mass_g_mean-Mass_g_sd,
  #     ymax = Mass_g_mean+Mass_g_sd,
  #     group = Treatment,
  #     color = Treatment,
  #     shape = Treatment
  #   ),
  #   position = position_jitterdodge(jitter.width = 0.6, dodge.width = 0.6),
  #   size = 0.2, linewidth = 0.3,
  #   alpha = 0.6,
  #   show.legend = FALSE
  # ) +
  geom_point(
    data = dab_ps_compare_means,
    aes(
      x = timept,
      y = Mass_g_mean,
      group = Treatment,
      color = Treatment,
      shape = Treatment
    ),
    position = position_jitterdodge(jitter.width = 0.6, dodge.width = 0.6),
    alpha = 0.6,
    show.legend = FALSE
  ) +
  geom_line(
    data = mass_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      group = Treatment, 
      color = Treatment
    ),
    position = position_dodge(width = 0.6)
  ) +
  geom_errorbar(
    data = mass_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      ymin = conf.low, ymax = conf.high, 
      group = Treatment, 
      color = Treatment
    ),
    width = 0.4,
    position = position_dodge(width = 0.6)
  ) +
  geom_point(
    data = mass_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      group = Treatment, 
      color = Treatment,
      shape = Treatment
    ),
    size = 2.5,
    position = position_dodge(width = 0.6)
  ) + 
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = "Treatment"
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = "Treatment"
  ) +
  scale_y_continuous(
    #limits = c(10, 21), #ptrg
    limits = c(10, 20),
    breaks = c(10, 15, 20),
    name = "Mass (g)"
  ) + 
  scale_x_discrete(
    labels = c("DAB" = "At Birth", "PS" = "Post-Shed"),
    name = NULL
  ) +
  
  theme(legend.position = "none") +
  
  # statistical labels
  annotate(geom = "text", x = 1, y = 19.5, label = "NS", size = 2) +
  annotate(geom = "text", x = 2, y = 19.5, label = "NS", size = 2) +
  annotate(geom = "text", x = 2.5, y = 12.8, label = "*", size = 6, 
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2.5, y = 13.7, label = "*", size = 6,
           color = "royalblue4") -> neo_mass # save

neo_mass
```




## osmol raw

```{r}
ggplot() +
  # geom_pointrange(
  #   data = dab_ps_compare_means,
  #   aes(
  #     x = timept,
  #     y = Plasma_Osmol_Rep_mean_mean,
  #     ymin = Plasma_Osmol_Rep_mean_mean-Plasma_Osmol_Rep_mean_sd,
  #     ymax = Plasma_Osmol_Rep_mean_mean+Plasma_Osmol_Rep_mean_sd,
  #     group = Treatment,
  #     color = Treatment,
  #     shape = Treatment
  #   ),
  #   position = position_jitterdodge(jitter.width = 0.6, dodge.width = 0.6),
  #   size = 0.2, linewidth = 0.3,
  #   alpha = 0.6,
  #   show.legend = FALSE
  # ) +
  geom_point(
    data = dab_ps_compare_means,
    aes(
      x = timept,
      y = Plasma_Osmol_Rep_mean_mean,
      group = Treatment,
      color = Treatment,
      shape = Treatment
    ),
    position = position_jitterdodge(jitter.width = 0.6, dodge.width = 0.6),
    alpha = 0.6,
    show.legend = FALSE
  ) +
  geom_line(
    data = osml_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      group = Treatment, 
      color = Treatment
    ),
    position = position_dodge(width = 0.6)
  ) +
  geom_errorbar(
    data = osml_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      ymin = conf.low, ymax = conf.high, 
      group = Treatment, 
      color = Treatment
    ),
    width = 0.4,
    position = position_dodge(width = 0.6)
  ) +
  geom_point(
    data = osml_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      group = Treatment, 
      color = Treatment,
      shape = Treatment
    ),
    size = 2.5,
    position = position_dodge(width = 0.6)
  ) + 
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = "Treatment"
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = "Treatment"
  ) +
  scale_y_continuous(
    #limits = c(240, 410), # ptrg
    limits = c(270, 370), 
    breaks = seq(260, 370, by = 20),
    name = expression('Osmolality (mmol '*kg^-1*')'),
  ) + 
  scale_x_discrete(
    labels = c("DAB" = "At Birth", "PS" = "Post-Shed"),
    name = NULL
  ) +
  
  theme(legend.position = "none") +
  
  # statistical labels
  annotate(geom = "text", x = 1, y = 363, label = "NS", size = 2) +
  annotate(geom = "text", x = 2, y = 361, label = "*", size = 6) +
  annotate(geom = "text", x = 2.5, y = 338, label = "*", size = 6, 
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2.5, y = 288, label = "NS", size = 2,
           color = "royalblue4") -> neo_osmol

neo_osmol
```







## cewl raw

```{r}
ggplot() +
  # geom_pointrange(
  #   data = dab_ps_compare_means,
  #   aes(
  #     x = timept,
  #     y = CEWL_g_m2h_mean,
  #     ymin = CEWL_g_m2h_mean-CEWL_g_m2h_sd,
  #     ymax = CEWL_g_m2h_mean+CEWL_g_m2h_sd,
  #     group = Treatment,
  #     color = Treatment,
  #     shape = Treatment
  #   ),
  #   position = position_jitterdodge(jitter.width = 0.6, dodge.width = 0.6),
  #   size = 0.2, linewidth = 0.3,
  #   alpha = 0.6,
  #   show.legend = FALSE
  # ) +
  geom_point(
    data = dab_ps_compare_means,
    aes(
      x = timept,
      y = CEWL_g_m2h_mean,
      group = Treatment,
      color = Treatment,
      shape = Treatment
    ),
    position = position_jitterdodge(jitter.width = 0.6, dodge.width = 0.6),
    alpha = 0.6,
    show.legend = FALSE
  ) +
  geom_line(
    data = cewl_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      group = Treatment, 
      color = Treatment
    ),
    position = position_dodge(width = 0.6)
  ) +
  geom_errorbar(
    data = cewl_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      ymin = conf.low, ymax = conf.high,  
      group = Treatment, 
      color = Treatment
    ),
    width = 0.4,
    position = position_dodge(width = 0.6)
  ) +
  geom_point(
    data = cewl_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      group = Treatment, 
      color = Treatment,
      shape = Treatment
    ),
    size = 2.5,
    position = position_dodge(width = 0.6)
  ) + 
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = "Treatment"
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = "Treatment"
  ) +
  scale_y_continuous(
    #limits = c(5, 23), # pt rg
    limits = c(7, 20), 
    breaks = seq(10, 20, by = 5),
    name = expression('CEWL (g '*m^-2*' '*h^-1*')')
  ) + 
  scale_x_discrete(
    labels = c("DAB" = "At Birth", "PS" = "Post-Shed"),
    name = NULL
  ) +
  
  theme(legend.position = "none") +
  
  # statistical labels
  annotate(geom = "text", x = 1, y = 19.5, label = "NS", size = 2) +
  annotate(geom = "text", x = 2, y = 19.5, label = "NS", size = 2) +
  annotate(geom = "text", x = 2.45, y = 15.5, label = "*", size = 6, 
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2.55, y = 15.5, label = "*", size = 6,
           color = "royalblue4") -> neo_cewl
  
neo_cewl
```






## change in mass

```{r}
ggplot(
  data = deltas_befaft, 
  aes(
    x = timept,
    y = delta_mass,
    group = Mother_ID,
    color = Treatment,
    shape = Treatment
  )) +
  geom_hline(yintercept = 0, linetype = 'dashed', color = "darkgray") +
  geom_point(size = 1.4, position = position_dodge(width = 0.1)) +
  geom_line(alpha = 0.4, position = position_dodge(width = 0.1)) +
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  scale_y_continuous(
    breaks = c(-3, -2, -1, 0),
    name = expression(Delta ~ 'Mass (g)')
  ) +
  scale_x_discrete(
    labels = c("DAB" = "At Birth", "PS" = "Post-Shed"),
    name = NULL
  ) +
  
  theme(legend.position = "inside",
        legend.position.inside = c(0.25, 0.15),
        legend.background = element_blank()) +
  
  # labels
  annotate(geom = "text", x = 2.3, y = -1.1, label = "*", size = 6, 
           color = "royalblue4") +
  annotate(geom = "text", x = 2.3, y = -2.1, label = "*", size = 6, 
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2, y = -0.5, label = "*", 
           size = 6) -> neo_change_mass
neo_change_mass
```







## change in osmol

```{r}
ggplot(
  data = deltas_befaft, 
  aes(
    x = timept,
    y = delta_osml,
    group = Mother_ID,
    color = Treatment,
    shape = Treatment
  )) +
  geom_hline(yintercept = 0, linetype = 'dashed', color = "darkgray") +
  geom_point(size = 1.4, position = position_dodge(width = 0.1)) +
  geom_line(alpha = 0.4, position = position_dodge(width = 0.1)) +
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  scale_y_continuous(
    breaks = c(-20, 0, 20, 40, 60, 80),
    name = expression(Delta ~ 'Osmolality (mmol '*kg^-1*')'),
  ) +
  scale_x_discrete(
    labels = c("DAB" = "At Birth", "PS" = "Post-Shed"),
    name = NULL
  ) +
  
  theme(legend.position = "inside",
        legend.position.inside = c(0.25, 0.85),
        legend.background = element_blank()) +
  
  # labels
  annotate(geom = "text", x = 2.3, y = -5, label = "NS", size = 2, 
           color = "royalblue4") +
  annotate(geom = "text", x = 2.3, y = 45, label = "*", size = 6, 
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2, y = 81, label = "*", 
           size = 6) -> neo_change_osml
neo_change_osml
```



## change in cewl

```{r}
ggplot(
  data = deltas_befaft, 
  aes(
    x = timept,
    y = delta_CEWL,
    group = Mother_ID,
    color = Treatment,
    shape = Treatment
  )) +
  geom_hline(yintercept = 0, linetype = 'dashed', color = "darkgray") +
  geom_point(size = 1.4, position = position_dodge(width = 0.1)) +
  geom_line(alpha = 0.4, position = position_dodge(width = 0.1)) +
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  scale_y_continuous(
    breaks = c(0, 5, 10),
    name = expression(Delta ~ 'CEWL (g '*m^-2*' '*h^-1*')')
  ) +
  scale_x_discrete(
    labels = c("DAB" = "At Birth", "PS" = "Post-Shed"),
    name = NULL
  ) +
  
  theme(legend.position = "inside",
        legend.position.inside = c(0.25, 0.85),
        legend.background = element_blank()) +
  
  # labels
  annotate(geom = "text", x = 2.25, y = 5, label = "*", size = 6,
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2.35, y = 5, label = "*", size = 6,
           color = "royalblue4") +
  annotate(geom = "text", x = 2, y = 11, label = "NS", 
           size = 2) -> neo_change_cewl
neo_change_cewl
```






## arrange


```{r}
ggarrange(
  neo_mass, neo_change_mass,
  neo_osmol, neo_change_osml,
  neo_cewl, neo_change_cewl,
  nrow = 3,
  ncol = 2,
  labels = c("A", "B", "C", "D", "E", "F"),
  align = "hv"
) -> neo_tmt_effects

ggsave(
  filename = "Fig6_neonate_tmt_effects.pdf",
  plot = neo_tmt_effects,
  path = "./results_figures",
  device = "pdf",
  dpi = 600,
  units = "mm",
  width = 160,
  height = 180
)

ggsave(
  filename = "Fig6_neonate_tmt_effects.tiff",
  plot = neo_tmt_effects,
  path = "./results_figures",
  device = "tiff",
  dpi = 600,
  units = "mm",
  width = 160,
  height = 180
)
```



















