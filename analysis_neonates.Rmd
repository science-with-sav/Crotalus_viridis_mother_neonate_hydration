---
title: "Neonate Analysis Colorado 2022"
author: "Robin Bedard & Savannah Weaver"
date: "2024-10-05"
output: html_document
---




# Packages


```{r}
library("tidyverse") # for dplyr workflow + ggplot
library("rmdformats") # pretty Rmd format
library("lme4")
library("lmerTest")
library("emmeans")
library("broom")
library("AICcmodavg")
library("ggpubr")
```



# Acronyms

DAB = day after birth
PS = post-shed / 1 week after birth




# Load & Tidy Data

## DAB osmolality

This is the osmolality of each individual neonate the day after birth. 

```{r}
neonate_dab_osmol <- readRDS("data/neonates/clean_Neonate_DAB_Osmolality.RDS")
head(neonate_dab_osmol)
```


## DAB body size

This is the body size and body temperature at time of CEWL measurements for each individual neonate. 

```{r}
neonate_dab_all0 <- readRDS("data/neonates/FinalNeonateDAB.RDS")

neonate_dab_all <- neonate_dab_all0 %>% 
  # fix a typo of where the decimal was put
  mutate(SVL_cm = case_when(SVL_cm == 2.4 ~ SVL_cm*10, TRUE ~ SVL_cm)) %>% 
  rename(Date_Born_Shed = Date_Born) %>% 
  mutate(timept = "DAB")

# robin removed this one...
#neonate_dab_all[77, ]

summary(neonate_dab_all)
```



## PS lumped

```{r}
neonate_postshed <- readRDS("data/neonates/neonate_postshed_clean.RDS")
```


## PS osmolality

first, separate out and get mean osmolality per individual

```{r}
postshed_osmol <- neonate_postshed %>% 
  select(CEWL_Blood_Collect_Date, Indiv_ID, 
         Plasma_Osmol_Rep1, Plasma_Osmol_Rep2, 
         Plasma_Osmol_Rep3, Plasma_Osmol_Rep4) %>% 
  pivot_longer(3:6, names_to = "rep", values_to = "osml") %>% 
  filter(complete.cases(osml)) %>% 
  group_by(CEWL_Blood_Collect_Date, Indiv_ID) %>% 
  summarise(Plasma_Osmol_Rep_mean = mean(osml))

head(postshed_osmol)
```


## PS body size

```{r}
neonate_postshed_clean <- neonate_postshed %>% 
  select(Indiv_ID, Date_Born_Shed = Date_Shed,
         CEWL_Blood_Collect_Date, 
         Tail_Length_cm, SVL_cm, Tail_SVL_Ratio, 
         Mass_g, Sex, Pee, Tb_CEWL_c, 
         Mother_ID, Treatment) %>% 
  mutate(timept = "PS") %>% 
  # fix a typo
  mutate(Treatment = case_when(Mother_ID == 128 ~ "W", TRUE ~ Treatment)) %>% 
  mutate(Treatment = factor(Treatment))
summary(neonate_postshed_clean)
```









## CEWL

```{r}
all_data_CEWL0 <- readRDS("data/neonates/CEWL_data_all_clean.RDS")

all_data_CEWL <- all_data_CEWL0 %>% 
  rename(CEWL_Blood_Collect_Date = date, Indiv_ID = individual_ID) %>% 
  # calculate VPD
  mutate(VPD = msmt_temp_C)
```







## Join Dataframes

All DAB:
*missing CEWL for 332*
```{r}
dab_all <- neonate_dab_all %>% 
  left_join(neonate_dab_osmol, 
            by = c('Indiv_ID', 'CEWL_Blood_Collect_Date')) %>% 
  left_join(all_data_CEWL, 
            by = c('Indiv_ID', 'CEWL_Blood_Collect_Date'))
```


DAB neonates + mothers:

###to do

```{r}

```





All PS:

```{r}
ps_all <- neonate_postshed_clean %>% 
  left_join(postshed_osmol,
            by = c('Indiv_ID', 'CEWL_Blood_Collect_Date')) %>% 
  left_join(all_data_CEWL, 
            by = c('Indiv_ID', 'CEWL_Blood_Collect_Date'))
```



subset of neonates/clutches with measurements at BOTH time points:

```{r}
dab_ps_compare <- dab_all %>% 
  # only keep clutches with post-shed msmts
  filter(Mother_ID %in% ps_all$Mother_ID) %>%
  # add those post-shed data
  rbind(ps_all) %>% 
  # formatting
  mutate(timept = factor(timept))

summary(dab_ps_compare)
```






```{r}
Mother_ID <- as.factor(c(124, 124, 125, 125, 128, 128, 129, 129, 131, 131, 133, 133, 134, 134, 135, 135, 101, 103, 104, 105, 112, 114, 115, 119, 126, 127))

mothers_osmol <- as.numeric(c(300.75, NA, 288.99, 307.66, 305, 271.33, 314.66, 325, 310.5, NA, 329, NA, 304, NA, 301.25, 322.33, 326, 331.66, 318, 320.75, 281.66, 311.667, 357.25, 320.33, 309.25, 312.333 ))

mothers_cewl <- as.numeric(c(16.96, NA, 19.90, 13.8, 24, 23.115, 24.47, 15.38, 11.68, NA, 18.797, NA, 17.83, NA, 20.595, 14.914, 20.9125, 21.12, 18.405, 13.5, 19.7375, 16.2275, 21.254, 27.82, 10.265, 22.4625))

days_mom_in_tmt <- as.numeric(c(5, 10, 2, 9, 3, 10, 2, 9, 5, 10, 5, 10, 5, 10, 3, 9, 13, 15, 15, 14, 14, 14, 15, 13, 7, 9))

Shed <- c("N", "Y", "N", "Y", "N", "Y", "N", "Y", "N", "Y", "N", "Y", "N", "Y", "N", "Y", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N")

mother_info <- data.frame(Mother_ID, mothers_osmol, mothers_cewl, days_mom_in_tmt, Shed)

neonate_analysis_df <- left_join(all_clutch_averages, mother_info, by = c("Mother_ID", "Shed"))
```







# DAB DIFFS





















# TMT EFFECTS


























