---
title: "Neonate Analysis Colorado 2022"
author: "Robin Bedard & Savannah Weaver"
date: "2024-10-05"
output: html_document
---




# Packages


```{r}
library("tidyverse") # for dplyr workflow + ggplot
library("rmdformats") # pretty Rmd format
library("lme4")
library("lmerTest")
library("emmeans")
library("broom")
library("AICcmodavg")
library("ggpubr")
```



# Fig Theme

```{r}
my_ggplot_theme <- theme_classic() + # start with a preset theme to make things easy
                     theme(axis.title = element_text(size = 10), # text size for axis labels
                           axis.text = element_text(size = 8, # text size for axis values
                                                    color = "black", # need to specifically set color
                                                    family = "sans"), # and family
                           legend.title = element_text(size = 8), # text size for the legend title
                           legend.text = element_text(size = 8), # text size for legend items
                           text = element_text(color = "black", # color for all text (except axis values)
                                               family = "sans") # family
                           )
```

Now, apply the theme. This sets the theme for the entire Rmd document.

```{r}
theme_set(my_ggplot_theme)
```


# Acronyms

DAB = day after birth
PS = post-shed / 1 week after birth




# Load & Tidy Data

## DAB osmolality

This is the osmolality of each individual neonate the day after birth. 

```{r}
neonate_dab_osmol <- readRDS("data/neonates/clean_Neonate_DAB_Osmolality.RDS")
head(neonate_dab_osmol)
```


## DAB body size

This is the body size and body temperature at time of CEWL measurements for each individual neonate. 

```{r}
neonate_dab_all0 <- readRDS("data/neonates/FinalNeonateDAB.RDS")

neonate_dab_all <- neonate_dab_all0 %>% 
  # fix a typo of where the decimal was put
  mutate(SVL_cm = case_when(SVL_cm == 2.4 ~ SVL_cm*10, TRUE ~ SVL_cm)) %>% 
  rename(Date_Born_Shed = Date_Born) %>% 
  mutate(timept = "DAB")

# robin removed this one...
#neonate_dab_all[77, ]

summary(neonate_dab_all)
```



## PS lumped

```{r}
neonate_postshed <- readRDS("data/neonates/neonate_postshed_clean.RDS")
```


## PS osmolality

first, separate out and get mean osmolality per individual

```{r}
postshed_osmol <- neonate_postshed %>% 
  select(CEWL_Blood_Collect_Date, Indiv_ID, 
         Plasma_Osmol_Rep1, Plasma_Osmol_Rep2, 
         Plasma_Osmol_Rep3, Plasma_Osmol_Rep4) %>% 
  pivot_longer(3:6, names_to = "rep", values_to = "osml") %>% 
  filter(complete.cases(osml)) %>% 
  group_by(CEWL_Blood_Collect_Date, Indiv_ID) %>% 
  summarise(Plasma_Osmol_Rep_mean = mean(osml))

head(postshed_osmol)
```


## PS body size

```{r}
neonate_postshed_clean <- neonate_postshed %>% 
  select(Indiv_ID, Date_Born_Shed = Date_Shed,
         CEWL_Blood_Collect_Date, 
         Tail_Length_cm, SVL_cm, Tail_SVL_Ratio, 
         Mass_g, Sex, Pee, Tb_CEWL_c, 
         Mother_ID, Treatment) %>% 
  mutate(timept = "PS") %>% 
  # fix a typo
  mutate(Treatment = case_when(Mother_ID == 128 ~ "W", TRUE ~ Treatment)) %>% 
  mutate(Treatment = factor(Treatment))
summary(neonate_postshed_clean)
```









## CEWL

```{r}
all_data_CEWL0 <- readRDS("data/neonates/CEWL_data_all_clean.RDS")

all_data_CEWL <- all_data_CEWL0 %>% 
  rename(CEWL_Blood_Collect_Date = date, Indiv_ID = individual_ID) %>% 
  # calculate VPD
  mutate(
    e_s_kPa = 0.611 * exp((17.502*msmt_temp_C)/(msmt_temp_C + 240.97)), # saturation VP
    e_a_kPa = e_s_kPa*((msmt_RH_percent/100)), # actual VP
    VPD_kPa = e_s_kPa - e_a_kPa # VP deficit
         
  )
summary(all_data_CEWL)
```







# Join/Arrange Dataframes


## DAB 

All DAB:
*missing CEWL for 332*
```{r}
dab_all <- neonate_dab_all %>% 
  left_join(neonate_dab_osmol, 
            by = c('Indiv_ID', 'CEWL_Blood_Collect_Date')) %>% 
  left_join(all_data_CEWL, 
            by = c('Indiv_ID', 'CEWL_Blood_Collect_Date')) %>% 
  # remove one erroneous point
  filter(Plasma_Osmol_Rep_mean < 400)
```






## PS

All PS:

```{r}
ps_all <- neonate_postshed_clean %>% 
  left_join(postshed_osmol,
            by = c('Indiv_ID', 'CEWL_Blood_Collect_Date')) %>% 
  left_join(all_data_CEWL, 
            by = c('Indiv_ID', 'CEWL_Blood_Collect_Date'))
```


## B vs P

subset of neonates/clutches with measurements at BOTH time points:

```{r}
dab_ps_compare <- dab_all %>% 
  # only keep clutches with post-shed msmts
  filter(Mother_ID %in% ps_all$Mother_ID) %>%
  # add those post-shed data
  rbind(ps_all) %>% 
  # formatting
  mutate(timept = factor(timept))

summary(dab_ps_compare)
```




# Clutch Avgs

Get min/max, sd, and mean per clutch per variable. 


## DAB Proportions

```{r}
dab_all_props <- dab_all %>% 
  #group_by(Mother_ID, Treatment, timept, Sex) %>%
  #count() %>% 
  group_by(Mother_ID, Treatment, timept) %>%
  summarise(
    n_neonates = n(), # number MEASURED, not n birthed
    Prop_Pee = sum(Pee == "Y")/n_neonates,
    Prop_F = sum(Sex == "F")/n_neonates
  )

summary(dab_all_props)
```



## DAB Means

```{r}
dab_all_clutch_avg <- dab_all %>% 
  group_by(Mother_ID, Treatment, timept) %>%
  mutate(n = n()) %>% 
  group_by(Mother_ID, Treatment, timept, n) %>% 
  summarise_at(
    vars(Tail_Length_cm, SVL_cm, Mass_g, Tb_CEWL_c, 
         Plasma_Osmol_Rep_mean, CEWL_g_m2h, 
         msmt_temp_C, msmt_RH_percent, VPD_kPa), 
    list(mean = mean, sd = sd, min = min, max = max),
    na.rm = T
  )

length(unique(dab_all_clutch_avg$Mother_ID)) == nrow(dab_all_clutch_avg)

summary(dab_all_clutch_avg)
```


## Mother Data!

```{r}
mother_values <- read_rds("./data/mother_values.RDS")

dab_clutch_mom <- dab_all_clutch_avg %>% 
  left_join(mother_values, by = "Mother_ID")
```






## PS Means

```{r}
ps_all_clutch_avg <- ps_all %>% 
  group_by(Mother_ID, Treatment, timept) %>%
  mutate(n = n()) %>% 
  group_by(Mother_ID, Treatment, timept, n) %>% 
  summarise_at(
    vars(Tail_Length_cm, SVL_cm, Mass_g, Tb_CEWL_c, 
         Plasma_Osmol_Rep_mean, CEWL_g_m2h, 
         msmt_temp_C, msmt_RH_percent, VPD_kPa), 
    list(mean = mean, sd = sd, min = min, max = max),
    na.rm = T
  )

length(unique(ps_all_clutch_avg$Mother_ID)) == nrow(ps_all_clutch_avg)
```


## B vs P

```{r}
dab_ps_compare_means <- dab_all_clutch_avg %>% 
  # only keep clutches with post-shed msmts
  filter(Mother_ID %in% ps_all$Mother_ID) %>%
  # add those post-shed data
  rbind(ps_all_clutch_avg) %>% 
  # formatting
  mutate(timept = factor(timept))

summary(dab_ps_compare_means)
```












# DAB CEWL clutch ~ mother


```{r}
DAB_CEWL_LM_1 <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 
                      Treatment *
                      Mother_CEWL +
                      Tb_CEWL_c_mean +
                      msmt_temp_C_mean +
                      msmt_RH_percent_mean + 
                      VPD_kPa_mean)
                     
car::vif(DAB_CEWL_LM_1, type = "predictor")
drop1(DAB_CEWL_LM_1)
car::Anova(DAB_CEWL_LM_1, type = "2")
```

The first variable to drop from the model is humidity. 

```{r}
DAB_CEWL_LM_2 <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 
                      Treatment *
                      Mother_CEWL +
                      Tb_CEWL_c_mean +
                      msmt_temp_C_mean +
                      VPD_kPa_mean)
                     
car::vif(DAB_CEWL_LM_2, type = "predictor")
drop1(DAB_CEWL_LM_2)
car::Anova(DAB_CEWL_LM_2, type = "2")
```


```{r}
DAB_CEWL_LM_3 <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 
                      Treatment *
                      Mother_CEWL +
                      Tb_CEWL_c_mean +
                      msmt_temp_C_mean)
                     
drop1(DAB_CEWL_LM_3)
car::Anova(DAB_CEWL_LM_3, type = "2")
```



```{r}
DAB_CEWL_LM_4 <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 
                      Treatment *
                      Mother_CEWL +
                      Tb_CEWL_c_mean)
                     
drop1(DAB_CEWL_LM_4)
car::Anova(DAB_CEWL_LM_4, type = "2")
```



```{r}
DAB_CEWL_LM_5 <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 
                      Treatment +
                      Mother_CEWL +
                      Tb_CEWL_c_mean)
                     
drop1(DAB_CEWL_LM_5)
car::Anova(DAB_CEWL_LM_5, type = "2")
```



```{r}
DAB_CEWL_LM_6 <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 
                      Mother_CEWL +
                      Tb_CEWL_c_mean)

drop1(DAB_CEWL_LM_6)
car::Anova(DAB_CEWL_LM_6, type = "2")
```


```{r}
DAB_CEWL_LM_7 <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 
                      Mother_CEWL)

car::Anova(DAB_CEWL_LM_7, type = "2")
```



Null model 
```{r}
DAB_CEWL_LM_null <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 1)
```



## Model Selection

```{r}
clutch_cewl_models_all <- list(DAB_CEWL_LM_2, 
                               DAB_CEWL_LM_3, 
                               DAB_CEWL_LM_4, 
                               DAB_CEWL_LM_5, 
                               DAB_CEWL_LM_6, 
                               DAB_CEWL_LM_7, 
                               DAB_CEWL_LM_null)

#specify model names
clutch_cewl_mod_names_all <- c('model2', 'model3',
                               'model4', 'model5',
                               'model6', 'model7',
                               'modelnull')

#calculate AIC of each model
clutch_cewl_AICc_all <- data.frame(aictab(cand.set = clutch_cewl_models_all, 
                                 modnames = clutch_cewl_mod_names_all))
clutch_cewl_AICc_all
```

So the top three equivalent models are 7, 6, & 5. 6/7 are almost exactly the same, with 5 trailing a bit behind.

Model 7 is clutch avg CEWL ~ mother CEWL. Model 6 adds clutch average body temperature at the time of measurement. Model 5 adds Tb and mother's treatment. However, Tb and mother's treatment did not have significant effects.


## Final Model

```{r}
DAB_CEWL_LM_BEST <- lm(data = dab_clutch_mom,
                      CEWL_g_m2h_mean ~ 
                      Mother_CEWL)

car::Anova(DAB_CEWL_LM_BEST, type = "2")
summary(DAB_CEWL_LM_BEST)
```


## Model Assumptions

Check linear regression assumptions/conditions:

```{r}
plot(DAB_CEWL_LM_BEST)
shapiro.test(residuals(DAB_CEWL_LM_BEST))
```









# DAB CEWL DIFFS


```{r}
DAB_CEWL_LMM_1 <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                      Treatment +
                      Tb_CEWL_c +
                      msmt_temp_C +
                      msmt_RH_percent +
                      VPD_kPa +
                        (1|Mother_ID))
                     
car::vif(DAB_CEWL_LMM_1)
drop1(DAB_CEWL_LMM_1)
car::Anova(DAB_CEWL_LMM_1, test = "F", type = "2")
```


```{r}
DAB_CEWL_LMM_1a <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                      Treatment +
                      Tb_CEWL_c +
                      msmt_temp_C +
                      VPD_kPa +
                        (1|Mother_ID))
                     
car::vif(DAB_CEWL_LMM_1a)
drop1(DAB_CEWL_LMM_1a)
car::Anova(DAB_CEWL_LMM_1a, test = "F", type = "2")
```




```{r}
DAB_CEWL_LMM_2 <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                      Tb_CEWL_c +
                      msmt_temp_C +
                      VPD_kPa +
                        (1|Mother_ID))
                     
summary(DAB_CEWL_LMM_2)
drop1(DAB_CEWL_LMM_2)
car::Anova(DAB_CEWL_LMM_2, test = "F", type = "2")
```


```{r}
DAB_CEWL_LMM_3 <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                      Tb_CEWL_c +
                      msmt_temp_C +
                        (1|Mother_ID))
                     
summary(DAB_CEWL_LMM_3)
drop1(DAB_CEWL_LMM_3)
car::Anova(DAB_CEWL_LMM_3, test = "F", type = "2")
```

```{r}
DAB_CEWL_LMM_4 <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                      msmt_temp_C +
                        (1|Mother_ID))
                     
drop1(DAB_CEWL_LMM_4)
car::Anova(DAB_CEWL_LMM_4, test = "F", type = "2")
```

```{r}
DAB_CEWL_LMM_NULL <- lme4::lmer(data = dab_all,
                      CEWL_g_m2h ~ 1 + (1|Mother_ID))
```



## Model Selection

```{r}
cewl_models_all <- list(DAB_CEWL_LMM_1a, DAB_CEWL_LMM_2, 
                        DAB_CEWL_LMM_3, DAB_CEWL_LMM_4,
                        DAB_CEWL_LMM_NULL)

#specify model names
cewl_mod_names_all <- c('model1', 
                    'model2', 
                    'model3',
                    'model4',
                    'modelnull')

#calculate AIC of each model
cewl_AICc_all <- data.frame(aictab(cand.set = cewl_models_all, 
                                 modnames = cewl_mod_names_all))
cewl_AICc_all
```


Models 1 and 2 are the best... which includes all variables Treatment + Tb_CEWL_c + msmt_temp_C + VPD_kPa




## Final Model + emmeans

```{r}
DAB_CEWL_LMM_BEST1 <- lmerTest::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                      Treatment +
                      Tb_CEWL_c +
                      msmt_temp_C +
                      VPD_kPa +
                        (1|Mother_ID))

summary(DAB_CEWL_LMM_BEST1)
car::Anova(DAB_CEWL_LMM_BEST1, test = "F", type = "2")

emmeans(DAB_CEWL_LMM_BEST1, pairwise ~ Treatment)
DAB_CEWL_emmeans <- emmeans(DAB_CEWL_LMM_BEST1, "Treatment")
DAB_CEWL_emmeans_CI <- tidy(confint(DAB_CEWL_emmeans))
```


```{r}
DAB_CEWL_LMM_BEST2 <- lmerTest::lmer(data = dab_all,
                      CEWL_g_m2h ~ 
                      Tb_CEWL_c +
                      msmt_temp_C +
                      VPD_kPa +
                        (1|Mother_ID))

summary(DAB_CEWL_LMM_BEST2)
car::Anova(DAB_CEWL_LMM_BEST2, test = "F", type = "2")
```

## Model Assumptions

```{r}
plot(DAB_CEWL_LMM_BEST2)
shapiro.test(residuals(DAB_CEWL_LMM_BEST2))
```

looks fine, but not great






# DAB osml clutch ~ mother


```{r}
DAB_osml_LM_1 <- lm(data = dab_clutch_mom,
                      Plasma_Osmol_Rep_mean_mean ~ 
                      Treatment *
                      (Mother_osml + Mother_Days_in_Treatment) +
                      Mass_g_mean)
                     
car::vif(DAB_osml_LM_1, type = "predictor")
drop1(DAB_osml_LM_1)
car::Anova(DAB_osml_LM_1, type = "2")
```


```{r}
DAB_osml_LM_2 <- lm(data = dab_clutch_mom,
                      Plasma_Osmol_Rep_mean_mean ~ 
                      Treatment * Mother_Days_in_Treatment +
                      Mother_osml + 
                      Mass_g_mean)
                     
drop1(DAB_osml_LM_2)
car::Anova(DAB_osml_LM_2, type = "2")
```


```{r}
DAB_osml_LM_3 <- lm(data = dab_clutch_mom,
                      Plasma_Osmol_Rep_mean_mean ~ 
                      Treatment * Mother_Days_in_Treatment +
                      Mother_osml)
                     
drop1(DAB_osml_LM_3)
car::Anova(DAB_osml_LM_3, type = "2")
```


```{r}
DAB_osml_LM_4 <- lm(data = dab_clutch_mom,
                      Plasma_Osmol_Rep_mean_mean ~ 
                      Treatment * Mother_Days_in_Treatment)
                     
drop1(DAB_osml_LM_4)
car::Anova(DAB_osml_LM_4, type = "2")
```


```{r}
DAB_osml_LM_5 <- lm(data = dab_clutch_mom,
                      Plasma_Osmol_Rep_mean_mean ~ 
                      Treatment + Mother_Days_in_Treatment)
                     
drop1(DAB_osml_LM_5)
car::Anova(DAB_osml_LM_5, type = "2")
```


```{r}
DAB_osml_LM_6 <- lm(data = dab_clutch_mom,
                      Plasma_Osmol_Rep_mean_mean ~ 
                      Treatment)

car::Anova(DAB_osml_LM_6, type = "2")
```


```{r}
DAB_osml_LM_null <- lm(data = dab_clutch_mom, Plasma_Osmol_Rep_mean_mean ~ 1)
```




## Model Selection

```{r}
clutch_osmol_models_all <- list(DAB_osml_LM_1, DAB_osml_LM_2, DAB_osml_LM_3, DAB_osml_LM_4, DAB_osml_LM_5, DAB_osml_LM_6, DAB_osml_LM_null)

#specify model names
clutch_osmol_mod_names_all <- c('model1', 
                    'model2', 
                    'model3',
                    'model4',
                    'model5',
                    'model6',
                    'modelnull')

#calculate AIC of each model
clutch_osmol_AICc_all <- data.frame(aictab(cand.set = clutch_osmol_models_all, 
                                 modnames = clutch_osmol_mod_names_all))
clutch_osmol_AICc_all
```


The best top/equivalent models are 5 (tmt + mother days in tmt), 6 (tmt only), and 4 (tmt * mother days in tmt).


## Final Model

```{r}
DAB_osml_LM_BEST <- lm(data = dab_clutch_mom,
                       Plasma_Osmol_Rep_mean_mean ~ 
                          Treatment)

car::Anova(DAB_osml_LM_BEST, type = "2")
summary(DAB_osml_LM_BEST)
```


```{r}
DAB_osml_LM_BEST_full <- lm(data = dab_clutch_mom,
                       Plasma_Osmol_Rep_mean_mean ~ 
                          Treatment * Mother_Days_in_Treatment)

car::Anova(DAB_osml_LM_BEST_full, type = "2")
summary(DAB_osml_LM_BEST_full)
```






## Model Assumptions


```{r}
plot(DAB_osml_LM_BEST)
plot(DAB_osml_LM_BEST_full)
```







# DAB OSML DIFFS


```{r}
DAB_OSMOL_LMM_1 <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Treatment + Mass_g +
                        (1|Mother_ID))
                     
drop1(DAB_OSMOL_LMM_1)
car::Anova(DAB_OSMOL_LMM_1, test = "F", type = "2")
```


```{r}
DAB_OSMOL_LMM_2 <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Treatment +
                        (1|Mother_ID))
```

```{r}
DAB_OSMOL_LMM_null <- lme4::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 1 + (1|Mother_ID))
```


## Model Selection

```{r}
osml_models_all <- list(DAB_OSMOL_LMM_1, DAB_OSMOL_LMM_2, DAB_OSMOL_LMM_null)

#specify model names
osml_mod_names_all <- c('model1', 
                    'model2', 
                    'modelnull')

#calculate AIC of each model
osml_AICc_all <- data.frame(aictab(cand.set = osml_models_all, 
                                 modnames = osml_mod_names_all))
osml_AICc_all
```


No difference between 1/2.




## Final Model + emmeans

```{r}
DAB_OSMOL_LMM_BEST <- lmerTest::lmer(data = dab_all,
                      Plasma_Osmol_Rep_mean ~ 
                      Treatment +
                        (1|Mother_ID))

summary(DAB_OSMOL_LMM_BEST)
car::Anova(DAB_OSMOL_LMM_BEST, test = "F", type = "2")

emmeans(DAB_OSMOL_LMM_BEST, pairwise ~ Treatment)
DAB_OSMOL_emmeans <- emmeans(DAB_OSMOL_LMM_BEST, "Treatment")
DAB_OSMOL_emmeans_CI <- tidy(confint(DAB_OSMOL_emmeans))
```









# PUB FIG 2 DAB

## Osmolality

```{r}
ggplot() +
  geom_pointrange(
    data = dab_all_clutch_avg,
    aes(
      x = Treatment,
      y = Plasma_Osmol_Rep_mean_mean,
      ymin = Plasma_Osmol_Rep_mean_min,
      ymax = Plasma_Osmol_Rep_mean_max,
      group = Mother_ID,
      color = Treatment,
      shape = Treatment
    ),
    position = position_jitter(width = 0.3),
    size = 0.2, linewidth = 0.3,
    alpha = 0.8,
    show.legend = FALSE
  ) +
  geom_errorbar(
    data = DAB_OSMOL_emmeans_CI,
    aes(x = Treatment, ymin = conf.low, ymax = conf.high,
        color = Treatment),
    width = 0.3
  ) +
  geom_point(
    data = DAB_OSMOL_emmeans_CI,
    aes(x = Treatment, y = estimate, 
        color = Treatment, shape = Treatment),
    size = 2.5
  ) +

  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  labs(
    x = NULL, 
    y = expression('Clutch Osmolality (mmol '*kg^-1*')'),
    color = "Treatment"
  ) +
  scale_y_continuous(
    limits = c(260, 360), 
    breaks = seq(260, 360, by = 20)
  ) +
  scale_x_discrete(labels = c("C" = "Control", "W" = "Hydration")) +
  
  theme(legend.position = "none") +
  
  # statistical labels
  annotate(geom = "text", x = 1.5, y = 340, label = "*", size = 6) -> dab_osml
  
dab_osml
```




## CEWL

```{r}
ggplot() +
  geom_pointrange(
    data = dab_all_clutch_avg,
    aes(
      x = Treatment,
      y = CEWL_g_m2h_mean,
      ymin = CEWL_g_m2h_min,
      ymax = CEWL_g_m2h_max,
      group = Mother_ID,
      color = Treatment,
      shape = Treatment
    ),
    position = position_jitter(width = 0.3),
    size = 0.2, linewidth = 0.3,
    alpha = 0.8,
    show.legend = FALSE
  ) +
  geom_errorbar(
    data = DAB_CEWL_emmeans_CI,
    aes(x = Treatment, ymin = conf.low, ymax = conf.high,
        color = Treatment),
    width = 0.3
  ) +
  geom_point(
    data = DAB_CEWL_emmeans_CI,
    aes(x = Treatment, y = estimate, 
        color = Treatment, shape = Treatment),
    size = 2.5
  ) +

  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  labs(
    x = NULL, 
    y = expression('CEWL (g '*m^-2*' '*h^-1*')'), 
    color = "Treatment"
  ) +
  scale_y_continuous(
    limits = c(4, 25), 
    breaks = seq(0, 30, by = 5)
  ) +
  scale_x_discrete(labels = c("C" = "Control", "W" = "Hydration")) +
  
  theme(legend.position = "none") +
  
  # statistical labels
  annotate(geom = "text", x = 1.5, y = 22, label = "NS", size = 2) -> dab_cewl
  
dab_cewl
```



## Arrange 


```{r}
set.seed(135) # to get a nice jitter: 10, 35, 44, 359, 135

ggarrange(
  dab_osml, dab_cewl,
  nrow = 2,
  ncol = 1,
  labels = c("A", "B"),
  align = "hv"
) -> dab_diffs

ggsave(
  filename = "Fig_neonate_dab_diffs.pdf",
  plot = dab_diffs,
  path = "./results_figures",
  device = "pdf",
  dpi = 600,
  units = "mm",
  width = 70,
  height = 150
)
```










# PUB FIG 3 CEWL CLUTCH ~ MOTHER



```{r}

```











# TMT EFFECTS


## Calculate Deltas

Only 3 individuals were for sure measured at the before and after time points, so the change from before to after cannot be calculated for individual neonates. 

```{r}
deltas_means <- dab_ps_compare_means %>%
  arrange(Mother_ID, timept) %>% 
  group_by(Mother_ID) %>%
  mutate(
    delta_mass = Mass_g_mean - lag(Mass_g_mean),
    delta_osml = Plasma_Osmol_Rep_mean_mean - lag(Plasma_Osmol_Rep_mean_mean),
    delta_CEWL = CEWL_g_m2h_mean - lag(CEWL_g_m2h_mean)
  ) 

deltas_befaft <- deltas_means %>% 
  ungroup() %>% 
  mutate(
    delta_mass = case_when(is.na(delta_mass) ~ 0, TRUE ~ delta_mass),
    delta_osml = case_when(is.na(delta_osml) ~ 0, TRUE ~ delta_osml),
    delta_CEWL = case_when(is.na(delta_CEWL) ~ 0, TRUE ~ delta_CEWL)
  )

deltas <- deltas_means %>%
  filter(complete.cases(delta_mass))

summary(deltas_befaft)
summary(deltas)
```


## MASS

```{r}
mass_lm_time_tmt <- lmerTest::lmer(data = dab_ps_compare, 
            Mass_g ~ timept * Treatment + (1|Mother_ID))

mass_means_time <- emmeans(mass_lm_time_tmt, 
                       pairwise ~ timept | Treatment)
mass_means_time$contrasts

mass_means_tmt <- emmeans(mass_lm_time_tmt, 
                       pairwise ~ Treatment | timept)
mass_means_tmt$contrasts

mass_means <- emmeans(mass_lm_time_tmt, "Treatment", by = "timept")
mass_lm_time_tmt_CI <- tidy(confint(mass_means))
#mass_lm_time_tmt_CI <- tidy(mass_means_time$emmeans) # either would work

car::Anova(mass_lm_time_tmt, test = "F", type = "2")
```



## MASS CHANGE

```{r}
delta_mass_lm <- lm(data = deltas, delta_mass ~ Treatment)

summary(delta_mass_lm)
car::Anova(delta_mass_lm, test = "F", type = "2")
emmeans(delta_mass_lm, pairwise ~ Treatment)
```




## OSML

```{r}
osml_lm_time_tmt <- lmerTest::lmer(data = dab_ps_compare, 
    Plasma_Osmol_Rep_mean ~ timept * Treatment + (1|Mother_ID))

osml_means_time <- emmeans(osml_lm_time_tmt, 
                       pairwise ~ timept | Treatment)
osml_means_time$contrasts

osml_means_tmt <- emmeans(osml_lm_time_tmt, 
                       pairwise ~ Treatment | timept)
osml_means_tmt$contrasts

osml_means <- emmeans(osml_lm_time_tmt, "Treatment", by = "timept")
osml_lm_time_tmt_CI <- tidy(confint(osml_means))

car::Anova(osml_lm_time_tmt, test = "F", type = "2")
```



## OSML CHANGE

```{r}
delta_osml_lm <- lm(data = deltas, delta_osml ~ Treatment)

summary(delta_osml_lm)
car::Anova(delta_osml_lm, test = "F", type = "2")
emmeans(delta_osml_lm, pairwise ~ Treatment)
```





## CEWL


```{r}
cewl_lm_time_tmt <- lmerTest::lmer(data = dab_ps_compare, 
          CEWL_g_m2h ~ timept * Treatment + (1|Mother_ID))

cewl_means_time <- emmeans(cewl_lm_time_tmt, 
                       pairwise ~ timept | Treatment)
cewl_means_time$contrasts

cewl_means_tmt <- emmeans(cewl_lm_time_tmt, 
                       pairwise ~ Treatment | timept)
cewl_means_tmt$contrasts

cewl_means <- emmeans(cewl_lm_time_tmt, "Treatment", by = "timept")
cewl_lm_time_tmt_CI <- tidy(confint(cewl_means))

car::Anova(cewl_lm_time_tmt, test = "F", type = "2")
```





## CEWL CHANGE 

```{r}
delta_cewl_lm <- lm(data = deltas, delta_CEWL ~ Treatment)

summary(delta_cewl_lm)
car::Anova(delta_cewl_lm, test = "F", type = "2")
emmeans(delta_cewl_lm, pairwise ~ Treatment)
```



































# PUB FIG 4


## mass raw

```{r}
ggplot() +
  geom_pointrange(
    data = dab_ps_compare_means,
    aes(
      x = timept,
      y = Mass_g_mean,
      ymin = Mass_g_mean-Mass_g_sd,
      ymax = Mass_g_mean+Mass_g_sd,
      group = Treatment,
      color = Treatment,
      shape = Treatment
    ),
    position = position_jitterdodge(jitter.width = 0.6, dodge.width = 0.6),
    size = 0.2, linewidth = 0.3,
    alpha = 0.6,
    show.legend = FALSE
  ) +
  geom_line(
    data = mass_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      group = Treatment, 
      color = Treatment
    ),
    position = position_dodge(width = 0.6)
  ) +
  geom_errorbar(
    data = mass_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      ymin = conf.low, ymax = conf.high, 
      group = Treatment, 
      color = Treatment
    ),
    width = 0.4,
    position = position_dodge(width = 0.6)
  ) +
  geom_point(
    data = mass_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      group = Treatment, 
      color = Treatment,
      shape = Treatment
    ),
    size = 2.5,
    position = position_dodge(width = 0.6)
  ) + 
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = "Treatment"
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = "Treatment"
  ) +
  scale_y_continuous(
    limits = c(10, 21), 
    breaks = c(10, 15, 20),
    name = "Mass (g)"
  ) + 
  scale_x_discrete(
    labels = c("DAB" = "At Birth", "PS" = "Post-Shed"),
    name = NULL
  ) +
  
  theme(legend.position = "none") +
  
  # statistical labels
  annotate(geom = "text", x = 1, y = 21, label = "NS", size = 2) +
  annotate(geom = "text", x = 2, y = 21, label = "NS", size = 2) +
  annotate(geom = "text", x = 2.5, y = 12.8, label = "*", size = 6, 
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2.5, y = 13.7, label = "*", size = 6,
           color = "royalblue4") -> neo_mass # save

neo_mass
```




## osmol raw

```{r}
ggplot() +
  geom_pointrange(
    data = dab_ps_compare_means,
    aes(
      x = timept,
      y = Plasma_Osmol_Rep_mean_mean,
      ymin = Plasma_Osmol_Rep_mean_mean-Plasma_Osmol_Rep_mean_sd,
      ymax = Plasma_Osmol_Rep_mean_mean+Plasma_Osmol_Rep_mean_sd,
      group = Treatment,
      color = Treatment,
      shape = Treatment
    ),
    position = position_jitterdodge(jitter.width = 0.6, dodge.width = 0.6),
    size = 0.2, linewidth = 0.3,
    alpha = 0.6,
    show.legend = FALSE
  ) +
  geom_line(
    data = osml_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      group = Treatment, 
      color = Treatment
    ),
    position = position_dodge(width = 0.6)
  ) +
  geom_errorbar(
    data = osml_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      ymin = conf.low, ymax = conf.high, 
      group = Treatment, 
      color = Treatment
    ),
    width = 0.4,
    position = position_dodge(width = 0.6)
  ) +
  geom_point(
    data = osml_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      group = Treatment, 
      color = Treatment,
      shape = Treatment
    ),
    size = 2.5,
    position = position_dodge(width = 0.6)
  ) + 
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = "Treatment"
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = "Treatment"
  ) +
  scale_y_continuous(
    limits = c(240, 410), 
    breaks = seq(200, 400, by = 50),
    name = expression('Osmolality (mmol '*kg^-1*')'),
  ) + 
  scale_x_discrete(
    labels = c("DAB" = "At Birth", "PS" = "Post-Shed"),
    name = NULL
  ) +
  
  theme(legend.position = "none") +
  
  # statistical labels
  annotate(geom = "text", x = 1, y = 405, label = "NS", size = 2) +
  annotate(geom = "text", x = 2, y = 400, label = "*", size = 6) +
  annotate(geom = "text", x = 2.5, y = 335, label = "*", size = 6, 
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2.5, y = 290, label = "NS", size = 2,
           color = "royalblue4") -> neo_osmol

neo_osmol
```







## cewl raw

```{r}
ggplot() +
  geom_pointrange(
    data = dab_ps_compare_means,
    aes(
      x = timept,
      y = CEWL_g_m2h_mean,
      ymin = CEWL_g_m2h_mean-CEWL_g_m2h_sd,
      ymax = CEWL_g_m2h_mean+CEWL_g_m2h_sd,
      group = Treatment,
      color = Treatment,
      shape = Treatment
    ),
    position = position_jitterdodge(jitter.width = 0.6, dodge.width = 0.6),
    size = 0.2, linewidth = 0.3,
    alpha = 0.6,
    show.legend = FALSE
  ) +
  geom_line(
    data = cewl_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      group = Treatment, 
      color = Treatment
    ),
    position = position_dodge(width = 0.6)
  ) +
  geom_errorbar(
    data = cewl_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      ymin = conf.low, ymax = conf.high,  
      group = Treatment, 
      color = Treatment
    ),
    width = 0.4,
    position = position_dodge(width = 0.6)
  ) +
  geom_point(
    data = cewl_lm_time_tmt_CI,
    aes(
      x = timept, y = estimate, 
      group = Treatment, 
      color = Treatment,
      shape = Treatment
    ),
    size = 2.5,
    position = position_dodge(width = 0.6)
  ) + 
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = "Treatment"
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = "Treatment"
  ) +
  scale_y_continuous(
    limits = c(5, 23), 
    breaks = seq(5, 20, by = 5),
    name = expression('CEWL (g '*m^-2*' '*h^-1*')')
  ) + 
  scale_x_discrete(
    labels = c("DAB" = "At Birth", "PS" = "Post-Shed"),
    name = NULL
  ) +
  
  theme(legend.position = "none") +
  
  # statistical labels
  annotate(geom = "text", x = 1, y = 22.5, label = "NS", size = 2) +
  annotate(geom = "text", x = 2, y = 22.5, label = "NS", size = 2) +
  annotate(geom = "text", x = 2.45, y = 15.5, label = "*", size = 6, 
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2.55, y = 15.5, label = "*", size = 6,
           color = "royalblue4") -> neo_cewl
  
neo_cewl
```






## change in mass

```{r}
ggplot(
  data = deltas_befaft, 
  aes(
    x = timept,
    y = delta_mass,
    group = Mother_ID,
    color = Treatment,
    shape = Treatment
  )) +
  geom_hline(yintercept = 0, linetype = 'dashed', color = "darkgray") +
  geom_point(size = 1.4, position = position_dodge(width = 0.1)) +
  geom_line(alpha = 0.4, position = position_dodge(width = 0.1)) +
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  scale_y_continuous(
    breaks = c(-3, -2, -1, 0),
    name = expression(Delta ~ 'Mass (g)')
  ) +
  scale_x_discrete(
    labels = c("DAB" = "At Birth", "PS" = "Post-Shed"),
    name = NULL
  ) +
  
  theme(legend.position = "inside",
        legend.position.inside = c(0.25, 0.2),
        legend.background = element_blank()) +
  
  # labels
  annotate(geom = "text", x = 2.3, y = -1.1, label = "*", size = 6, 
           color = "royalblue4") +
  annotate(geom = "text", x = 2.3, y = -2.1, label = "*", size = 6, 
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2, y = -0.5, label = "*", 
           size = 6) -> neo_change_mass
neo_change_mass
```







## change in osmol

```{r}
ggplot(
  data = deltas_befaft, 
  aes(
    x = timept,
    y = delta_osml,
    group = Mother_ID,
    color = Treatment,
    shape = Treatment
  )) +
  geom_hline(yintercept = 0, linetype = 'dashed', color = "darkgray") +
  geom_point(size = 1.4, position = position_dodge(width = 0.1)) +
  geom_line(alpha = 0.4, position = position_dodge(width = 0.1)) +
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  scale_y_continuous(
    breaks = c(-20, 0, 20, 40, 60, 80),
    name = expression(Delta ~ 'Osmolality (mmol '*kg^-1*')'),
  ) +
  scale_x_discrete(
    labels = c("DAB" = "At Birth", "PS" = "Post-Shed"),
    name = NULL
  ) +
  
  theme(legend.position = "inside",
        legend.position.inside = c(0.25, 0.8),
        legend.background = element_blank()) +
  
  # labels
  annotate(geom = "text", x = 2.3, y = -5, label = "NS", size = 2, 
           color = "royalblue4") +
  annotate(geom = "text", x = 2.3, y = 45, label = "*", size = 6, 
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2, y = 81, label = "*", 
           size = 6) -> neo_change_osml
neo_change_osml
```



## change in cewl

```{r}
ggplot(
  data = deltas_befaft, 
  aes(
    x = timept,
    y = delta_CEWL,
    group = Mother_ID,
    color = Treatment,
    shape = Treatment
  )) +
  geom_hline(yintercept = 0, linetype = 'dashed', color = "darkgray") +
  geom_point(size = 1.4, position = position_dodge(width = 0.1)) +
  geom_line(alpha = 0.4, position = position_dodge(width = 0.1)) +
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  scale_y_continuous(
    breaks = c(0, 5, 10),
    name = expression(Delta ~ 'CEWL (g '*m^-2*' '*h^-1*')')
  ) +
  scale_x_discrete(
    labels = c("DAB" = "At Birth", "PS" = "Post-Shed"),
    name = NULL
  ) +
  
  theme(legend.position = "inside",
        legend.position.inside = c(0.25, 0.8),
        legend.background = element_blank()) +
  
  # labels
  annotate(geom = "text", x = 2.25, y = 5, label = "*", size = 6,
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2.35, y = 5, label = "*", size = 6,
           color = "royalblue4") +
  annotate(geom = "text", x = 2, y = 11, label = "NS", 
           size = 2) -> neo_change_cewl
neo_change_cewl
```






## arrange


```{r}
ggarrange(
  neo_mass, neo_change_mass,
  neo_osmol, neo_change_osml,
  neo_cewl, neo_change_cewl,
  nrow = 3,
  ncol = 2,
  labels = c("A", "B", "C", "D", "E", "F"),
  align = "hv"
) -> neo_tmt_effects

ggsave(
  filename = "Fig4_neonate_tmt_effects.pdf",
  plot = neo_tmt_effects,
  path = "./results_figures",
  device = "pdf",
  dpi = 600,
  units = "mm",
  width = 150,
  height = 180
)
```



















