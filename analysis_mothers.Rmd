---
title: "Pregnant Female Data Analysis Colorado 2022"
author: "Robin Bedard & Savannah Weaver"
output: 
  rmdformats::html_clean:
    highlight: tango
    thumbnails: FALSE
    toc: TRUE
    toc_depth: 3
---


# Packages


```{r, include=FALSE}
knitr::opts_chunk$set(include = TRUE, message = FALSE, warning = FALSE)
```


```{r}
library("tidyverse") # for dplyr workflow + ggplot
library("rmdformats") # pretty Rmd format
library("lme4") # LMM
library("lmerTest") # LMM stats
library("car") # vif, anova
library("emmeans") # pairwise comparisons
library("broom") # clean stats presentation
library("AICcmodavg") # model selection
library("MuMIn") # GLMM R-squared
library("effects") # partial regression plots
library("ggpubr") # figure arranging & exporting
```






# Figure Formatting

```{r}
my_ggplot_theme <- theme_classic() + # start with a preset theme to make things easy
                     theme(axis.title = element_text(size = 10), # text size for axis labels
                           axis.text = element_text(size = 8, # text size for axis values
                                                    color = "black", # need to specifically set color
                                                    family = "sans"), # and family
                           legend.title = element_text(size = 8), # text size for the legend title
                           legend.text = element_text(size = 8), # text size for legend items
                           text = element_text(color = "black", # color for all text (except axis values)
                                               family = "sans") # family
                           )
```

Now, apply the theme. This sets the theme for the entire Rmd document.

```{r}
theme_set(my_ggplot_theme)
```











# Load & Tidy Data


## CEWL, Osml, Mass, SVL

```{r}
mother_data_all <- read_rds("data/mother_data_all.RDS")
```


## Birthing Timeline

This dataframe includes a column "Day Relative" which is the number of days, relative to the day they gave birth, that the measurements were taken.

```{r}
day_scale <- read_csv("data/day_relative_to_birth.csv")

day_scale_clean <- day_scale %>%
  mutate(IndivID = as.factor(str_trim(IndivID)),
         CEWLBloodCollectDate = as.Date(str_trim(CEWLBloodCollectDate),
                                         format = "%m/%d/%y"),
         DayRelativeToZero = as.numeric(DayRelativeToZero)
  ) %>%
  #rename all column names 
  dplyr::select(Indiv_ID = IndivID, 
                CEWL_Blood_Collect_Date = CEWLBloodCollectDate,
                Day_Relative = DayRelativeToZero) %>%
  fill(Indiv_ID)
```

## Tmt Timeline

First, uploading the CSV with the new column of days relative to number of days in hydration treatment.

```{r}
days_in_tmt <- read_csv("data/days_in_tmt.csv")

days_in_tmt_clean <- days_in_tmt %>%
  mutate(IndivID = as.factor(str_trim(IndivID)),
         CEWLBloodCollectDate = as.Date(str_trim(CEWLBloodCollectDate),
                                         format = "%m/%d/%y"),
         DaysInTrmt = as.numeric(DaysInTrmt),
         GaveBirth = as.factor(GaveBirth)
  ) %>%
  #rename all column names 
  dplyr::select(Indiv_ID = IndivID, 
                CEWL_Blood_Collect_Date = CEWLBloodCollectDate,
                Days_in_Treatment = DaysInTrmt, 
                Gave_Birth = GaveBirth)  %>%
  fill(Indiv_ID)
```



## Offspring


```{r}
neo_counts <- read_csv("data/neonate_count.csv", 
                       col_types = "fddd") %>% 
  mutate(
    total_embryos = (live_neonates+dead_at_birth+slugs),
    prop_live = live_neonates/total_embryos
  )
```





## Merge Dataframes


```{r}
mother_data_all_final_full <- mother_data_all %>% 
  left_join(day_scale_clean, 
            by = c("Indiv_ID", "CEWL_Blood_Collect_Date")) %>% 
  left_join(days_in_tmt_clean, 
            by = c("Indiv_ID", "CEWL_Blood_Collect_Date")) %>% 
  mutate(
    Hydration_Trmt = factor(Hydration_Trmt),
    e_s_kPa = 0.611 * exp((17.502*msmt_temp_C)/(msmt_temp_C + 240.97)), # saturation VP
    e_a_kPa = e_s_kPa*((msmt_RH_percent/100)), # actual VP
    VPD_kPa = e_s_kPa - e_a_kPa # VP deficit
  ) %>% 
  # fix a typo
  mutate(Tb_at_CEWL = case_when(Tb_at_CEWL > 70 ~ NA, TRUE ~ Tb_at_CEWL))

summary(mother_data_all_final_full)
sd(mother_data_all_final_full$Tb_at_CEWL, na.rm = T)

mother_data_all_final_full %>% 
  group_by(Indiv_ID) %>% 
  count() %>% 
  #filter(n == 4)
  summary()
  
mother_data_all_final_full %>% 
  filter(Indiv_ID %in% c(103, 115))

mother_data_all_final_full_noNA_temps <- mother_data_all_final_full %>% 
  filter(complete.cases(Tb_at_CEWL))
```






## Sub-dfs

First, making a dataframe with the snakes that did give birth. 

```{r}
birth_snakes <- mother_data_all_final_full %>%
  filter(Gave_Birth == "Y") %>% 
  # Robin removes this snake, but I don't remember why
  filter(Indiv_ID != 117) %>% 
  left_join(neo_counts, by = c("Indiv_ID" = "Mother_ID"))
summary(birth_snakes)
birth_snakes %>% 
  group_by(Indiv_ID, Hydration_Trmt) %>% 
  count() %>% 
  group_by(Hydration_Trmt) %>% 
  count()
unique(birth_snakes$Indiv_ID)
```


```{r}
birth_snakes_DAB <- birth_snakes %>% 
  filter(Preg_Stage == "DAB") %>% 
  select(
    Mother_ID = Indiv_ID,
    Mother_CEWL = CEWL_g_m2h,
    Mother_mass = Mass_g,
    Mother_SVL = SVL_cm,
    Mother_osml = Plasma_Osmol_Rep_mean,
    Mother_Days_in_Treatment = Days_in_Treatment
  )
write_rds(birth_snakes_DAB, "./data/mother_values.RDS")
```

Now, a dataframe with the snakes that did not give birth.

```{r}
no_birth_snakes <- mother_data_all_final_full %>%
  filter(Gave_Birth == "N")

summary(no_birth_snakes)

no_birth_snakes %>% 
  group_by(Indiv_ID, Hydration_Trmt) %>% 
  count() %>% 
  group_by(Hydration_Trmt) %>% 
  count()

unique(no_birth_snakes$Indiv_ID)
```

At capture measurements... I need a dataframe with only the baseline measurements. 

```{r}
mothers_baseline <- mother_data_all_final_full %>%
  filter(Preg_Stage == "DAC") #DAC= day after capture

mothers_baseline_noNA_temps <- mothers_baseline %>% 
  filter(complete.cases(Tb_at_CEWL))
summary(mothers_baseline_noNA_temps)
```







# Exp Info

```{r}
birth_snakes %>% 
  group_by(Indiv_ID) %>% 
  summarise(
    min_date = min(CEWL_Blood_Collect_Date),
    max_date = max(CEWL_Blood_Collect_Date)
  ) %>% 
  mutate(range = max_date - min_date) %>% 
  arrange(range)
no_birth_snakes %>% 
  group_by(Indiv_ID) %>% 
  summarise(
    min_date = min(CEWL_Blood_Collect_Date),
    max_date = max(CEWL_Blood_Collect_Date)
  ) %>% 
  mutate(range = max_date - min_date) %>% 
  arrange(range)

mother_data_all_final_full %>% 
  summarise(
    min_date = min(CEWL_Blood_Collect_Date),
    max_date = max(CEWL_Blood_Collect_Date)
  ) %>% 
  mutate(range = max_date - min_date)
```














# BASELINE CEWL (at capture)


```{r}
baseline_cewl_1 <- lme4::lmer(data = mothers_baseline,
                      CEWL_g_m2h ~
                        Tb_at_CEWL +
                        msmt_temp_C +
                        msmt_RH_percent +
                        VPD_kPa +
                        Mass_g +
                        SVL_cm +
                        (1|CEWL_Blood_Collect_Date))
                    
car::vif(baseline_cewl_1)
```

```{r}
baseline_cewl_1a <- lme4::lmer(data = mothers_baseline_noNA_temps,
                      CEWL_g_m2h ~
                        Tb_at_CEWL +
                        msmt_temp_C +
                        VPD_kPa +
                        Mass_g +
                        SVL_cm +
                        Plasma_Osmol_Rep_mean +
                        (1|CEWL_Blood_Collect_Date))
                    
car::vif(baseline_cewl_1a)
drop1(baseline_cewl_1a, na.rm = T)
anova(baseline_cewl_1a)
```


```{r}
baseline_cewl_2 <- lme4::lmer(data = mothers_baseline_noNA_temps,
                      CEWL_g_m2h ~
                        Tb_at_CEWL +
                        msmt_temp_C +
                        VPD_kPa +
                        Mass_g +
                        Plasma_Osmol_Rep_mean +
                        (1|CEWL_Blood_Collect_Date))
                    
drop1(baseline_cewl_2)
anova(baseline_cewl_2, test = "F", type = "2")
```


```{r}
baseline_cewl_3 <- lme4::lmer(data = mothers_baseline_noNA_temps,
                      CEWL_g_m2h ~
                        Tb_at_CEWL +
                        msmt_temp_C +
                        VPD_kPa +
                        Plasma_Osmol_Rep_mean +
                        (1|CEWL_Blood_Collect_Date))
                    
drop1(baseline_cewl_3)
anova(baseline_cewl_3, test = "F", type = "2")
```


```{r}
baseline_cewl_4 <- lme4::lmer(data = mothers_baseline_noNA_temps,
                      CEWL_g_m2h ~
                        msmt_temp_C +
                        VPD_kPa +
                        Plasma_Osmol_Rep_mean +
                        (1|CEWL_Blood_Collect_Date))
                    
drop1(baseline_cewl_4)
anova(baseline_cewl_4, test = "F", type = "2")
```


```{r}
baseline_cewl_5 <- lme4::lmer(data = mothers_baseline_noNA_temps,
                      CEWL_g_m2h ~
                        msmt_temp_C +
                        VPD_kPa +
                        (1|CEWL_Blood_Collect_Date))
                    
drop1(baseline_cewl_5)
```


```{r}
baseline_cewl_6 <- lme4::lmer(data = mothers_baseline_noNA_temps,
                      CEWL_g_m2h ~
                        msmt_temp_C +
                        (1|CEWL_Blood_Collect_Date))
                    
anova(baseline_cewl_6, test = "F", type = "2")
```


```{r}
baseline_cewl_null <- lme4::lmer(data = mothers_baseline_noNA_temps,
                      CEWL_g_m2h ~ 1 +
                        (1|CEWL_Blood_Collect_Date))
```


## Model selection


```{r}
baseline_cewl_mods <- list(baseline_cewl_1a, baseline_cewl_2, 
                           baseline_cewl_3, baseline_cewl_4,
                           baseline_cewl_5, baseline_cewl_6,
                           baseline_cewl_null)

#specify model names
baeline_cewl_mod_names_all <- c('model1', 
                    'model2',
                    'model3',
                    'model4',
                    'model5',
                    'model6',
                    'modelnull')

#calculate AIC of each model
cewl_AICc_all <- data.frame(aictab(cand.set = baseline_cewl_mods, 
                                 modnames = baeline_cewl_mod_names_all))
cewl_AICc_all
```




## Final model

Best model was 5 which included:

```{r}
baseline_final_mod <- lmerTest::lmer(data = mothers_baseline,
                      CEWL_g_m2h ~
                        msmt_temp_C +
                        VPD_kPa +
                        (1|CEWL_Blood_Collect_Date))

summary(baseline_final_mod)
r.squaredGLMM(baseline_final_mod)
anova(baseline_final_mod, test = "F", type = "2")
car::Anova(baseline_final_mod, test = "F", type = "2")
```










# Body Temperature


```{r}
Tb_Ta_lm <- lm(data = mother_data_all_final_full, Tb_at_CEWL~msmt_temp_C)

summary(Tb_Ta_lm)
```











# EXPERIMENTAL CEWL


Birthing timeline?

```{r}
CEWL_LMM_birth <- lme4::lmer(data = birth_snakes,
                      CEWL_g_m2h ~
                        Hydration_Trmt *
                        Days_in_Treatment +
                        Day_Relative +
                        Tb_at_CEWL +
                        msmt_temp_C +
                        VPD_kPa +
                        (1|Indiv_ID))

anova(CEWL_LMM_birth, type = "2")
```


Since day relative to birth is not significant, I can include all snakes in one model together. 

```{r}
CEWL_LMM_1 <- lme4::lmer(data = mother_data_all_final_full_noNA_temps,
                      CEWL_g_m2h ~
                        Hydration_Trmt *
                        Days_in_Treatment +
                        Tb_at_CEWL +
                        msmt_temp_C +
                        VPD_kPa +
                        (1|Indiv_ID))

car::vif(CEWL_LMM_1)
drop1(CEWL_LMM_1)
anova(CEWL_LMM_1, test = "F", type = "2")
```


```{r}
CEWL_LMM_2 <- lme4::lmer(data = mother_data_all_final_full_noNA_temps,
                      CEWL_g_m2h ~
                        Hydration_Trmt +
                        Days_in_Treatment +
                        Tb_at_CEWL +
                        msmt_temp_C +
                        VPD_kPa +
                        (1|Indiv_ID))
drop1(CEWL_LMM_2)
anova(CEWL_LMM_2, test = "F", type = "2")
```


```{r}
CEWL_LMM_3 <- lme4::lmer(data = mother_data_all_final_full_noNA_temps,
                      CEWL_g_m2h ~
                        Hydration_Trmt +
                        Days_in_Treatment +
                        msmt_temp_C +
                        VPD_kPa +
                        (1|Indiv_ID))
CEWL_LMM_3a <- lme4::lmer(data = mother_data_all_final_full_noNA_temps,
                      CEWL_g_m2h ~
                        Hydration_Trmt +
                        Tb_at_CEWL +
                        msmt_temp_C +
                        VPD_kPa +
                        (1|Indiv_ID))
drop1(CEWL_LMM_3)
drop1(CEWL_LMM_3a)
anova(CEWL_LMM_3, test = "F", type = "2")
anova(CEWL_LMM_3a)
```

```{r}
CEWL_LMM_4 <- lme4::lmer(data = mother_data_all_final_full_noNA_temps,
                      CEWL_g_m2h ~
                        Hydration_Trmt +
                        msmt_temp_C +
                        VPD_kPa +
                        (1|Indiv_ID))
CEWL_LMM_4a <- lme4::lmer(data = mother_data_all_final_full_noNA_temps,
                      CEWL_g_m2h ~
                        Hydration_Trmt +
                        Tb_at_CEWL +
                        VPD_kPa +
                        (1|Indiv_ID))

drop1(CEWL_LMM_4)
drop1(CEWL_LMM_4a)
anova(CEWL_LMM_4, test = "F", type = "2")
```


```{r}
CEWL_LMM_5 <- lme4::lmer(data = mother_data_all_final_full_noNA_temps,
                      CEWL_g_m2h ~
                        msmt_temp_C +
                        VPD_kPa +
                        (1|Indiv_ID))
CEWL_LMM_5a <- lme4::lmer(data = mother_data_all_final_full_noNA_temps,
                      CEWL_g_m2h ~
                        Tb_at_CEWL +
                        VPD_kPa +
                        (1|Indiv_ID))

drop1(CEWL_LMM_5)
drop1(CEWL_LMM_5a)
```


```{r}
CEWL_LMM_6 <- lme4::lmer(data = mother_data_all_final_full_noNA_temps,
                      CEWL_g_m2h ~
                        msmt_temp_C +
                        (1|Indiv_ID))
CEWL_LMM_6a <- lme4::lmer(data = mother_data_all_final_full_noNA_temps,
                      CEWL_g_m2h ~
                        Tb_at_CEWL +
                        (1|Indiv_ID))
```



```{r}
CEWL_LMM_null <- lme4::lmer(data = mother_data_all_final_full_noNA_temps,
                      CEWL_g_m2h ~ 1 +
                        (1|Indiv_ID))
```


## Model selection

```{r}
cewl_models_all <- list(CEWL_LMM_1, 
                        CEWL_LMM_2, 
                        CEWL_LMM_3, CEWL_LMM_3a, 
                        CEWL_LMM_4, CEWL_LMM_4a, 
                        CEWL_LMM_5, CEWL_LMM_5a, 
                        CEWL_LMM_6, CEWL_LMM_6a, 
                        CEWL_LMM_null)

#specify model names
cewl_mod_names_all <- c('model1', 
                    'model2', 
                    'model3', 'model3a',
                    'model4', 'model4a',
                    'model5', 'model5a',
                    'model6', 'model6a',
                    'modelnull')

#calculate AIC of each model
cewl_AICc_all <- data.frame(aictab(cand.set = cewl_models_all, 
                                 modnames = cewl_mod_names_all))
cewl_AICc_all
```



## Final model

The best model is model 4. Tb is dropped!! :O

**I believe that the boundary is singular is due to the very small amount of variation explained by the random effect**.
```{r}
CEWL_LMM_best <- lmerTest::lmer(data = mother_data_all_final_full,
                      CEWL_g_m2h ~
                        Hydration_Trmt +
                        msmt_temp_C +
                        VPD_kPa +
                        (1|Indiv_ID))

summary(CEWL_LMM_best)
anova(CEWL_LMM_best, test = "F", type = "2")
r.squaredGLMM(CEWL_LMM_best)
```



## Model assumptions

```{r}
plot(CEWL_LMM_best)
shapiro.test(residuals(CEWL_LMM_best))
```




## Partial Regression


```{r}
plot(effect("Hydration_Trmt", CEWL_LMM_best))
plot(effect("msmt_temp_C", CEWL_LMM_best))
plot(effect("VPD_kPa", CEWL_LMM_best))
```


```{r}
temp_effects_data <- summary(effect("msmt_temp_C", CEWL_LMM_best))

temp_effects_df <- data_frame(
  meanval = temp_effects_data$effect,
  lowCI = temp_effects_data$lower,
  highCI = temp_effects_data$upper
) %>% 
  mutate(msmt_temp_C = c(23, 24, 25, 26, 27))

temp_effects_df
```



```{r}
VPD_effects_data <- summary(effect("VPD_kPa", CEWL_LMM_best))

VPD_effects_df <- data_frame(
  meanval = VPD_effects_data$effect,
  lowCI = VPD_effects_data$lower,
  highCI = VPD_effects_data$upper
) %>% 
  mutate(VPD_kPa = c(1.5, 1.7, 1.9, 2.1, 2.3))

VPD_effects_df
```






# PUB FIGURE


## CEWL ~ temp


```{r}
ggplot() +
  geom_point(
    data = mother_data_all_final_full, 
    aes(x = msmt_temp_C, y = CEWL_g_m2h,
        color = Hydration_Trmt, shape = Hydration_Trmt)
    ) +
  geom_ribbon(
    data = temp_effects_df,
    aes(x = msmt_temp_C, ymin = lowCI, ymax = highCI),
    alpha = 0.2
  ) +
  geom_line(
    data = temp_effects_df,
    aes(x = msmt_temp_C, y = meanval),
    color = "black",
    linewidth = 1
  ) +
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  theme(
    legend.position = "inside",
    legend.position.inside = c(0.18, 0.85),
    legend.background = element_blank()
  ) +
  scale_x_continuous(
    name = "Ambient Temperature (\u00b0C)" # unicode for degree symbol
  ) +
  scale_y_continuous(
    breaks = c(0, 10, 20, 30),
    name = expression('CEWL (g '*m^-2*' '*h^-1*')')
  ) -> CEWL_temp_lm
CEWL_temp_lm
```





## CEWL ~ VPD

```{r}
ggplot() +
  geom_point(
    data = mother_data_all_final_full, 
    aes(x = VPD_kPa, y = CEWL_g_m2h,
        color = Hydration_Trmt, shape = Hydration_Trmt)
    ) +
  geom_ribbon(
    data = VPD_effects_df,
    aes(x = VPD_kPa, ymin = lowCI, ymax = highCI),
    alpha = 0.2
  ) +
  geom_line(
    data = VPD_effects_df,
    aes(x = VPD_kPa, y = meanval),
    color = "black",
    linewidth = 1
  ) +
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  theme(
    legend.position = "inside",
    legend.position.inside = c(0.18, 0.15),
    legend.background = element_blank()
  ) +
  scale_x_continuous(
    name = "Ambient Vapor Pressure Deficit (kPa)"
  ) +
  scale_y_continuous(
    breaks = c(0, 10, 20, 30),
    name = expression('CEWL (g '*m^-2*' '*h^-1*')')
  ) -> CEWL_VPD_lm
CEWL_VPD_lm
```






## arrange


```{r}
ggarrange(
  CEWL_temp_lm, CEWL_VPD_lm,
  nrow = 1,
  ncol = 2,
  labels = c("A", "B"),
  align = "hv"
) -> CEWL_lm_figs

ggsave(
  filename = "Fig2_mother_CEWL_temp_VPD.pdf",
  plot = CEWL_lm_figs,
  path = "./results_figures",
  device = "pdf",
  dpi = 600,
  units = "mm",
  width = 160,
  height = 60
)
ggsave(
  filename = "Fig2_mother_CEWL_temp_VPD.tiff",
  plot = CEWL_lm_figs,
  path = "./results_figures",
  device = "tiff",
  dpi = 600,
  units = "mm",
  width = 160,
  height = 60
)
```























# BASELINE OSMOL

check whether proximity to birthing date affected osmol:

```{r}
mothers_baseline_birthsnakes <- mothers_baseline %>%
  filter(Gave_Birth == "Y")

partur <- lm(data = mothers_baseline_birthsnakes, 
             Plasma_Osmol_Rep_mean ~ Day_Relative)

summary(partur)
car::Anova(partur, type = "2")
```
Day relative to birth was not significant. Will run all individuals in one model. 


```{r}
baseline_osmol_1 <- lme4::lmer(data = mothers_baseline,
                      Plasma_Osmol_Rep_mean ~
                        Mass_g +
                        SVL_cm +
                        (1|CEWL_Blood_Collect_Date))
summary(baseline_osmol_1)
drop1(baseline_osmol_1)
```
The capture date didn't account for any of the variance so first dropping the random effect.

```{r}
baseline_osmol_2 <- lm(data = mothers_baseline,
                      Plasma_Osmol_Rep_mean ~
                        Mass_g +
                        SVL_cm)
                    
drop1(baseline_osmol_2)
```


```{r}
baseline_osmol_3 <- lm(data = mothers_baseline,
                      Plasma_Osmol_Rep_mean ~
                        SVL_cm)
                    
anova(baseline_osmol_3)
```




```{r}
baseline_osmol_null <- lm(data = mothers_baseline,
                      Plasma_Osmol_Rep_mean ~ 1)
```

## Model selection

```{r}
baseline_osmol_mods <- list(baseline_osmol_2, 
                            baseline_osmol_3, 
                            baseline_osmol_null)

#specify model names
baeline_osmol_mod_names_all <- c('model2', 'model3', 'modelnull')

#calculate AIC of each model
cewl_AICc_all <- data.frame(aictab(cand.set = baseline_osmol_mods, 
                                 modnames = baeline_osmol_mod_names_all))
cewl_AICc_all
```

They are all equivalently bad.


## No Final Model

****Remember that birthing effecting osmolality, so we created two separate models for the snakes that gave birth and those that didn't. See both below. 








# EXP OSMOL - BIRTH MOTHERS

```{r}
BirthSnakes_LMM_0 <- lme4::lmer(data = birth_snakes,
                      Plasma_Osmol_Rep_mean ~
                        Hydration_Trmt *
                        (Days_in_Treatment + live_neonates) +
                        Day_Relative +
                        Mass_g +
                        SVL_cm +
                        (1|Indiv_ID))

car::vif(BirthSnakes_LMM_0)
```


```{r}
BirthSnakes_LMM_0.1 <- lme4::lmer(data = birth_snakes,
                      Plasma_Osmol_Rep_mean ~
                        Hydration_Trmt *
                        Days_in_Treatment + 
                        live_neonates +
                        Day_Relative +
                        Mass_g +
                        SVL_cm +
                        (1|Indiv_ID))

car::vif(BirthSnakes_LMM_0.1)
drop1(BirthSnakes_LMM_0.1)
```


```{r}
BirthSnakes_LMM_1 <- lme4::lmer(data = birth_snakes,
                      Plasma_Osmol_Rep_mean ~
                        Hydration_Trmt *
                        Days_in_Treatment + 
                        Day_Relative +
                        Mass_g +
                        SVL_cm +
                        (1|Indiv_ID))

drop1(BirthSnakes_LMM_1)
```


```{r}
BirthSnakes_LMM_2a <- lme4::lmer(data = birth_snakes,
                      Plasma_Osmol_Rep_mean ~
                        Hydration_Trmt *
                        Days_in_Treatment +
                        Day_Relative +
                        SVL_cm +
                        (1|Indiv_ID))

drop1(BirthSnakes_LMM_2a)

BirthSnakes_LMM_2 <- lme4::lmer(data = birth_snakes,
                      Plasma_Osmol_Rep_mean ~
                        Hydration_Trmt *
                        Days_in_Treatment +
                        Day_Relative +
                        (1|Indiv_ID))

drop1(BirthSnakes_LMM_2)
```


```{r}
BirthSnakes_LMM_3 <- lme4::lmer(data = birth_snakes,
                      Plasma_Osmol_Rep_mean ~
                        Hydration_Trmt *
                        Days_in_Treatment +
                        (1|Indiv_ID))
```

```{r}
BirthSnakes_LMM_4 <- lme4::lmer(data = birth_snakes,
                      Plasma_Osmol_Rep_mean ~
                        Hydration_Trmt + 
                        Days_in_Treatment +
                        (1|Indiv_ID))

drop1(BirthSnakes_LMM_4)
```


```{r}
BirthSnakes_LMM_5 <- lme4::lmer(data = birth_snakes,
                      Plasma_Osmol_Rep_mean ~
                        Days_in_Treatment +
                        (1|Indiv_ID))
```


```{r}
BirthSnakes_LMM_null<- lme4::lmer(data = birth_snakes,
                      Plasma_Osmol_Rep_mean ~ 1 +
                        (1|Indiv_ID))
```



## Model selection

```{r}
osmolarity_models <- list(BirthSnakes_LMM_0.1, BirthSnakes_LMM_1,
                          BirthSnakes_LMM_2a, BirthSnakes_LMM_2, 
                          BirthSnakes_LMM_3, BirthSnakes_LMM_4, 
                          BirthSnakes_LMM_5, BirthSnakes_LMM_null)

#specify model names
osmolarity_mod_names <- c('model0', 'model1', 
                    'model2a',  'model2', 
                    'model3',
                    'model4',
                    'model5',
                    'modelnull')

#calculate AIC of each model
osmolarity_AICc <- data.frame(aictab(cand.set = osmolarity_models, 
                                 modnames = osmolarity_mod_names))
osmolarity_AICc
```


## Final model


```{r}
BirthSnakes_LMM_best <- lmerTest::lmer(data = birth_snakes,
                      Plasma_Osmol_Rep_mean ~
                        Hydration_Trmt *
                        Days_in_Treatment +
                        Day_Relative +
                        (1|Indiv_ID))

summary(BirthSnakes_LMM_best)
r.squaredGLMM(BirthSnakes_LMM_best)
anova(BirthSnakes_LMM_best, test = "F", type = "2")
```


```{r}
tidy(emtrends(BirthSnakes_LMM_best, 
         "Hydration_Trmt", var = "Days_in_Treatment"))
pairs(emtrends(BirthSnakes_LMM_2, 
               "Hydration_Trmt", var = "Days_in_Treatment"))
```


## Model assumptions


```{r}
plot(BirthSnakes_LMM_best)
shapiro.test(residuals(BirthSnakes_LMM_best))
```










## Partial Regression


```{r}
plot(effect("Hydration_Trmt:Days_in_Treatment", 
            BirthSnakes_LMM_best), multiline = TRUE)
plot(effect("Day_Relative", BirthSnakes_LMM_best))
```


```{r}
int_effects_data <- summary(effect("Hydration_Trmt:Days_in_Treatment", BirthSnakes_LMM_best))

as.data.frame(int_effects_data$effect)
```





























# EXP OSMOL - NO BIRTH

```{r}
No_BirthSnakes_LMM_1 <- lme4::lmer(data = no_birth_snakes,
                      Plasma_Osmol_Rep_mean ~
                        Hydration_Trmt *
                        Days_in_Treatment +
                        Mass_g +
                        SVL_cm +
                        (1|Indiv_ID))

drop1(No_BirthSnakes_LMM_1)
anova(No_BirthSnakes_LMM_1)
```


```{r}
No_BirthSnakes_LMM_1a <- lme4::lmer(data = no_birth_snakes,
                      Plasma_Osmol_Rep_mean ~
                        Hydration_Trmt *
                        Days_in_Treatment +
                        SVL_cm +
                        (1|Indiv_ID))

drop1(No_BirthSnakes_LMM_1a)
```

```{r}
No_BirthSnakes_LMM_1b <- lme4::lmer(data = no_birth_snakes,
                      Plasma_Osmol_Rep_mean ~
                        Hydration_Trmt *
                        Days_in_Treatment +
                        (1|Indiv_ID))
```



```{r}
No_BirthSnakes_LMM_2 <- lme4::lmer(data = no_birth_snakes,
                      Plasma_Osmol_Rep_mean ~
                        Hydration_Trmt +
                        Days_in_Treatment +
                        (1|Indiv_ID))

drop1(No_BirthSnakes_LMM_2)
```


```{r}
No_BirthSnakes_LMM_3 <- lme4::lmer(data = no_birth_snakes,
                      Plasma_Osmol_Rep_mean ~
                        Hydration_Trmt +
                        (1|Indiv_ID))
summary(No_BirthSnakes_LMM_3) # raneff no longer explains any variation
```


```{r}
No_BirthSnakes_LMM_null <- lme4::lmer(data = no_birth_snakes,
                      Plasma_Osmol_Rep_mean ~ 1 +
                        (1|Indiv_ID))
```

## Model selection

```{r}
osmolarity_models_nb <- list(No_BirthSnakes_LMM_1, 
                             No_BirthSnakes_LMM_1a, No_BirthSnakes_LMM_1b, 
                          No_BirthSnakes_LMM_2, 
                          No_BirthSnakes_LMM_3, 
                          No_BirthSnakes_LMM_null)

#specify model names
osmolarity_mod_names_nb <- c('model1', 'model1a', 'model1b', 
                    'model2', 
                    'model3',
                    'modelnull')

#calculate AIC of each model
osmolarity_AICc_nb <- data.frame(aictab(cand.set = osmolarity_models_nb, 
                                 modnames = osmolarity_mod_names_nb))
osmolarity_AICc_nb
```




## Final model
Best model is 1b


```{r}
No_BirthSnakes_LMM_best <- lmerTest::lmer(data = no_birth_snakes,
                      Plasma_Osmol_Rep_mean ~
                        Hydration_Trmt *
                        Days_in_Treatment +
                        (1|Indiv_ID))

summary(No_BirthSnakes_LMM_best)
r.squaredGLMM(No_BirthSnakes_LMM_best)
anova(No_BirthSnakes_LMM_best, test = "F", type = "2")
```


```{r}
tidy(emtrends(No_BirthSnakes_LMM_best, 
         "Hydration_Trmt", var = "Days_in_Treatment"))
pairs(emtrends(No_BirthSnakes_LMM_best, 
               "Hydration_Trmt", var = "Days_in_Treatment"))
```


## Model assumptions

```{r}
plot(No_BirthSnakes_LMM_best)
shapiro.test(residuals(No_BirthSnakes_LMM_best))
```









# CEWL vs Osmolarity 


## All values

```{r}
cewl_osmol_lm <- lm(data = mother_data_all_final_full,
                    CEWL_g_m2h ~ Plasma_Osmol_Rep_mean)
summary(cewl_osmol_lm)

cewl_osmol_lm_2 <- lm(data = mother_data_all_final_full,
                    Plasma_Osmol_Rep_mean ~ CEWL_g_m2h)
summary(cewl_osmol_lm_2)
```


## Split by timing 

```{r}
mothers_DAC <- mother_data_all_final_full %>%
  filter(Preg_Stage == "DAC")

mothers_DAB <- mother_data_all_final_full %>%
  filter(Preg_Stage == "DAB")

mothers_1WAC <- mother_data_all_final_full %>%
  filter(Preg_Stage == "1WAC")
```


## Day after capture

```{r}
dac_lm <- lm(data = mothers_DAC, CEWL_g_m2h ~ Plasma_Osmol_Rep_mean)
summary(dac_lm)
anova(dac_lm)
```





## Day after birth

```{r}
dab_lm <- lm(data = mothers_DAB, CEWL_g_m2h ~ Plasma_Osmol_Rep_mean)
summary(dab_lm)
anova(dab_lm)
```

















# TMT EFFECTS

Use a subset of data to examine only the effect of supplemental hydration: compare maternal plasma osmolality, CEWL, and body mass recorded the day after capture versus measurements taken after one week in treatment.

Run LMM with individual ID as a random effect (2 obs per ind), followed by pairwise comparisons.

If a female gave birth within one week of capture, we used her at-birth measurements.


## Prep Data

```{r}
# mothers with 1wac msmts
have_1wac <- mother_data_all_final_full %>% 
  filter(Preg_Stage == "1WAC")
# mothers that did not have a 1wac msmt bc gave birth before then
missing_1wac <- mother_data_all_final_full %>% 
  filter(!(Indiv_ID %in% have_1wac$Indiv_ID))

# 20 indivuals with dac vs 1wac comparison
dacwac <- mother_data_all_final_full %>% 
  filter(Indiv_ID %in% have_1wac$Indiv_ID) %>% 
  filter(Preg_Stage %in% c("DAC", "1WAC"))

# 9 individuals with dac vs dab comparison
dacdab <- mother_data_all_final_full %>% 
  filter(Indiv_ID %in% missing_1wac$Indiv_ID) %>% 
  filter(Preg_Stage %in% c("DAC", "DAB")) %>% 
  # find out how long they were in tmt before parturition
  group_by(Indiv_ID) %>% 
  mutate(
    min_date = min(CEWL_Blood_Collect_Date),
    max_date = max(CEWL_Blood_Collect_Date),
    tmt_time_pre_birth = as.numeric(max_date - min_date)
  ) %>% 
  # remove 3 moms only in tmt 2d and 1 mom only in tmt 3d
  # 5 individuals with DAB msmts 5 or 7d after DAC msmts
  filter(tmt_time_pre_birth > 4) %>% 
  select(-min_date, -max_date, -tmt_time_pre_birth)

# both comparisons
tmt_befaft <- rbind(dacdab, dacwac) %>% 
  mutate(Preg_Stage = factor(Preg_Stage),
         tmt_timing = factor(case_when(Preg_Stage == "DAC" ~ "Before",
                                Preg_Stage == "DAB" ~ "After",
                                Preg_Stage == "1WAC" ~ "After"),
                             levels = c("Before", "After")))
summary(tmt_befaft)

# check all individuals have 2 values
tmt_befaft %>% 
  group_by(Indiv_ID) %>% 
  count()
```


```{r}
# changes in vars
deltas_raw <- tmt_befaft %>%
  arrange(Indiv_ID, CEWL_Blood_Collect_Date) %>% 
  group_by(Indiv_ID) %>%
  mutate(
    delta_mass = Mass_g - lag(Mass_g),
    delta_osml = Plasma_Osmol_Rep_mean - lag(Plasma_Osmol_Rep_mean),
    delta_CEWL = CEWL_g_m2h - lag(CEWL_g_m2h)
  ) 

deltas_befaft <- deltas_raw %>% 
  ungroup() %>% 
  mutate(
    delta_mass = case_when(is.na(delta_mass) ~ 0, TRUE ~ delta_mass),
    delta_osml = case_when(is.na(delta_osml) ~ 0, TRUE ~ delta_osml),
    delta_CEWL = case_when(is.na(delta_CEWL) ~ 0, TRUE ~ delta_CEWL)
  )

deltas <- deltas_raw %>%
  filter(complete.cases(delta_mass))

summary(deltas)
```




only use mass for the snakes that did not give birth in the first week of the experiment:

```{r}
deltas_mass_only <- deltas %>% 
  filter(Preg_Stage == "1WAC") %>% 
  # remove a for sure error
  filter(delta_mass < 200)
deltas_befaft_mass_only <- deltas_befaft %>% 
  filter(Indiv_ID %in% deltas_mass_only$Indiv_ID)
tmt_befaft_mass_only <- tmt_befaft %>% 
  filter(Indiv_ID %in% deltas_mass_only$Indiv_ID)
```




## MASS 



```{r}
mass_lm_time_tmt <- lmerTest::lmer(data = tmt_befaft_mass_only, 
            Mass_g ~ tmt_timing * Hydration_Trmt + (1|Indiv_ID))

mass_means_time <- emmeans(mass_lm_time_tmt, 
                       pairwise ~ tmt_timing | Hydration_Trmt)
mass_means_time$contrasts

mass_means_tmt <- emmeans(mass_lm_time_tmt, 
                       pairwise ~ Hydration_Trmt | tmt_timing)
mass_means_tmt$contrasts

mass_means <- emmeans(mass_lm_time_tmt, "Hydration_Trmt", by = "tmt_timing")
mass_lm_time_tmt_CI <- tidy(confint(mass_means))
#mass_lm_time_tmt_CI <- tidy(mass_means_time$emmeans) # either would work

anova(mass_lm_time_tmt, type = "2")
```




## MASS CHANGE

```{r}
delta_mass_lm <- lm(data = deltas_mass_only, delta_mass ~ Hydration_Trmt)

summary(delta_mass_lm)
car::Anova(delta_mass_lm, type = "2")
emmeans(delta_mass_lm, pairwise ~ Hydration_Trmt)
```















## OSMOLALITY


```{r}
osml_lm_time_tmt <- lmerTest::lmer(data = tmt_befaft, 
    Plasma_Osmol_Rep_mean ~ tmt_timing * Hydration_Trmt + (1|Indiv_ID))

osml_means_time <- emmeans(osml_lm_time_tmt, 
                       pairwise ~ tmt_timing | Hydration_Trmt)
osml_means_time$contrasts

osml_means_tmt <- emmeans(osml_lm_time_tmt, 
                       pairwise ~ Hydration_Trmt | tmt_timing)
osml_means_tmt$contrasts

osml_means <- emmeans(osml_lm_time_tmt, "Hydration_Trmt", by = "tmt_timing")
osml_lm_time_tmt_CI <- tidy(confint(osml_means))

anova(osml_lm_time_tmt, type = "2")
```






## OSMOL CHANGE

```{r}
delta_osml_lm <- lm(data = deltas, delta_osml ~ Hydration_Trmt)

summary(delta_osml_lm)
car::Anova(delta_osml_lm, type = "2")
emmeans(delta_osml_lm, pairwise ~ Hydration_Trmt)
```















## CEWL 


```{r}
cewl_lm_time_tmt <- lmerTest::lmer(data = tmt_befaft, 
          CEWL_g_m2h ~ tmt_timing * Hydration_Trmt + (1|Indiv_ID))

cewl_means_time <- emmeans(cewl_lm_time_tmt, 
                       pairwise ~ tmt_timing | Hydration_Trmt)
cewl_means_time$contrasts

cewl_means_tmt <- emmeans(cewl_lm_time_tmt, 
                       pairwise ~ Hydration_Trmt | tmt_timing)
cewl_means_tmt$contrasts

cewl_means <- emmeans(cewl_lm_time_tmt, "Hydration_Trmt", by = "tmt_timing")
cewl_lm_time_tmt_CI <- tidy(confint(cewl_means))
#cewl_lm_time_tmt_CI <- tidy(cewl_means_time$emmean)

anova(cewl_lm_time_tmt, type = "2")
```






## CEWL CHANGE

```{r}
delta_cewl_lm <- lm(data = deltas, delta_CEWL ~ Hydration_Trmt)

summary(delta_cewl_lm)
car::Anova(delta_cewl_lm, type = "2")
emmeans(delta_cewl_lm, pairwise ~ Hydration_Trmt)
```







































# PUBLICATION FIGURE 1


## mass raw

```{r}
ggplot() +
  geom_point(
    data = tmt_befaft_mass_only,
    aes(
    x = tmt_timing,
    y = Mass_g,
    color = Hydration_Trmt,
    shape = Hydration_Trmt
  ),
    size = 1.1, 
    alpha = 0.5, 
    position = position_jitterdodge(jitter.width = 0.6, dodge.width = 0.6)
  ) +
  geom_line(
    data = mass_lm_time_tmt_CI,
    aes(
      x = tmt_timing, y = estimate, 
      group = Hydration_Trmt, 
      color = Hydration_Trmt
    ),
    position = position_dodge(width = 0.6)
  ) +
  geom_errorbar(
    data = mass_lm_time_tmt_CI,
    aes(
      x = tmt_timing, y = estimate, 
      ymin = conf.low, ymax = conf.high, 
      group = Hydration_Trmt, 
      color = Hydration_Trmt
    ),
    width = 0.4,
    position = position_dodge(width = 0.6)
  ) +
  geom_point(
    data = mass_lm_time_tmt_CI,
    aes(
      x = tmt_timing, y = estimate, 
      group = Hydration_Trmt, 
      color = Hydration_Trmt,
      shape = Hydration_Trmt
    ),
    size = 2.5,
    position = position_dodge(width = 0.6)
  ) + 
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  labs(
    x = NULL, 
    y = "Mass (g)", 
    color = "Treatment"
  ) +
  scale_y_continuous(
    limits = c(295, 700), 
    breaks = seq(300, 700, by = 100)
  ) + 
  
  theme(legend.position = "none") +
  
  # statistical labels
  annotate(geom = "text", x = 1, y = 692, label = "NS", size = 2) +
  annotate(geom = "text", x = 2, y = 692, label = "NS", size = 2) +
  #annotate(geom = "text", x = 2, y = 685, label = "*", size = 6) +
  annotate(geom = "text", x = 2.5, y = 440, label = "*", size = 6, 
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2.5, y = 490, label = "*", size = 6,
           color = "royalblue4") -> mother_mass_all # save

mother_mass_all
```




## osmol raw

```{r}
ggplot() +
  geom_point(
    data = tmt_befaft,
    aes(
    x = tmt_timing,
    y = Plasma_Osmol_Rep_mean,
    color = Hydration_Trmt,
    shape = Hydration_Trmt
  ),
    size = 1.1, 
    alpha = 0.5, 
    position = position_jitterdodge(jitter.width = 0.6, dodge.width = 0.6)
  ) +
  geom_line(
    data = osml_lm_time_tmt_CI,
    aes(
      x = tmt_timing, y = estimate, 
      group = Hydration_Trmt, 
      color = Hydration_Trmt
    ),
    position = position_dodge(width = 0.6)
  ) +
  geom_errorbar(
    data = osml_lm_time_tmt_CI,
    aes(
      x = tmt_timing, y = estimate, 
      ymin = conf.low, ymax = conf.high, 
      group = Hydration_Trmt, 
      color = Hydration_Trmt
    ),
    width = 0.4,
    position = position_dodge(width = 0.6)
  ) +
  geom_point(
    data = osml_lm_time_tmt_CI,
    aes(
      x = tmt_timing, y = estimate, 
      group = Hydration_Trmt, 
      color = Hydration_Trmt,
      shape = Hydration_Trmt
    ),
    size = 2.5,
    position = position_dodge(width = 0.6)
  ) + 
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  labs(
    x = NULL, 
    y = expression('Osmolality (mmol '*kg^-1*')'),
    color = "Treatment"
  ) +
  scale_y_continuous(
    limits = c(295, 382), 
    breaks = seq(280, 380, by = 20)
  ) + 
  
  theme(legend.position = "none") +
  
  # statistical labels
  annotate(geom = "text", x = 1, y = 373, label = "*", size = 6) +
  annotate(geom = "text", x = 2, y = 373, label = "*", size = 6) +
  annotate(geom = "text", x = 2.5, y = 336, label = "*", size = 6, 
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2.5, y = 317, label = "*", size = 6,
           color = "royalblue4") -> mother_osmolality_all

mother_osmolality_all
```







## cewl raw

```{r}
ggplot() +
  geom_point(
    data = tmt_befaft,
    aes(
    x = tmt_timing,
    y = CEWL_g_m2h,
    color = Hydration_Trmt,
    shape = Hydration_Trmt
  ),
    size = 1.1, 
    alpha = 0.5, 
    position = position_jitterdodge(jitter.width = 0.6, dodge.width = 0.6)
  ) +
  geom_line(
    data = cewl_lm_time_tmt_CI,
    aes(
      x = tmt_timing, y = estimate, 
      group = Hydration_Trmt, 
      color = Hydration_Trmt
    ),
    position = position_dodge(width = 0.6)
  ) +
  geom_errorbar(
    data = cewl_lm_time_tmt_CI,
    aes(
      x = tmt_timing, y = estimate, 
      ymin = conf.low, ymax = conf.high,  
      group = Hydration_Trmt, 
      color = Hydration_Trmt
    ),
    width = 0.4,
    position = position_dodge(width = 0.6)
  ) +
  geom_point(
    data = cewl_lm_time_tmt_CI,
    aes(
      x = tmt_timing, y = estimate, 
      group = Hydration_Trmt, 
      color = Hydration_Trmt,
      shape = Hydration_Trmt
    ),
    size = 2.5,
    position = position_dodge(width = 0.6)
  ) + 
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  labs(
    x = NULL, 
    y = expression('CEWL (g '*m^-2*' '*h^-1*')'), 
    color = "Treatment"
  ) +
  scale_y_continuous(
    limits = c(9, 32), 
    breaks = seq(10, 30, by = 5)
  ) + 
  
  theme(legend.position = "none") +
  
  # statistical labels
  annotate(geom = "text", x = 1, y = 31, label = "NS", size = 2) +
  annotate(geom = "text", x = 2, y = 31, label = "NS", size = 2) +
  annotate(geom = "text", x = 2.45, y = 15, label = "*", size = 6,
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2.55, y = 15, label = "*", size = 6,
           color = "royalblue4") -> mother_cewl_all
  
mother_cewl_all
```






## change in mass

```{r}
ggplot(
  data = deltas_befaft_mass_only, 
  aes(
    x = tmt_timing,
    y = delta_mass,
    group = Indiv_ID,
    color = Hydration_Trmt,
    shape = Hydration_Trmt
  )) +
  geom_hline(yintercept = 0, linetype = 'dashed', color = "darkgray") +
  geom_point(size = 1.4, position = position_dodge(width = 0.1)) +
  geom_line(alpha = 0.4, position = position_dodge(width = 0.1)) +
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  labs(
    x = NULL, 
    y = expression(Delta ~ 'Mass (g)'), 
    color = "Treatment"
  ) +
  scale_y_continuous(
    limits = c(-45, 62),
    breaks = c(-45, -30, -15, 0, 15, 30, 45, 60)
  ) +
  
  theme(legend.position = "inside",
        legend.position.inside = c(0.25, 0.15),
        legend.background = element_blank()) +
  
  # labels
  annotate(geom = "text", x = 2.3, y = 20, label = "*", size = 6, 
           color = "royalblue4") +
  annotate(geom = "text", x = 2.3, y = -20, label = "*", size = 6, 
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2, y = 60, label = "*", 
           size = 6) -> mother_change_mass
mother_change_mass
```







## change in osmol

```{r}
ggplot(
  data = deltas_befaft, 
  aes(
    x = tmt_timing,
    y = delta_osml,
    group = Indiv_ID,
    color = Hydration_Trmt,
    shape = Hydration_Trmt
  )) +
  geom_hline(yintercept = 0, linetype = 'dashed', color = "darkgray") +
  geom_point(size = 1.4, position = position_dodge(width = 0.1)) +
  geom_line(alpha = 0.4, position = position_dodge(width = 0.1)) +
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  labs(
    x = NULL, 
    y = expression(Delta ~ 'Osmolality (mmol '*kg^-1*')'),
    color = "Treatment"
  ) +
  scale_y_continuous(
    limits = c(-53, 45),
    breaks = c(-45, -30, -15, 0, 15, 30, 45)
  ) +
  
  theme(legend.position = "inside",
        legend.position.inside = c(0.25, 0.85),
        legend.background = element_blank()) +
  
  # labels
  annotate(geom = "text", x = 2.3, y = -30, label = "*", size = 6, 
           color = "royalblue4") +
  annotate(geom = "text", x = 2.3, y = 20, label = "*", size = 6, 
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2, y = 42, label = "*", 
           size = 6) -> mother_change_osml
mother_change_osml
```



## change in cewl

```{r}
ggplot(
  data = deltas_befaft, 
  aes(
    x = tmt_timing,
    y = delta_CEWL,
    group = Indiv_ID,
    color = Hydration_Trmt,
    shape = Hydration_Trmt
  )) +
  geom_hline(yintercept = 0, linetype = 'dashed', color = "darkgray") +
  geom_point(size = 1.4, position = position_dodge(width = 0.1)) +
  geom_line(alpha = 0.4, position = position_dodge(width = 0.1)) +
  
  # prettys 
  scale_color_manual(
    values = c("darkgoldenrod2", "royalblue4"), 
    labels = c("C" = "Control", "W" = "Hydration"), 
    name = NULL
  ) +
  scale_shape_manual(
    values = c(15, 17), 
    labels = c("C" = "Control", "W" = "Hydration"),
    name = NULL
  ) +
  labs(
    x = NULL, 
    y = expression(Delta ~ 'CEWL (g '*m^-2*' '*h^-1*')'),
    color = "Treatment"
  ) +
  scale_y_continuous(
    limits = c(-17, 5),
    breaks = c(-15, -10, -5, 0, 5, 10)
  ) +
  
  theme(legend.position = "inside",
        legend.position.inside = c(0.25, 0.15),
        legend.background = element_blank()) +
  
  # labels
  annotate(geom = "text", x = 2.25, y = -8, label = "*", size = 6,
           color = "darkgoldenrod2") +
  annotate(geom = "text", x = 2.35, y = -8, label = "*", size = 6,
           color = "royalblue4") +
  annotate(geom = "text", x = 2, y = 4.7, label = "NS", 
           size = 2) -> mother_change_cewl
mother_change_cewl
```






## arrange


```{r}
ggarrange(
  mother_mass_all, mother_change_mass,
  mother_osmolality_all, mother_change_osml,
  mother_cewl_all, mother_change_cewl,
  nrow = 3,
  ncol = 2,
  labels = c("A", "B", "C", "D", "E", "F"),
  align = "hv"
) -> mother_tmt_effects

ggsave(
  filename = "Fig1_mother_tmt_effects.pdf",
  plot = mother_tmt_effects,
  path = "./results_figures",
  device = "pdf",
  dpi = 600,
  units = "mm",
  width = 160,
  height = 180
)
ggsave(
  filename = "Fig1_mother_tmt_effects.tiff",
  plot = mother_tmt_effects,
  path = "./results_figures",
  device = "tiff",
  dpi = 600,
  units = "mm",
  width = 160,
  height = 180
)
```


























