---
title: "Neonate Analysis Colorado 2022"
author: "Robin Bedard"
date: '2023-01-11'
output: pdf_document
---
```{r}
`%nin%` = Negate(`%in%`)
library("ggplot2")
library("ggpubr")
library("lme4")
library("dplyr")
library("tidyverse")
library("stringr")
library("tidyr")
library("PerformanceAnalytics")
library("lmerTest")
library("readr")
library("AICcmodavg")
library("emmeans")
```

This includes the analysis for the neonates day after birth and dat after they shed. 

#NEONATES DAY AFTER BIRTH
##Cleaning and Organizing
Reading in the data and merging the data sets. This includes all cewl data, osmolarity data, and all measurements.
```{r}
setwd("/Users/robinbedard/Desktop/Old Work/Thesis/RDS_files")
#reading in the file of osmolarities for all neonates
neonate_dab_osmol <- readRDS("clean_Neonate_DAB_Osmolality.RDS")
#reading in all other body measurements of neonates
neonate_dab_all <- readRDS("FinalNeonateDAB.RDS")
#joining them together to create 1 df
neonate_dab_all_final <- left_join(neonate_dab_all, neonate_dab_osmol, by = c("CEWL_Blood_Collect_Date", "Indiv_ID"))
#reading in CEWL data
all_data_CEWL <- readRDS("CEWL_data_all_clean.RDS")
#merging all together
neonate_dab_all_final <- left_join(neonate_dab_all_final, all_data_CEWL, by = c("Indiv_ID" = "individual_ID", "CEWL_Blood_Collect_Date" = "date"))
```

```{r}
neonate_dab_all_final <- neonate_dab_all_final[-77, ]
```


##Body Temperature Calibration
First, uploading the thermocouple calibration csv and the thermocouple reference csv. Join them together.
```{r}
setwd("/Users/robinbedard/Desktop/Old Work/Thesis/csv files")
thermo_c <- read.csv("thermoc_calibration.csv")
thermo_coupl <- thermo_c %>%
  dplyr::select(Time, Value) %>% 
  mutate(Time = as.POSIXct(substr(Time, 1,5), format = "%H:%M"))

thermo_ref <- read.csv("thermalcouple_c_reference.csv") %>% 
  mutate(Time = as.POSIXct(Time, format = "%H:%M"))

thermo_c_final <- left_join(thermo_coupl, thermo_ref, by = "Time")
```

Now calibrate the data
```{r}
#Calibrate Thermocouple Data
#First, calculate and save regression curves:
# calculate regression curves
regression_a <- lm(data = thermo_c_final,
                   Value ~ Temp)

# create df to store calibration equations
TC_calibration <- data.frame(TC_A = (coef(regression_a))) %>%
  `rownames<-`(c("intercept", "slope"))

#Next, use calibration curves to correct the data we measured:
# this applies respective calibration equation
# to all cloacal thermocouple data points of that proper thermocouple
# 2=slope & 1=intercept

neonate_dab_all_final <- neonate_dab_all_final %>%
  mutate(calibrated_cloacal_temp = Tb_CEWL_c*TC_calibration$TC_A[2] +
           TC_calibration$TC_A[1])

summary(neonate_dab_all_final)
```
Now I have a new column with the calibrated cloacal temperature at the time the measurement was taken. 
Fixing a mistake in the SVL. One individual has a SVL of 2.4 but it should be 24.0
```{r}
neonate_dab_all_final[53, 4] <- 24.0
```
##Body Condition
```{r}
neonate_dab_all_final_temp <- neonate_dab_all_final %>%
  mutate(log_Mass = log10(Mass_g)) %>%
  mutate(log_SVL = log10(SVL_cm))

ggplot(data = neonate_dab_all_final_temp, aes(x = log_SVL, y = log_Mass)) +
  geom_point()

bc_lm <- lm(data = neonate_dab_all_final_temp, log_Mass ~ log_SVL)
neonate_dab_all_final_temp$Body_Condition <- bc_lm$resid
```
##Creating clutch averages
Creating clutch averages for CEWL, Osmolarity, body temps, ambient temps, humidity. Since the neonates are technically replicates to get one value per mother, we have to average them 

Creating a new column with the averages of osmolarities in a clutch so the neonates are replicates. Then will add this to the mother analysis data frame. 
```{r}
neonate_dab_all_final2 <- neonate_dab_all_final_temp %>%                                  
  group_by(Mother_ID) %>%
  mutate(clutch_osmol_avg = mean(Plasma_Osmol_Rep_mean, na.rm = TRUE))
```

Creating a new column with the averages of CEWL, pee, body temps, ambient temps, humidity, SMI, Mass, and SVL in a clutch so the neonates are replicates. Then will add this to the mother analysis data frame
```{r}
neonate_dab_all_final3 <- neonate_dab_all_final2 %>%                                  
  group_by(Mother_ID) %>%
  mutate(clutch_CEWL_avg = mean(CEWL_g_m2h, na.rm = TRUE))

neonate_dab_all_final4 <- neonate_dab_all_final3 %>%
  mutate(Pee = as.factor(str_trim(Pee)))

neonate_dab_all_final5 <- neonate_dab_all_final4 %>%                                  
  group_by(Mother_ID) %>%
  mutate(Prop_Pee = sum(Pee == "Y")/sum(Pee == "Y" | Pee == "N"))

neonate_dab_all_final6 <- neonate_dab_all_final5 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_bodytemp_avg = mean(calibrated_cloacal_temp, na.rm = TRUE))

neonate_dab_all_final7 <- neonate_dab_all_final6 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_ambienttemp_avg = mean(msmt_temp_C, na.rm = TRUE))

neonate_dab_all_final8 <- neonate_dab_all_final7 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_ambienthumidity_avg = mean(msmt_RH_percent, na.rm = TRUE))

neonate_dab_all_final9 <- neonate_dab_all_final8 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_SVL_avg = mean(SVL_cm, na.rm = TRUE))

neonate_dab_all_final10 <- neonate_dab_all_final9 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_Mass_avg = mean(Mass_g, na.rm = TRUE))

neonate_dab_all_final11 <- neonate_dab_all_final10 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_BodyCond_avg = mean(Body_Condition, na.rm = TRUE))
```

Making a dataframe that only has the relevant variables. Now there is only one value for each mother. This is what we want. 
```{r}
clutch_averages <- unique(neonate_dab_all_final11[ , c(8, 9, 21, 22, 23, 24, 25, 26, 27, 28, 29)])
summary(clutch_averages)

saveRDS(clutch_averages, "/Users/robinbedard/Desktop/Old Work/Thesis/RDS_files/clutch_averages_RDS")
```

Adding a column for if neonates have shed (all no here)
```{r}
clutch_averages2 <- clutch_averages %>%
  mutate(Shed = "N")
```

This dataframe is now ready. I need to add the information from the post shed neonates. 

#NEONATES POST SHED
Uploading Data
```{r}
neonate_postshed_clean <- readRDS("neonate_postshed_clean.RDS")
```

##Osmolarity Wrangling
I need to create a df with only the relevant osmolarity data information and a df with all other columns, save them both as RDS, then do the osmolarity wrangling. 

```{r}
neonate_postshed_final <- neonate_postshed_clean %>%
  dplyr::select(Indiv_ID, Date_Born, Tail_Length_cm, SVL_cm, Tail_SVL_Ratio, Mass_g, Sex, Mother_ID, Treatment, Tb_CEWL_c, Pee, CEWL_Blood_Collect_Date)

neonate_postshed_temp <- neonate_postshed_clean %>%
  dplyr::select(-c(Date_Born, Tail_Length_cm, SVL_cm, Tail_SVL_Ratio, Mass_g, Sex, Mother_ID, Treatment, Tb_CEWL_c, Pee))
```

```{r load data}
#Create a data frame called osml_reps_o.
osml_reps_0 <- neonate_postshed_temp 

#Creating a new df by selecting out all of the rep 1 values.
osml_reps_1 <- osml_reps_0 %>%
  dplyr::select(Indiv_ID, CEWL_Blood_Collect_Date, Date_Blood_Analyzed, Plasma_Osmol_Rep = Plasma_Osmol_Rep1) %>%
  mutate(Rep = "1") 

#Creating a new df by selecting out all of the rep 2 values. 
osml_reps_2 <- osml_reps_0 %>%
  dplyr::select(Indiv_ID, CEWL_Blood_Collect_Date, Date_Blood_Analyzed, Plasma_Osmol_Rep = Plasma_Osmol_Rep2) %>%
  mutate(Rep = "2") 

#Creating a new df by selecting out all of the rep 3 values.
osml_reps_3 <- osml_reps_0 %>%
  dplyr::select(Indiv_ID, CEWL_Blood_Collect_Date, Date_Blood_Analyzed, Plasma_Osmol_Rep = Plasma_Osmol_Rep3) %>%
  mutate(Rep = "3") 

#Creating a new df by selecting out all of the rep 4 values
osml_reps_4 <- osml_reps_0 %>%
  dplyr::select(Indiv_ID, CEWL_Blood_Collect_Date, Date_Blood_Analyzed, Plasma_Osmol_Rep = Plasma_Osmol_Rep4) %>%
  mutate(Rep = "4") 

#Rbinding all of the previously made df together so that all of the technical osmolarity replicates are in once column. They have to be like this for the analysis. Then, filter out all of the replicates so the data frame only consists of the complete cases. The incomplete cases are from the blood samples that didn't have enough plasma to run multiple replicates. 
osml_reps <- osml_reps_1 %>%
  rbind(osml_reps_2) %>%
  rbind(osml_reps_3) %>%
  rbind(osml_reps_4) %>%
dplyr::filter(complete.cases(Plasma_Osmol_Rep))

#View a summary of the osml_reps to see that all of the reps are in the same column
summary(osml_reps)
```

Replicates
Now, I will try to identify outliers within the replicates for a given individual on a given date. There must be at least 3 replicates to do this, so the first thing I need to do is figure out which individuals/dates have enough replicates, then subset my data to be only those individuals.

Individuals with 3+ Replicates
```{r separate data w enough reps to assess}

# identify the individuals with at least 3-4 osmolarity reps
enuf_reps <- osml_reps %>%
  group_by(Indiv_ID, CEWL_Blood_Collect_Date) %>%
  mutate(count = n()) %>%
  dplyr::filter(count > 2) %>%
  arrange(count)
enuf_reps

# identify individuals with 1-2 reps
not_reps <- osml_reps %>%
  group_by(Indiv_ID, CEWL_Blood_Collect_Date) %>%
  mutate(count = n()) %>%
  dplyr::filter(count < 3) %>%
  arrange(count)
not_reps

# check that the total number of observations still add to original 340
nrow(enuf_reps) + nrow(not_reps)
nrow(enuf_reps) + nrow(not_reps) == nrow(osml_reps)
```

Assess Variation
We want the Coefficient of Variation (CV) among our technical replicates to be small. We need to calculate it to identify whether there may be outliers.

```{r calculate CVs}

#creating a variable cv to determine if there may be outliers. 
CVs <- enuf_reps %>%
  group_by(Indiv_ID, CEWL_Blood_Collect_Date) %>%
  summarise(mean = mean(Plasma_Osmol_Rep),
            SD = sd(Plasma_Osmol_Rep),
            CV = (SD/mean) *100,
            min = min(Plasma_Osmol_Rep),
            max = max(Plasma_Osmol_Rep),
            range = max - min
            )
summary(CVs)
hist(CVs$CV)
hist(CVs$range) 

#Not really any replicates here so cant really do this. 
```

Ideally, CV would be 10-15%. If it's larger, and one of the replicates is very different than the others, we can assume that the replicates that are closer together are more reliable. 

Find Outliers
```{r create find outlier function}
# write function to find outliers for each individual on each date
find_outliers <- function(df) {
  
  # initiate dataframe to compile info and list to compile plots
  outliers <- data.frame()
  #boxplots <- list()

  # initiate a for loop to go through every who in df
  for(indiv_ch in unique(df$Indiv_ID)) {
    
    # select data for only the individual of interest
    df_sub <- df %>%
      dplyr::filter(Indiv_ID == as.numeric(indiv_ch))
    
    # make a boxplot
    df_sub %>%
      ggplot(.) +
      geom_boxplot(aes(x = as.factor(CEWL_Blood_Collect_Date),
                       y = Plasma_Osmol_Rep,
                       fill = as.factor(CEWL_Blood_Collect_Date))) +
      ggtitle(paste("Individual", indiv_ch)) +
      theme_classic() -> plot
    
    stats <- ggplot_build(plot)$data[[1]] %>%
  mutate(x = as.numeric(x))
    
    # print/save
    print(plot)
    #boxplots[[indiv_ch]] <- plot
    
    # extract outliers
    outs <- df_sub %>%
      group_by(Indiv_ID, CEWL_Blood_Collect_Date) %>%
      summarise(n=n()) %>%
      arrange(CEWL_Blood_Collect_Date) %>%
      mutate(x = seq(1, nrow(.))) %>%
      left_join(stats) %>%
      dplyr::select(Indiv_ID, CEWL_Blood_Collect_Date, outliers)
    
    # add to running dataframe of outliers
    outliers <- outliers %>%
      rbind(outs)
  }
  #return(boxplots)
  return(outliers)
}

```

Now apply the function to the data:
```{r find outlier using boxplots, fig.show="hold", out.width="50%"}

#Running this will give boxplots for each individual with each date that blood samples were run. It will visually show if there are any outliers. 
par(mfrow = c(71, 2))
outliers_found <- find_outliers(enuf_reps)
outliers_found
par(mfrow = c(1, 1))



outliers_found %>%
  filter(outliers != "numeric(0)")
  
unique(outliers_found$outliers)
```
Remove Outliers
```{r remove outlier}
enuf_reps_trimmed <- enuf_reps %>%
  left_join(outliers_found, by = c("Indiv_ID", "CEWL_Blood_Collect_Date")) %>%
  dplyr::filter(outliers %nin% c("NULL")) %>% 
  dplyr::filter((Plasma_Osmol_Rep != outliers | outliers == "numeric(0)"))
```
Average Remaining Replicates

Now that the outliers are removed from the technical replicates when there were enough replicates to identify them, I will average the remaining replicates of the rejoined data for lizards with 1-2 and 3-4 replicates.

```{r calculate means}
osml_means <- not_reps %>%
  rbind(enuf_reps_trimmed) %>%
  group_by(CEWL_Blood_Collect_Date, Indiv_ID) %>%
  summarise(Plasma_Osmol_Rep_mean = mean(Plasma_Osmol_Rep))
```

Merging Dataframes
```{r}
neonate_postshed_all_final <- left_join(neonate_postshed_final, osml_means, by = c("CEWL_Blood_Collect_Date", "Indiv_ID"))
#reading in CEWL data
all_data_CEWL <- readRDS("CEWL_data_all_clean.RDS")
#merging all together
neonate_postshed_all_final <- left_join(neonate_postshed_all_final, all_data_CEWL, by = c("Indiv_ID" = "individual_ID", "CEWL_Blood_Collect_Date" = "date"))
```
 
Now the final dataframe has all of the neonate post shed measurements together. Now I will calibrate body temperature data. 

##Body Temperature Calibration

```{r}
setwd("/Users/robinbedard/Desktop/Old Work/Thesis/csv files")
thermo_c <- read.csv("thermoc_calibration.csv")
thermo_coupl <- thermo_c %>%
  dplyr::select(Time, Value) %>% 
  mutate(Time = as.POSIXct(substr(Time, 1,5), format = "%H:%M"))

thermo_ref <- read.csv("thermalcouple_c_reference.csv") %>% 
  mutate(Time = as.POSIXct(Time, format = "%H:%M"))

thermo_c_final <- left_join(thermo_coupl, thermo_ref, by = "Time")
```

Calibrate Thermocouple Data
First, calculate and save regression curves: calculate regression curves
```{r}
regression_a <- lm(data = thermo_c_final,
                   Value ~ Temp)
```

Create df to store calibration equations
```{r}
TC_calibration <- data.frame(TC_A = (coef(regression_a))) %>%
  `rownames<-`(c("intercept", "slope"))
```

Next, use calibration curves to correct the data we measured:
this applies respective calibration equation to all cloacal thermocouple data points of that proper thermocouple. 2=slope & 1=intercept
```{r}
neonate_postshed_all_final_2 <- neonate_postshed_all_final %>%
  mutate(calibrated_cloacal_temp = Tb_CEWL_c*TC_calibration$TC_A[2] +
           TC_calibration$TC_A[1])
summary(neonate_postshed_all_final_2)
```

Body temperature data is complete.
##Body Condition
```{r}
neonate_ps_all_final_temp <- neonate_postshed_all_final_2 %>%
  mutate(log_Mass = log10(Mass_g)) %>%
  mutate(log_SVL = log10(SVL_cm))

ggplot(data = neonate_ps_all_final_temp, aes(x = log_SVL, y = log_Mass)) +
  geom_point()

bc_lm <- lm(data = neonate_ps_all_final_temp, log_Mass ~ log_SVL)
neonate_ps_all_final_temp$Body_Condition <- bc_lm$resid
```
##Creating clutch averages

Creating clutch averages for post shed
Creating clutch averages for CEWL, Osmolarity, ambient temp and humidity, body temp. Since the neonates are technically replicates to get one value per mother, we have to average them 

Creating a new column with the averages of osmolarities in a clutch so the neonates are replicates. Then will add this to the mother analysis data frame. 
```{r}
neonate_postshed_replicates <- neonate_ps_all_final_temp %>%                                  
  group_by(Mother_ID) %>%
  mutate(clutch_osmol_avg = mean(Plasma_Osmol_Rep_mean, na.rm = TRUE))
```

Creating a new column with the averages of CEWL, pee, ambient hum, ambient temp, cloacal temp, svl, mass, smi in a clutch so the neonates are replicates. Then will add this to the mother analysis data frame
```{r}
neonate_postshed_replicates2 <- neonate_postshed_replicates %>%                                  
  group_by(Mother_ID) %>%
  mutate(clutch_CEWL_avg = mean(CEWL_g_m2h, na.rm = TRUE))

neonate_postshed_replicates3 <- neonate_postshed_replicates2 %>%
  mutate(Pee = as.factor(str_trim(Pee)))

neonate_postshed_replicates4 <- neonate_postshed_replicates3 %>%                                  
  group_by(Mother_ID) %>%
  mutate(Prop_Pee = sum(Pee == "Y")/sum(Pee == "Y" | Pee == "N"))

neonate_postshed_replicates5 <- neonate_postshed_replicates4 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_bodytemp_avg = mean(calibrated_cloacal_temp, na.rm = TRUE))

neonate_postshed_replicates6 <- neonate_postshed_replicates5 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_ambienttemp_avg = mean(msmt_temp_C, na.rm = TRUE))

neonate_postshed_replicates7 <- neonate_postshed_replicates6 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_ambienthumidity_avg = mean(msmt_RH_percent, na.rm = TRUE))

neonate_postshed_replicates8 <- neonate_postshed_replicates7 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_BodyCond_avg = mean(Body_Condition, na.rm = TRUE))

neonate_postshed_replicates9 <- neonate_postshed_replicates8 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_Mass_avg = mean(Mass_g, na.rm = TRUE))

neonate_postshed_replicates10 <- neonate_postshed_replicates9 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_SVL_avg = mean(SVL_cm, na.rm = TRUE))
```

Making a dataframe that only has mother id, clutch cewl, and clutch osmolarity. Now there is only one value for each mother. This is what we want. 
```{r}
post_shed_clutch_averages <- unique(neonate_postshed_replicates10[ , c(8, 9, 21, 22, 23, 24, 25, 26, 27, 28, 29)])
summary(post_shed_clutch_averages)

saveRDS(post_shed_clutch_averages, "/Users/robinbedard/Desktop/Old Work/Thesis/RDS_files/ps_clutch_averages_RDS")
```

Adding a column for if neonates have shed
```{r}
post_shed_clutch_averages <- post_shed_clutch_averages %>%
  mutate(Shed = "Y")
```

#ALL NEONATES

```{r}
all_clutch_averages <- full_join(post_shed_clutch_averages, clutch_averages2)
```
Adding columns for mothers osmolarity, cewl, and days mother was in treatment 

```{r}
Mother_ID <- as.factor(c(124, 124, 125, 125, 128, 128, 129, 129, 131, 131, 133, 133, 134, 134, 135, 135, 101, 103, 104, 105, 112, 114, 115, 119, 126, 127))

mothers_osmol <- as.numeric(c(300.75, NA, 288.99, 307.66, 305, 271.33, 314.66, 325, 310.5, NA, 329, NA, 304, NA, 301.25, 322.33, 326, 331.66, 318, 320.75, 281.66, 311.667, 357.25, 320.33, 309.25, 312.333 ))

mothers_cewl <- as.numeric(c(16.96, NA, 19.90, 13.8, 24, 23.115, 24.47, 15.38, 11.68, NA, 18.797, NA, 17.83, NA, 20.595, 14.914, 20.9125, 21.12, 18.405, 13.5, 19.7375, 16.2275, 21.254, 27.82, 10.265, 22.4625))

days_mom_in_tmt <- as.numeric(c(5, 10, 2, 9, 3, 10, 2, 9, 5, 10, 5, 10, 5, 10, 3, 9, 13, 15, 15, 14, 14, 14, 15, 13, 7, 9))

Shed <- c("N", "Y", "N", "Y", "N", "Y", "N", "Y", "N", "Y", "N", "Y", "N", "Y", "N", "Y", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N")

mother_info <- data.frame(Mother_ID, mothers_osmol, mothers_cewl, days_mom_in_tmt, Shed)

neonate_analysis_df <- left_join(all_clutch_averages, mother_info, by = c("Mother_ID", "Shed"))
```

Fixing an error. 128 is coded as C for one variable, should be W
```{r}
neonate_analysis_df[5, 2] <- "W"
```


#ANALYSIS
#PLOTTING OSMOLARITY RAW DATA

##Osmolarity vs Treatment
###DAB and PS
```{r}
ggplot(data = neonate_analysis_df, aes(x = Treatment, y = clutch_osmol_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  labs(x = "Treatment", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```

###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = Treatment, y = clutch_osmol_avg, fill = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  stat_summary(fun.y = "mean", color = "black") +
  labs(x = "Treatment", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
###Only PS
```{r}
neonate_analysis_df %>%
  filter(Shed == "Y") %>%
  ggplot(aes(x = Treatment, y = clutch_osmol_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  labs(x = "Treatment", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```

##Osmolarity vs CEWL
###DAB and PS
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_CEWL_avg, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "CEWL", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = clutch_CEWL_avg, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "CEWL", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
###Only PS
```{r}
neonate_analysis_df %>%
  filter(Shed == "Y") %>%
  ggplot(aes(x = clutch_CEWL_avg, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "CEWL", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```

##Osmoalarity vs Pee Proportions
Proportion of neonates in clutch that did pee
```{r}
  ggplot(data = neonate_analysis_df, aes(x = Prop_Pee, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Proportion of Neonates that 'Peed'", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
##Osmolarity vs. Body Temp
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_bodytemp_avg, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average Body Temp", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```

##Osmolarity vs Ambient Temp
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_ambienttemp_avg, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average Ambient Temp", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```

##Osmolarity vs Mother Osmolarity
Measurement taken on same day 
###DAB and PS
```{r}
  ggplot(data = neonate_analysis_df, aes(x = mothers_osmol, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Mother's Osmolarity", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = mothers_osmol, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Mother's Osmolarity", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
###Only PS
```{r}
neonate_analysis_df %>%
  filter(Shed == "Y") %>%
  ggplot(aes(x = mothers_osmol, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Mother's Osmolarity", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```

##Osmolarity vs Number of Days Mom in Treatment
###Pub Fig
```{r}
neonate_analysis_df %>%
filter(Shed == "N") %>%
  ggplot() +
  geom_jitter(aes(x = days_mom_in_tmt, 
                  y = clutch_osmol_avg, 
                  colour = Treatment), 
             size = 2, 
             alpha = 0.5) +
 annotate(geom = "text", x = 5, y = 360, label = "p = 0.13", 
           size = 5) +
  theme_classic() +
  geom_smooth(aes(x = days_mom_in_tmt, 
                  y = clutch_osmol_avg, 
                  colour = Treatment), 
              method = "lm", 
              se = FALSE, 
              size = 1) +
  scale_color_manual(values = c("C" = "orange2", "W" = "royalblue4")) +
  labs(x = "Days Mother in Treatment Prior to Parturition", 
       y = "Clutch Osmolality (mmol kg-1)",
       colour = "Treatment") +
  theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right") +
  scale_x_continuous(breaks = c(2, 4, 6, 8, 10, 12, 14, 16), limits = c(2, 16)) +
 scale_y_continuous(limits = c(275, 330), 
                     breaks = seq(275, 330, by = 10)) -> neonate_osmol_dab_daysmomintmt

ggsave("Osmolality of Neonates DAB v Days Mom in TMT.png", 
       plot = neonate_osmol_dab_daysmomintmt, 
       width = 8, 
       height = 5)
```
###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = days_mom_in_tmt, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Days Mother in Treatment", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
##Osmolarity vs If Shed
```{r}
ggplot(data = neonate_analysis_df, aes(x = Shed, y = clutch_osmol_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  labs(x = "Post Shed Measurement", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
##Osmolarity vs Body Condition
###DAB and PS
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_BodyCond_avg, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average Body Condtion", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```

###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = clutch_BodyCond_avg, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average Body Condition", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
###Only PS
```{r}
neonate_analysis_df %>%
  filter(Shed == "Y") %>%
  ggplot(aes(x = clutch_BodyCond_avg, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average Body Condition", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```

#PLOTTING CEWL RAW DATA
##CEWL vs Treatment 
###DAB and PS
```{r}
ggplot(data = neonate_analysis_df, aes(x = Treatment, y = clutch_CEWL_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  labs(x = "Treatment", y = "Clutch Average CEWL")
```

```{r}
ggplot(data = neonate_analysis_df, aes(x = Treatment, y = clutch_CEWL_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  facet_wrap(~Shed) +
  labs(x = "Treatment", y = "Clutch Average CEWL")
```

###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = Treatment, y = clutch_CEWL_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  stat_summary(fun.y = "mean", color = "black") +
  geom_point() +
  labs(x = "Treatment", y = "Clutch Average CEWL")
```
###Only PS
```{r}
neonate_analysis_df %>%
  filter(Shed == "Y") %>%
  ggplot(aes(x = Treatment, y = clutch_CEWL_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  labs(x = "Treatment", y = "Clutch Average CEWL")
```
##CEWL vs Osmolarity
###DAB and PS
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_osmol_avg, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Osmolarity", y = "Clutch Average CEWL")
```
###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = clutch_osmol_avg, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Osmolarity", y = "Clutch Average CEWL")
```
###Only PS
```{r}
neonate_analysis_df %>%
  filter(Shed == "Y") %>%
  ggplot(aes(x = clutch_osmol_avg, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Osmolarity", y = "Clutch Average CEWL")
```

##CEWL vs Body Temp
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_bodytemp_avg, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average Body Temp", y = "Clutch Average CEWL")
```
###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = clutch_bodytemp_avg, y = clutch_CEWL_avg)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Body Temp", y = "Clutch Average CEWL")
```
##CEWL vs Ambient Temp
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_ambienttemp_avg, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average Ambient Temp", y = "Clutch Average CEWL")
```
###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = clutch_ambienttemp_avg, y = clutch_CEWL_avg)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Ambient Temp", y = "Clutch Average CEWL")
```
##CEWL vs Ambient Humidity
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_ambienthumidity_avg, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average Ambient Temp", y = "Clutch Average CEWL")
```
###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = clutch_ambienthumidity_avg, y = clutch_CEWL_avg)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Ambient Humidity", y = "Clutch Average CEWL")
```
##CEWL vs Mother CEWL
Measurement taken on same day 
###DAB and PS
```{r}
  ggplot(data = neonate_analysis_df, aes(x = mothers_cewl, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Mother's CEWL", y = "Clutch Average CEWL")
```
###Only DAB
####Pug Fig
```{r}
testdt <- neonate_analysis_df %>%
  filter(Shed == "N")
  cor.test(testdt$clutch_CEWL_avg, testdt$mothers_cewl)

?cor.test

neonate_analysis_df_ex <- neonate_analysis_df %>%
  filter(Shed == "N")
  
  
  ggplot() +
  geom_jitter(data = neonate_analysis_df_ex,
              aes(x = mothers_cewl, 
                  y = clutch_CEWL_avg), 
             size = 2, 
             alpha = 0.7,
             color = "springgreen3") +
  annotate(geom = "text", x = 5, y = 13, label = "R = 0.61  p = 0.0073", 
           size = 5) +
  theme_classic() +
  geom_smooth(data = neonate_analysis_df_ex,
              aes(x = mothers_cewl, 
                  y = clutch_CEWL_avg), 
              method = "lm", 
              se = TRUE,
              size = 1,
              color = "black") +
  labs(x = "Mother's CEWL (g m2h-1)", 
       y = "Clutch CEWL (g m2h-1)",
       color = "Treatment") +
  geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = "grey") +
  scale_color_manual(values = c("C" = "orange2", "W" = "dodgerblue")) +
  theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right",) +
 scale_x_continuous(breaks = seq(0, 28, by = 4), limits = c(0, 28)) +
  scale_y_continuous(limits = c(0, 20),
                  breaks = seq(0, 20, by = 4)) -> clutch_CEWL_dab_mothers_cewl

ggsave("Clutch CEWL vs Mothers CEWL.png", 
       plot =clutch_CEWL_dab_mothers_cewl, 
       width = 6, 
       height = 4)
```
###Only DAB no tmt
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = mothers_cewl, y = clutch_CEWL_avg)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Mother's CEWL", y = "Clutch Average CEWL")
```

```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = mothers_cewl, y = clutch_CEWL_avg)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Mother's CEWL", y = "Clutch Average CEWL")
```
###Only PS
```{r}
neonate_analysis_df %>%
  filter(Shed == "Y") %>%
  ggplot(aes(x = mothers_cewl, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Mother's CEWL", y = "Clutch Average CEWL")
```
##CEWL vs If Shed
```{r}
ggplot(data = neonate_analysis_df, aes(x = Shed, y = clutch_CEWL_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  labs(x = "Post Shed Measurement", y = "Clutch Average CEWL")
```
##CEWL vs Body Condition
###DAB and PS
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_BodyCond_avg, y = clutch_CEWL_avg)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average Body Condition", y = "Clutch Average CEWL")
```

###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = clutch_BodyCond_avg, y = clutch_CEWL_avg)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average Body Condition", y = "Clutch Average CEWL")
```
###Only PS
```{r}
neonate_analysis_df %>%
  filter(Shed == "Y") %>%
  ggplot(aes(x = clutch_BodyCond_avg, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average Body Condition", y = "Clutch Average CEWL")
```
#Correlation Plot
Making a correlation plot to see which numerical variables are related to one another in this data set. First, selecting out all of the numerical variables since correlation plots are based on numerical variables only.

```{r}
summary(neonate_analysis_df)

correl_df <- neonate_analysis_df %>%
  mutate(Mother_ID = as.numeric(Mother_ID)) %>%
  ungroup() %>%
  dplyr::select(Mother_ID, clutch_osmol_avg, clutch_CEWL_avg, Prop_Pee, clutch_bodytemp_avg, clutch_ambienttemp_avg, clutch_ambienthumidity_avg, clutch_BodyCond_avg, clutch_Mass_avg, clutch_SVL_avg, mothers_osmol, mothers_cewl, days_mom_in_tmt)
```

Making the correlation chart
```{r}
chart.Correlation(correl_df, histogram=TRUE, pch=19)
```

Categorical Variable Relationships
First, I have to find which categorical variables are related to CEWL. We only have treatment and shed.
```{r}
summary(neonate_analysis_df)

summary(lm(clutch_CEWL_avg ~ Treatment, data = neonate_analysis_df))
#not correlated, but I will still include in the model because this is what we are interested in. 

summary(lm(clutch_CEWL_avg ~ Shed, data = neonate_analysis_df))

summary(lm(clutch_CEWL_avg ~ clutch_SVL_avg, data = neonate_analysis_df))
summary(lm(clutch_CEWL_avg ~ clutch_Mass_avg, data = neonate_analysis_df))
summary(lm(clutch_CEWL_avg ~ clutch_BodyCond_avg, data = neonate_analysis_df))

```

#DAY AFTER BIRTH ANALYSIS
I am analyzing the day after birth and post shed measurements separately. Below I will be making a model for CEWL and osmolarity for only the day after birth measurements. Shed will not be included in the models. This will be analyzed separately. 

First, make a dataframe that only has the day after birth measurements 

```{r}
DAB_neonate_df <- neonate_analysis_df %>%
  filter(Shed == "N")
```
#SAVANNAH: DAY AFTER BIRTH CEWL MODEL
##DAB CEWL Model 
```{r}
summary(DAB_neonate_df)

DAB_CEWL_LM_1 <- lm(data = DAB_neonate_df,
                      clutch_CEWL_avg ~ 
                      Treatment *
                      mothers_cewl +
                      clutch_bodytemp_avg +
                      clutch_ambienttemp_avg +
                      clutch_ambienthumidity_avg)
                     
summary(DAB_CEWL_LM_1)
#Lower t values are less significant
drop1(DAB_CEWL_LM_1)
anova(DAB_CEWL_LM_1)
```
Based on model 1, drop 1, and SSQ, the first variable to drop from the model is humidity. 
```{r}
DAB_CEWL_LM_2 <- lm(data = DAB_neonate_df,
                      clutch_CEWL_avg ~ 
                      Treatment *
                      mothers_cewl +
                      clutch_bodytemp_avg +
                      clutch_ambienttemp_avg)
                     
summary(DAB_CEWL_LM_2)
#Lower t values are less significant
drop1(DAB_CEWL_LM_2)
anova(DAB_CEWL_LM_2)
```
Based on model 2, the next variable to drop is ambient temp. 
```{r}
DAB_CEWL_LM_3 <- lm(data = DAB_neonate_df,
                      clutch_CEWL_avg ~ 
                      Treatment *
                      mothers_cewl +
                      clutch_bodytemp_avg)
                     
summary(DAB_CEWL_LM_3)
#Lower t values are less significant
drop1(DAB_CEWL_LM_3)
anova(DAB_CEWL_LM_3)
```
Next variable to drop is the interaction. 
```{r}
DAB_CEWL_LM_4 <- lm(data = DAB_neonate_df,
                      clutch_CEWL_avg ~ 
                      Treatment +
                      mothers_cewl +
                      clutch_bodytemp_avg)
                     
summary(DAB_CEWL_LM_4)
#Lower t values are less significant
drop1(DAB_CEWL_LM_4)
anova(DAB_CEWL_LM_4)
```
next drop treatment
```{r}
DAB_CEWL_LM_5 <- lm(data = DAB_neonate_df,
                      clutch_CEWL_avg ~ 
                      mothers_cewl +
                      clutch_bodytemp_avg)
                     
summary(DAB_CEWL_LM_5)
#Lower t values are less significant
drop1(DAB_CEWL_LM_5)
anova(DAB_CEWL_LM_5)
car::vif(DAB_CEWL_LM_5)
```
The next variable to drop is body temp
```{r}
DAB_CEWL_LM_6 <- lm(data = DAB_neonate_df,
                      clutch_CEWL_avg ~
                      mothers_cewl)
                     
summary(DAB_CEWL_LM_6)
#Lower t values are less significant
drop1(DAB_CEWL_LM_6)
anova(DAB_CEWL_LM_6)
```

Null model 
```{r}
DAB_CEWL_LM_null <- lm(data = DAB_neonate_df,
                      clutch_CEWL_avg ~ 1)
                     
summary(DAB_CEWL_LM_null)
#Lower t values are less significant
drop1(DAB_CEWL_LM_null)
anova(DAB_CEWL_LM_null)
```

###Model Selection
```{r CEWL mod compare}
cewl_models_all <- list(DAB_CEWL_LM_1, DAB_CEWL_LM_2, DAB_CEWL_LM_3, DAB_CEWL_LM_4, DAB_CEWL_LM_5, DAB_CEWL_LM_6, DAB_CEWL_LM_null)

#specify model names
cewl_mod_names_all <- c('model1', 
                    'model2', 
                    'model3',
                    'model4',
                    'model5',
                    'model6',
                    'modelnull')

#calculate AIC of each model
cewl_AICc_all <- data.frame(aictab(cand.set = cewl_models_all, 
                                 modnames = cewl_mod_names_all))
cewl_AICc_all
```
So the three equivalent models are 6, then 5, then 4. All are below delta 2. 


```{r}
DAB_CEWL_LM_6 <- lm(data = DAB_neonate_df,
                      clutch_CEWL_avg ~
                      mothers_cewl)
                     
summary(DAB_CEWL_LM_6)
anova(DAB_CEWL_LM_6)

DAB_CEWL_LM_5 <- lm(data = DAB_neonate_df,
                      clutch_CEWL_avg ~ 
                      mothers_cewl +
                      clutch_bodytemp_avg)

summary(DAB_CEWL_LM_5)
anova(DAB_CEWL_LM_5)


#Result: For all neonates the day after birth, the best model for CEWL included mother's CEWL (estimate = 0.40, SE = 0.13, F(1, 16) = 9.43, p = 0.0073). An equivalent model included mother's cewl (estimate = 0.37, SE = 0.12, F(1, 15) = 10.65, p = 0.0052)and clutch average body temperature (estimate = 1.11, SE = 0.63, F(1, 15) = 3.07, p = 0.10).

```

###Final Model & Assumptions
Check linear regression assumptions/conditions:
```{r CEWL exp model assumptions}
plot(DAB_CEWL_LM_6)
shapiro.test(residuals(DAB_CEWL_LM_6))
#car::vif(DAB_CEWL_LM_6, type = "predictor")
#all ok
```
lm for cewl different hydration groups
```{r}
neonate_cewl_tmt <- lm(data = DAB_neonate_df, clutch_CEWL_avg ~ Treatment)

summary(neonate_cewl_tmt)
anova(neonate_cewl_tmt)


Means_neonates2 <- emmeans(neonate_cewl_tmt, pairwise ~ Treatment)
Means_neonates2$emmean
Means_neonates2$contrasts

#Result: no difference in cewl based on treatment for neonates (estimate = -1.73, SE = 1.35, F(1, 16) = 1.63, p = 0.22)
```

getting CI
```{r}
neonate_cewl_CI <- data.frame(emmeans(neonate_cewl_tmt, "Treatment"))
```

Figure showing no differene in neonate cewl by treatment
####Pub Fig
```{r}
ggplot() +
  geom_jitter(data = DAB_neonate_df, 
             aes(x = Treatment, 
                 y = clutch_CEWL_avg, 
                 color = Treatment),
             size = 2,
             alpha = 0.5) +
  geom_point(data = neonate_cewl_CI, 
             aes(x = Treatment, 
                 y = emmean),
             color = "black", 
             size = 2) +
  theme_classic() +
  annotate(geom = "text", x = 1.5, y = 17, label = "p = 0.22", 
           size = 5) +
  scale_color_manual(values = c("C" = "orange2", "W" = "royalblue4")) +
  labs(x = "", y = "Clutch CEWL (g m2h-1)") +
  geom_errorbar(data = neonate_cewl_CI, aes(x = Treatment,
                               y = emmean, 
                               ymin = lower.CL, 
                               ymax = upper.CL,
                               width = .3),
                color = "black")+
  theme(text = element_text(color = "black", 
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16)) +
  scale_y_continuous(limits = c(5, 17),
                  breaks = seq(5, 17, by = 2)) -> clutch_cewl_dab_tmt 
```

```{r}
ggarrange(clutch_cewl_dab_tmt , clutch_CEWL_dab_mothers_cewl,
          ncol = 2, nrow = 1,
          labels = c("A", "B"),
          common.legend = TRUE,
          legend = "bottom"
          ) -> clutch_dab_pub_fig

ggsave("Clutch CEWL DAB Pub Fig.png", 
       plot = clutch_dab_pub_fig, 
       width = 10, 
       height = 6)
```


#SAVANNAH: SAY AFTER BIRTH OSMOL MODEL
##DAB Osmolarity Model
```{r}
summary(DAB_neonate_df)

DAB_osmol_LM_1 <- lm(data = DAB_neonate_df,
                      clutch_osmol_avg ~ 
                      Treatment *
                      days_mom_in_tmt +
                      clutch_BodyCond_avg +
                      mothers_osmol)
                     
summary(DAB_osmol_LM_1)
#Lower t values are less significant
drop1(DAB_osmol_LM_1)
anova(DAB_osmol_LM_1)
```
Based on model 1, AIC, and SSQ, the first variable to drop is body condition. 
```{r}
summary(DAB_neonate_df)

DAB_osmol_LM_2 <- lm(data = DAB_neonate_df,
                      clutch_osmol_avg ~ 
                      Treatment *
                      days_mom_in_tmt +
                      mothers_osmol)
                     
summary(DAB_osmol_LM_2)
#Lower t values are less significant
drop1(DAB_osmol_LM_2)
anova(DAB_osmol_LM_2)
```
The next variable to drop is mother's osmol. 
```{r}
summary(DAB_neonate_df)

DAB_osmol_LM_3 <- lm(data = DAB_neonate_df,
                      clutch_osmol_avg ~ 
                      Treatment *
                      days_mom_in_tmt)
                     
summary(DAB_osmol_LM_3)
#Lower t values are less significant
drop1(DAB_osmol_LM_3)
anova(DAB_osmol_LM_3)
```
The next variable to drop is the interaction. 
```{r}
summary(DAB_neonate_df)

DAB_osmol_LM_4 <- lm(data = DAB_neonate_df,
                      clutch_osmol_avg ~ 
                      Treatment +
                      days_mom_in_tmt)
summary(DAB_osmol_LM_4)
#Lower t values are less significant
drop1(DAB_osmol_LM_4)
anova(DAB_osmol_LM_4)
```
The next variable to be dropped is days mom in tmt. 
```{r}
summary(DAB_neonate_df)

DAB_osmol_LM_5 <- lm(data = DAB_neonate_df,
                      clutch_osmol_avg ~ 
                      Treatment)
                     
summary(DAB_osmol_LM_5)
#Lower t values are less significant
drop1(DAB_osmol_LM_5)
anova(DAB_osmol_LM_5)
```

null model 
```{r}
summary(DAB_neonate_df)

DAB_osmol_LM_null <- lm(data = DAB_neonate_df,
                      clutch_osmol_avg ~ 1)
                    
```

###Model Selection
```{r osmol mod compare}
osmol_models_all <- list(DAB_osmol_LM_1, DAB_osmol_LM_2, DAB_osmol_LM_3, DAB_osmol_LM_4, DAB_osmol_LM_5, DAB_osmol_LM_null)

#specify model names
osmol_mod_names_all <- c('model1', 
                    'model2', 
                    'model3',
                    'model4',
                    'model5',
                    'modelnull')

#calculate AIC of each model
osmol_AICc_all <- data.frame(aictab(cand.set = osmol_models_all, 
                                 modnames = osmol_mod_names_all))
osmol_AICc_all
```
The best equivalent models are 4, then 5, then 6. They are all below 2. 
###Final Model & Assumptions

Best model is the one with the fewest terms. Other two are equivalent. 
```{r}
#best
DAB_osmol_LM_5 <- lm(data = DAB_neonate_df,
                      clutch_osmol_avg ~ 
                      Treatment)

summary(DAB_osmol_LM_5)
anova(DAB_osmol_LM_5)

#an equivalent
DAB_osmol_LM_3 <- lm(data = DAB_neonate_df,
                      clutch_osmol_avg ~ 
                      Treatment *
                      days_mom_in_tmt)

summary(DAB_osmol_LM_3)
anova(DAB_osmol_LM_3)
emtrends(DAB_osmol_LM_3, "Treatment", var = "days_mom_in_tmt")

Means_neonates1 <- emmeans(DAB_osmol_LM_3, pairwise ~ Treatment)
Means_neonates1$emmean
Means_neonates1$contrasts




pairs(emtrends(DAB_osmol_LM_3, "Treatment", var = "days_mom_in_tmt"))


#Result: For all neonates the day after birth, the best model for osmolality only included hydration treatment (estimate = -13.52, SE = 5.12, F(1, 16) = 7.01, p = 0.017). On average, clutches in the hydration treatment had plasma osmolality 13.52 lower than clutches in the control treatment. An equivalent model included hydration treatment, the number of days mother was in treatment prior to birthing, and the interaction between treatment and the number of days mother was in treatment prior to brithing. 
```

Check linear regression assumptions/conditions:
```{r CEWL exp model assumptions}
```

Lm for difference in osmolarity for treatment groups.
```{r}
osmoltmt_lm <- lm(data = DAB_neonate_df, clutch_osmol_avg ~ Treatment)

summary(osmoltmt_lm)
anova(osmoltmt_lm)
```
getting confidence interval
```{r}
neonate_osmol_CI <- data.frame(emmeans(osmoltmt_lm, "Treatment"))
```
####Pub Fig
```{r}
ggplot() +
  geom_jitter(data = DAB_neonate_df, 
             aes(x = Treatment, 
                 y = clutch_osmol_avg, 
                 color = Treatment),
                 size = 2,
                alpha = 0.5) +
  geom_point(data = neonate_osmol_CI, 
             aes(x = Treatment, 
                 y = emmean),
             color = "black", 
             size = 3) +
  theme_classic() +
  annotate(geom = "text", x = 1.5, y = 320, label = "p = 0.018", 
           size = 5) +
  scale_color_manual(values = c("C" = "orange2", "W" = "royalblue4")) +
  labs(x = "", y = "Clutch Osmolality (mmol kg-1)") +
  geom_errorbar(data = neonate_osmol_CI, aes(x = Treatment,
                               y = emmean, 
                               ymin = lower.CL, 
                               ymax = upper.CL,
                               width = .3),
                color = "black") +
  theme(text = element_text(color = "black", 
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16)) -> neonate_DAB_osmol

ggsave("Neonate Day After Birth Osmolality.png", 
       plot = neonate_DAB_osmol,
       width = 6,
       height = 4)
```

#POST SHED ANALYSIS
First, make a dataframe that only has the post shed measurements 

```{r}
PS_neonate_df <- neonate_analysis_df %>%
  filter(Shed == "Y")
```

#SAVANNAH: POST SHED OSMOL MODEL
##PS Osmolarity Model
```{r}
PS_osmol_LM_1 <- lm(data = PS_neonate_df,
                      clutch_osmol_avg ~ 
                      Treatment *
                      days_mom_in_tmt +
                      Prop_Pee +
                      clutch_BodyCond_avg)
                     
summary(PS_osmol_LM_1)
#Lower t values are less significant
drop1(PS_osmol_LM_1)
anova(PS_osmol_LM_1)
```
The first variable to drop is body condition. 
```{r}
PS_osmol_LM_2 <- lm(data = PS_neonate_df,
                      clutch_osmol_avg ~ 
                      Treatment *
                      days_mom_in_tmt +
                      Prop_Pee)
                     
summary(PS_osmol_LM_2)
#Lower t values are less significant
drop1(PS_osmol_LM_2)
anova(PS_osmol_LM_2)
```
The next variable to drop is prop pee
```{r}
PS_osmol_LM_3 <- lm(data = PS_neonate_df,
                      clutch_osmol_avg ~ 
                      Treatment *
                      days_mom_in_tmt)
                     
summary(PS_osmol_LM_3)
#Lower t values are less significant
drop1(PS_osmol_LM_3)
anova(PS_osmol_LM_3)
```
Next variable to drop is the interaction. 
```{r}
PS_osmol_LM_4 <- lm(data = PS_neonate_df,
                      clutch_osmol_avg ~ 
                      Treatment +
                      days_mom_in_tmt)
                     
summary(PS_osmol_LM_4)
#Lower t values are less significant
drop1(PS_osmol_LM_4)
anova(PS_osmol_LM_4)
```
The next variable to drop is days mom in treatment. 
```{r}
PS_osmol_LM_5 <- lm(data = PS_neonate_df,
                      clutch_osmol_avg ~ 
                      Treatment)
                     
summary(PS_osmol_LM_5)
#Lower t values are less significant
drop1(PS_osmol_LM_5)
anova(PS_osmol_LM_5)
```

null model 
```{r}
PS_osmol_LM_null <- lm(data = PS_neonate_df,
                      clutch_osmol_avg ~ 1)
                     
summary(PS_osmol_LM_null)
#Lower t values are less significant
drop1(PS_osmol_LM_null)
anova(PS_osmol_LM_null)
```

###Model Selection
```{r osmol mod compare}
osmol_models_all <- list(PS_osmol_LM_1, PS_osmol_LM_2, PS_osmol_LM_3, PS_osmol_LM_4, PS_osmol_LM_5, PS_osmol_LM_null)

#specify model names
osmol_mod_names_all <- c('model1', 
                    'model2', 
                    'model3',
                    'model4',
                    'model5',
                    'modelnull')

#calculate AIC of each model
osmol_AICc_all <- data.frame(aictab(cand.set = osmol_models_all, 
                                 modnames = osmol_mod_names_all))
osmol_AICc_all
```
The best is model 5 see below. 
```{r}
#Model 5 only predicts by treatment.
PS_osmol_LM_5 <- lm(data = PS_neonate_df,
                      clutch_osmol_avg ~ 
                      Treatment)
summary(PS_osmol_LM_5)
anova(PS_osmol_LM_5)
#Result: For neonates post shedding, on average, neonates in the hydration treatment had an osmolarity 53.73mmol/kg lower than neonates in the control group (estimate = -53.71, SE = 7.57, F = 50.33, p = 0.00039).
```
###Final Model & Assumptions
We are choosing model 4 as our best model. 
Check linear regression assumptions/conditions:
```{r CEWL exp model assumptions}
plot(PS_osmol_LM_5)
shapiro.test(residuals(PS_osmol_LM_5))
#all ok?
```
#SHED COMPARISON ANALYSIS
First, I need a data frame for all clutches that have a pre shed and post shed measurement.
```{r}
shed_analysis_df_temp <- neonate_analysis_df[1:16, ]
```
#***SAVANNAH: ECDYSIS MODEL
```{r}
shed_analysis_lm <- lmer(data = shed_analysis_df_temp, clutch_CEWL_avg ~ Treatment * Shed + (1|Mother_ID))

summary(shed_analysis_lm)
anova(shed_analysis_lm)

Meansq <- emmeans(shed_analysis_lm, pairwise ~ Shed | Treatment)
Meansq$emmean
Meansq$contrasts

Meansw <- emmeans(shed_analysis_lm, pairwise ~ Treatment | Shed)
Meansw$emmean
Meansw$contrasts

neo_cewl_lm_CI <- data.frame(emmeans(shed_analysis_lm, pairwise ~ Treatment | Shed)$emmean)

neo_cewl_lm_CI <- neo_cewl_lm_CI %>% 
  mutate(Shed = str_replace_all(Shed, "N", "At Birth")) %>%
  mutate(Shed = str_replace_all(Shed, "Y", "After Shedding"))
```

Now, create a column/variable with the delta cewl (change in cewl pre vs post shed)
```{r}
shed_analysis_df <- shed_analysis_df_temp %>%
  group_by(Mother_ID) %>%
  arrange(Shed) %>%
  mutate(delta_cewl = clutch_CEWL_avg - lag(clutch_CEWL_avg)) 

shed_analysis_df[is.na(shed_analysis_df)] <- 0
```







Normality test
```{r}
shapiro.test(shed_analysis_df$delta_cewl)
```

T-test to see if the change in cewl is significantly different from 0. T-test on the mean change in cewl, so only one observation per clutch. Don't need a paired t-test. 
```{r}
t.test(shed_analysis_df$delta_cewl)
#Result: The change in cewl was significantly greater than 0 pre and post shed (t = 3.60, p = 0.0088). The change was not different between treatment groups ((estimate = 1.30, SE = 2.58, F(1,6)= 0.25, p = 0.63). 
```
There is a significant difference in CEWL pre and post shed. 

Now seeing if the change in cewl is significantly different between treatments 
```{r}
shed_lm <- lm(data = shed_analysis_df, 
   delta_cewl ~ Treatment)

summary(shed_lm)
anova(shed_lm)
```
There is no difference between treatment groups (estimate = -1.30, SE = 2.58, F(1,6)= 0.25, p = 0.63).

CI
```{r}
shed_lm_CI <- data.frame(emmeans(shed_lm, "Treatment"))
```

###Pub Figure
```{r}
ggplot() +
  geom_jitter(data = shed_analysis_df, 
             aes(x = Treatment, 
                 y = delta_cewl, 
                 color = Treatment),
             size = 2,
             alpha = 0.5) +
  geom_point(data = shed_lm_CI, 
             aes(x = Treatment, 
                 y = emmean),
             color = "black", 
             size = 2) +
  theme_classic() +
  annotate(geom = "text", x = 1.5, y = 10, label = "p = 0.63", 
           size = 5) +
  scale_color_manual(values = c("C" = "orange2", "W" = "royalblue4")) +
  labs(x = "", y = "Change in Clutch Avg. CEWL (g m2h-1)") +
  geom_errorbar(data = shed_lm_CI, aes(x = Treatment,
                               y = emmean, 
                               ymin = lower.CL, 
                               ymax = upper.CL,
                               width = .3),
                color = "black")+
  theme(text = element_text(color = "black", 
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16)) +
  scale_y_continuous(limits = c(-2, 10),
                  breaks = seq(-2, 10, by = 2)) -> clutch_cewl_tmt_dab_fig
```

```{r}
shed_analysis_df_temp$Shed[shed_analysis_df_temp$Shed == 'Y'] <- 'Post Shed'

shed_analysis_df_temp$Shed[shed_analysis_df_temp$Shed == 'N'] <- 'Pre Shed'

shed_analysis_df_temp$Shed<- factor(shed_analysis_df_temp$Shed, levels = c("Pre Shed", "Post Shed"))

```

Figure
```{r}
  ggplot(data = shed_analysis_df_temp, aes(x = Shed, 
           y = clutch_CEWL_avg, 
           colour = Treatment)) +
  geom_point(aes(x = Shed, 
           y = clutch_CEWL_avg, 
           colour = Treatment),
                 size = 2,
                alpha = 0.5) +
  theme_classic() +
  geom_line(aes(group = Mother_ID)) +
 annotate(geom = "text", x = -.5, y = 12, label = "p = 0.0088", 
          size = 5, color = "black") +
  scale_color_manual(values = c("C" = "orange2", "W" = "royalblue4")) +
  labs(x = "", y = "Clutch CEWL (g m2h-1)") +
  theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right") +
  scale_y_continuous(limits = c(7, 17.5), breaks = seq(7, 17, by = 2)) -> clutch_change_cewl_Fig
  #scale_x_continuous(limits = c(1, 7.5), breaks = seq(1, 7, by = 1))
```

```{r}
ggarrange(clutch_cewl_tmt_dab_fig,
           clutch_change_cewl_Fig,
          ncol = 1, nrow = 2,
          labels = c("A", "B"),
          common.legend = TRUE,
          legend = "bottom"
          ) -> neonate_change_cewl_fig

ggsave("Neonate Change in CEWL 2 Panel.png", 
       plot = neonate_change_cewl_fig, 
       width = 7, 
       height = 13.5)
```



#OSMOLARITY COMPSRISON ANALYSIS
First, I need a data frame for all clutches that have two osmolarity measurements.
```{r}
osmol_analysis_df_temp <- neonate_analysis_df[1:16, ]
```

#***NEW OSMOL ANALYSIS
```{r}
neo_osmol_lmer <- lmer(data = osmol_analysis_df_temp, clutch_osmol_avg ~ Shed * Treatment + (1|Mother_ID))

neoMeans1 <- emmeans(neo_osmol_lmer, pairwise ~ Shed | Treatment)
neoMeans1$emmean
neoMeans1$contrasts

neoMeans2 <- emmeans(neo_osmol_lmer, pairwise ~ Treatment | Shed)
neoMeans2$emmean
neoMeans2$contrasts

neo_osmol_lmer_CI <- data.frame(emmeans(neo_osmol_lmer, pairwise ~ Treatment | Shed)$emmean)

neo_osmol_lmer_CI <- neo_osmol_lmer_CI %>% 
  mutate(Shed = str_replace_all(Shed, "N", "At Birth")) %>%
  mutate(Shed = str_replace_all(Shed, "Y", "After Shedding"))
```

```{r}
install.packages("lmerTest")
library(lmerTest)

install.packages("MuMlm")
library(MuMlm)
```
#***SAVANNAH: OSMOL MODEL
```{r}
neo_osmol_lmer <- lmerTest::lmer(data = osmol_analysis_df_temp, clutch_osmol_avg ~ Shed * Treatment + (1|Mother_ID))

neoMeans1 <- emmeans(neo_osmol_lmer, pairwise ~ Shed | Treatment)
neoMeans1$emmean
neoMeans1$contrasts

neoMeans2 <- emmeans(neo_osmol_lmer, pairwise ~ Treatment | Shed)
neoMeans2$emmean
neoMeans2$contrasts

neo_osmol_lmer_CI <- data.frame(emmeans(neo_osmol_lmer, pairwise ~ Treatment | Shed)$emmean)

neo_osmol_lmer_CI <- neo_osmol_lmer_CI %>% 
  mutate(Shed = str_replace_all(Shed, "N", "At Birth")) %>%
  mutate(Shed = str_replace_all(Shed, "Y", "After Shedding"))
```

Now, create a column/variable with the delta osmol (change in osmol pre vs post shed)
```{r}
osmol_analysis_df <- osmol_analysis_df_temp %>%
  group_by(Mother_ID) %>%
  arrange(Shed) %>%
  mutate(delta_osmol = clutch_osmol_avg - lag(clutch_osmol_avg)) %>%
  filter(complete.cases(delta_osmol))
```

Now, create a column/variable with the confidence intervals
```{r}
osmol_analysis_df <- osmol_analysis_df_temp %>%
  group_by(Mother_ID) %>%
  arrange(Shed) %>%
  mutate(delta_osmol = clutch_osmol_avg - lag(clutch_osmol_avg)) %>%
  filter(complete.cases(delta_osmol))
```

T-test to see if the change in osmol is significantly different from 0.
```{r}
t.test(osmol_analysis_df$delta_osmol)
#Not significant, likely because there is a difference between the two treatments. 
```

Now seeing if the change in osmol is significantly different between treatments 
```{r}
osmol_lm <- lm(data = osmol_analysis_df, 
   delta_osmol ~ Treatment)

summary(osmol_lm)
anova(osmol_lm)
#The change in osmolarity is different for the two treatments so I need two separate T-tests for the two treatments. 
```

lm to see difference 
```{r}
delta_osmol_lm <- lm(data = osmol_analysis_df, delta_osmol ~ Treatment)

summary(delta_osmol_lm)
anova(delta_osmol_lm)
```

getting confidence intervals 
```{r}
summary(delta_osmol_lm)

CI <- data.frame(emmeans(delta_osmol_lm, "Treatment"))
```

##Pub Fig 
```{r}
ggplot() +
  geom_hline(yintercept = 0, linetype = 'dashed', col = 'grey') +
  geom_jitter(data = osmol_analysis_df, 
             aes(x = Treatment, 
                 y = delta_osmol, 
                 color = Treatment),
                 size = 2,
                alpha = 0.5) +
  geom_point(data = CI, 
             aes(x = Treatment,
                 y = emmean),
             color = "black", 
             size = 3) +
  theme_classic() +
  annotate(geom = "text", x = 1.25, y = -18, label = "p = 0.0071", 
           size = 5) +
  scale_color_manual(values = c("C" = "orange2", "W" = "royalblue4")) +
  labs(x = "", y = "Change in Osmolality (mmol kg-1)") +
  geom_errorbar(data = CI, aes(x = Treatment,
                               y = emmean, 
                               ymin = lower.CL, 
                               ymax = upper.CL,
                               width = .3),
                color = "black") +
  theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right") +
  scale_y_continuous(limits = c(-25, 75), breaks = c(-20, 0, 20, 40, 60, 80)) -> neonate_change_osmol_1
```

Creating a df with only W treatment and only C treatment 
```{r}
osmol_analysis_df_Hydration <- osmol_analysis_df %>%
  filter(Treatment == "W")

osmol_analysis_df_Control <- osmol_analysis_df %>%
  filter(Treatment == "C")
```

T-test to see if the change in osmol is significantly different from 0 for hydration group.
```{r}
t.test(osmol_analysis_df_Hydration$delta_osmol)
#Not significant for the hydration group. 
```
T-test to see if the change in osmol is significantly different from 0 for control group.
```{r}
t.test(osmol_analysis_df_Control$delta_osmol)
#Significant for the hydration group. 

#Result: The change in neonate osmolarity was significantly different between treatment groups (estimate = -49.06, SE = 12.25, F(1,6) = 16.03, p = 0.0071). For neonates in the hydration treatment, there was no significant change in osmolarity from the day after birth to about 1 week after birth (t = 0.45, p = 0.68). However, neonates in the control group had a significant increase in osmolarity from the day after birth to about one week after birth (t = 4.49, p = 0.021).  
```
Figure

First, adding new variable for the figure. 
```{r}
Time_Msmt_Taken = c(8, 5, 5, 6, 6, 5, 5, 5, rep(1, times = 8))

fig_df <- cbind(osmol_analysis_df_temp, Time_Msmt_Taken)
colnames(fig_df)[16] <- "Time_Msmt_Taken"
```

```{r}
ggplot(data = fig_df, 
              aes(x = Time_Msmt_Taken, 
                  y = clutch_osmol_avg, 
                  colour = Treatment)) +
  geom_point(data = fig_df, 
              aes(x = Time_Msmt_Taken, 
                  y = clutch_osmol_avg, 
                  colour = Treatment),
                 size = 2,
                alpha = 0.5) +
  theme_classic() +
  geom_line(aes(group = Mother_ID)) +
  annotate(geom = "text", x = 6.5, y = 275, label = "p = 0.68", 
           size = 5, color = "royalblue4") +
  annotate(geom = "text", x = 3, y = 360, label = "p = 0.021", 
           size = 5, color = "orange2") +
  scale_color_manual(values = c("C" = "orange2", "W" = "royalblue4")) +
  labs(x = "Number of Days Since Birth", y = "Clutch Osmolality (mmol kg-1)") +
  theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right") +
  scale_y_continuous(limits = c(270, 370), breaks = seq(270, 370, by = 20)) +
  scale_x_continuous(limits = c(1, 8), breaks = seq(1, 8, by = 1)) -> clutches_change_osmol
```

```{r}
ggarrange(neonate_change_osmol_1,
           clutches_change_osmol,
          ncol = 1, nrow = 2,
          labels = c("A", "B"),
          common.legend = TRUE,
          legend = "bottom"
          ) -> neonate_change_osmol_fig

ggsave("Neonate Change in Osmolality 2 Panel.png", 
       plot = neonate_change_osmol_fig, 
       width = 6, 
       height = 12)
```


#CEWL vs OSMOLARITY
Day after birth
```{r}
cor(DAB_neonate_df$clutch_osmol_avg, DAB_neonate_df$clutch_CEWL_avg)
cor.test(DAB_neonate_df$clutch_osmol_avg, DAB_neonate_df$clutch_CEWL_avg)

lm <- lm(data = DAB_neonate_df, clutch_CEWL_avg ~ clutch_osmol_avg)
summary(lm)
anova(lm)
#Result: For neonates the day after birth, there is a slightly insignificant positive relationship between osmolarity and CEWL (estimate = 0.10, SE = 0.051, F(1,16) = 3.79, p = 0.070).

```
Maybe a slight correlation
Figure:
```{r}
ggplot(data = DAB_neonate_df) +
  geom_point(aes(x = clutch_osmol_avg, 
           y = clutch_CEWL_avg), 
             size = 2, 
             alpha = 0.7,
           color = "springgreen3") +
  annotate(geom = "text", 
           x = 360, 
           y = 25, 
           label = "p = 0.07", 
           size = 5) +
  theme_classic() +
  geom_smooth(aes(x = clutch_osmol_avg, 
           y = clutch_CEWL_avg),
              method = "lm", 
              se = TRUE,
              size = 1,
              color = "black") +
  labs(x = "Clutch Plasma Osmolality (mmol kg-1)", 
       y = "Clutch CEWL (g m2h-1)",
       color = "Treatment") +
  theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right") +
  scale_x_continuous(limits = c(280, 383), breaks = seq(280, 383, by = 20)) +
  scale_y_continuous(limits = c(5, 33),
                  breaks = seq(5, 33, by = 5)) -> neonate_CEWL_v_osmol

ggsave("Neonate CEWl v Osmol DAB.png", 
       plot = neonate_CEWL_v_osmol, 
       width = 7, 
       height = 4)
```
Second msmt
```{r}
cor(PS_neonate_df$clutch_osmol_avg, PS_neonate_df$clutch_CEWL_avg)
cor.test(PS_neonate_df$clutch_osmol_avg, PS_neonate_df$clutch_CEWL_avg)

ps_lm <- lm(data = PS_neonate_df, clutch_CEWL_avg ~ clutch_osmol_avg)
summary(ps_lm)
anova(ps_lm)
#Result: For neonates post shedding, there is no significant relationship between osmolarity and CEWL. However, the relationship is still positive (estimate = 0.012, SE = 0.013, F(1,6) = 0.94, p = 0.37, R = 0.37). 
```
Slight correlation? 
Figure:
```{r}
ggplot(data = PS_neonate_df) +
  geom_point(aes(x = clutch_osmol_avg, 
           y = clutch_CEWL_avg), 
             size = 2, 
             alpha = 0.7,
           color = "springgreen3") +
  annotate(geom = "text", 
           x = 340, 
           y = 25, 
           label = "p = 0.37", 
           size = 5) +
  theme_classic() +
  geom_smooth(aes(x = clutch_osmol_avg, 
           y = clutch_CEWL_avg),
              method = "lm", 
              se = TRUE,
              size = 1,
              color = "black") +
  labs(x = "Clutch Plasma Osmolality (mmol kg-1)", 
       y = "Clutch CEWL (g m2h-1)",
       color = "Treatment") +
  theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right") +
  scale_x_continuous(limits = c(280, 383), breaks = seq(280, 383, by = 20)) +
  scale_y_continuous(limits = c(5, 33),
                  breaks = seq(5, 33, by = 5)) -> clutch_Cewl_v_osmol_ps

?geom_smooth
```
#Mass by Treatment
```{r}
#Day after birth 
mass_tmt_lm <- lm(data = DAB_neonate_df, clutch_Mass_avg ~ Treatment)

summary(mass_tmt_lm)
anova(mass_tmt_lm)

#post shed 
mass_tmt_ps_lm <- lm(data = PS_neonate_df, clutch_Mass_avg ~ Treatment)

summary(mass_tmt_ps_lm)
anova(mass_tmt_ps_lm)
```
#Body Condition by Treatment
```{r}
#Day after birth 
BC_tmt_lm <- lm(data = DAB_neonate_df, clutch_BodyCond_avg ~ Treatment)

summary(BC_tmt_lm)
anova(BC_tmt_lm)

#post shed 
BC_tmt_ps_lm <- lm(data = PS_neonate_df, clutch_BodyCond_avg ~ Treatment)

summary(BC_tmt_ps_lm)
anova(BC_tmt_ps_lm)
```
#Pub Fig: Clutch osmol and cewl raw
```{r}
ggarrange(neonate_DAB_osmol, clutch_cewl_dab_tmt ,
          ncol = 1, nrow = 2,
          labels = c("A", "B"),
          common.legend = TRUE,
          legend = "bottom",
          align = "v"
          ) -> neonate_cewl_osmol_dab_fig

ggsave("Clutch CEWL and Osmol raw DAB.png", 
       plot = neonate_cewl_osmol_dab_fig, 
       width = 5, 
       height = 11)
```
#***SAVANNAH: MASS ANALYSIS
```{r}
new_mass_lm_neo <- lmer(data = neonate_analysis_df, clutch_Mass_avg ~ Shed * Treatment + (1|Mother_ID))

Means_n <- emmeans(new_mass_lm_neo, pairwise ~ Shed | Treatment)
Means_n$emmean
Means_n$contrasts

Means_n2 <- emmeans(new_mass_lm_neo, pairwise ~ Treatment | Shed)
Means_n2$emmean
Means_n2$contrasts

new_mass_lm_neo_CI <- data.frame(emmeans(new_mass_lm_neo, pairwise ~ Treatment | Shed)$emmean)

new_mass_lm_neo_CI <- new_mass_lm_neo_CI %>% 
  mutate(Shed = str_replace_all(Shed, "N", "At Birth")) %>%
  mutate(Shed = str_replace_all(Shed, "Y", "After Shedding"))
```


#Change in Mass
Making a new column for the change in mass
```{r}
neonate_analysis_df_2 <- neonate_analysis_df %>%
  group_by(Mother_ID) %>%
  arrange(Shed) %>%
  mutate(delta_mass = clutch_Mass_avg - lag(clutch_Mass_avg)) %>%
  filter(complete.cases(delta_mass))
```

#Change in CEWL new
```{r}
  neonate_analysis_df_cewl <- neonate_analysis_df %>%
  group_by(Mother_ID) %>%
  arrange(Shed) %>%
  mutate(delta_cewl = clutch_CEWL_avg - lag(clutch_CEWL_avg)) %>%
  filter(complete.cases(delta_cewl))
```

T-test to see if the change in mass is significantly different from 0. T-test on the mean change in mass, so only one observation per indiv. Don't need a paired t-test. 
```{r}
t.test(neonate_analysis_df_2$delta_mass)
#Result: 
```
Now seeing if the change in mass is significantly different between treatments 
```{r}
mass_lm_neonate <- lm(data = neonate_analysis_df_2, 
   delta_mass ~ Treatment)

summary(mass_lm_neonate)
anova(mass_lm_neonate)

#The change in mass was significantly different for the two treatment groups (estimate = 1.09 SE = 0.21, F(1, 6) = 26.99, p = 0.0020). Both negative. 
```
Creating a df with only W treatment and only C treatment 
```{r}
neonate_analysis_df_2_hyd <- neonate_analysis_df_2 %>%
  filter(Treatment == "W")

neonate_analysis_df_2_control <- neonate_analysis_df_2 %>%
  filter(Treatment == "C")
```

T-test to see if the change in mass is significantly different from 0 for hydration group.
```{r}
t.test(neonate_analysis_df_2_hyd$delta_mass)
#For neonates in the hydration treatment, mass significantly decreased after shedding (t = -8.76, df = 3, p = 0.0031)
```
T-test to see if the change in mass is significantly different from 0 for control group.
```{r}
t.test(neonate_analysis_df_2_control$delta_mass)
#For neonates in the control treatment, mass significantly decreased after shedding (t = -12.67, df = 3, p = 0.0010)
```
```{r}
neo_mass_lm_CI <- data.frame(emmeans(mass_lm_neonate, "Treatment"))
```


Figure
```{r}
ggplot() +
  geom_jitter(data = neonate_analysis_df_2, 
             aes(x = Treatment, 
                 y = delta_mass, 
                 color = Treatment),
             size = 2,
             alpha = 0.5) +
  geom_point(data = neo_mass_lm_CI, 
             aes(x = Treatment, 
                 y = emmean),
             color = "black", 
             size = 2) +
  theme_classic() +
  geom_hline(yintercept = 0, linetype = 'dashed', col = 'grey') +
 annotate(geom = "text", x = 1, y = -0.5, label = "p = 0.0020", 
           size = 5) +
  scale_color_manual(values = c("C" = "orange2", "W" = "royalblue4")) +
  labs(x = "", y = "Change in Mass (g)", colour = "Hydration Treatment") +
  geom_errorbar(data = neo_mass_lm_CI, aes(x = Treatment,
                               y = emmean, 
                               ymin = lower.CL, 
                               ymax = upper.CL,
                               width = .3),
                color = "black")+
  theme(text = element_text(color = "black", 
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16)) +
  scale_y_continuous(limits = c(-2.7, 0),
                  breaks = seq(-2.5, 0, by = 0.5)) -> neonate_change_mass
```

```{r}
neonate_analysis_df[ , 12] <- factor(neonate_analysis_df$Shed, levels = c("N", "Y"), labels = c("Day After Birth", "After Shedding"))
```

```{r}
neonate_analysis_df_2 <- neonate_analysis_df_2 %>%
  mutate(mass_relative = 0)
```

```{r}
neonate_analysis_df_2[ , 12] <- factor(neonate_analysis_df_2$Shed, levels = c("N", "Y"), labels = c("Day After Birth", "After Shedding"))
```

```{r}
mass_df_neo <- full_join(neonate_analysis_df, neonate_analysis_df_2)

as.numeric(mass_df_neo$delta_mass)

mass_df_neo[ ,16] <- replace(mass_df_neo$delta_mass,is.na(mass_df_neo$delta_mass), 0)

mass_df_neo_final <- mass_df_neo[1:16, ]

change_mass_relative <- c(8, 5, 5, 6, 6, 5, 5, 5, 1, 1, 1, 1, 1, 1, 1, 1)

mass_df_neo_final_2 <- cbind(mass_df_neo_final, change_mass_relative)
```

```{r}
  ggplot(data = mass_df_neo_final_2, 
         aes(x = change_mass_relative, 
           y = delta_mass, 
           colour = Treatment)) +
  geom_point(data = mass_df_neo_final,
             aes(x = change_mass_relative, 
                 y = delta_mass, 
                 colour = Treatment),
                 size = 2,
                alpha = 0.5) +
  theme_classic() +
  geom_hline(yintercept = 0, linetype = 'dashed', col = 'grey')+
  geom_line(aes(group = Mother_ID)) +
  annotate(geom = "text", x = 5, y = -0.3, label = "p = 0.0031", 
           size = 5, color = "royalblue4") +
  annotate(geom = "text", x = 2, y = -2, label = "p = 0.0010", 
           size = 5, color = "orange2") +
  scale_color_manual(values = c("C" = "orange2", "W" = "royalblue4")) +
  labs(x = "Days Since Birth", y = "Change in Mass (g)", colour = "Hydration Treatment") +
  theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right") +
  scale_x_continuous(limits = c(0, 8),
                  breaks = c(0, 1, 2, 3, 4, 5, 6, 7, 8)) -> neonate_change_mass_idiv
```

```{r}
ggarrange(neonate_change_mass,
           neonate_change_mass_idiv,
          ncol = 1, nrow = 2,
          labels = c("A", "B"),
          common.legend = TRUE,
          legend = "bottom"
          ) -> neonates_change_mass

ggsave("neonates change in mass.png", 
       plot = neonates_change_mass, 
       width = 6, 
       height = 12)
```
#****PUBLICATION FIGURES
##****FIGURE 2
###osmol fig
```{r}
ggplot() +
  geom_jitter(data = DAB_neonate_df, 
             aes(x = Treatment, 
                 y = clutch_osmol_avg, 
                 color = Treatment,
                 shape = Treatment),
                 size = 4,
                alpha = 0.5) +
 geom_point(data = neonate_osmol_CI, 
             aes(x = Treatment, 
                 y = emmean,
                 color = Treatment,
                 shape = Treatment), 
             size = 4) +
  theme_classic() +
  scale_x_discrete(labels = c("Control", "Hydration")) +
 # annotate(geom = "text", x = 1.5, y = 320, label = "p = 0.018", 
          # size = 5) +
  annotate(geom = "text", x = 1.5, y = 320, label = "*", 
           size = 10) +
  scale_color_manual(values = c("orange2", "royalblue4"), 
                     labels = c("C" = "Control", "W" = "Hydration Treatment"), name = NULL) +
  scale_shape_manual(values = c(15, 17), name = NULL, 
                     labels = c("C" = "Control", "W" = "Hydration Treatment")) +
  labs(x = "", y = "Clutch Avg. Osmolality (mmol kg-1)") +
  geom_errorbar(data = neonate_osmol_CI, aes(x = Treatment,
                               y = emmean, 
                               ymin = lower.CL, 
                               ymax = upper.CL,
                               width = .3,
                               color = Treatment)) +
  theme(text = element_text(color = "black", 
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16)) -> neonate_DAB_osmol_pub
```
###cewl fig
```{r}
ggplot() +
  geom_jitter(data = DAB_neonate_df, 
             aes(x = Treatment, 
                 y = clutch_CEWL_avg, 
                 color = Treatment,
                 shape = Treatment),
             size = 4,
             alpha = 0.5) +
  geom_point(data = neonate_cewl_CI, 
             aes(x = Treatment, 
                 y = emmean,
                 color = Treatment,
                 shape = Treatment), 
                 size = 4) +
  theme_classic() +
  scale_x_discrete(labels = c("Control", "Hydration")) +
  annotate(geom = "text", x = 1.5, y = 17, label = "NS", 
           size = 4) +
  scale_color_manual(values = c("orange2", "royalblue4"), 
                     labels = c("C" = "Control", "W" = "Hydration Treatment"), name = NULL) +
  scale_shape_manual(values = c(15, 17), name = NULL, 
                     labels = c("C" = "Control", "W" = "Hydration Treatment")) +
  labs(x = "", y = "Clutch Avg. CEWL (g m2h-1)") +
  geom_errorbar(data = neonate_cewl_CI, aes(x = Treatment,
                               y = emmean, 
                               ymin = lower.CL, 
                               ymax = upper.CL,
                               width = .3,
                               color = Treatment)) +
  theme(text = element_text(color = "black", 
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16)) +
  scale_y_continuous(limits = c(4.5, 17),
                  breaks = seq(5, 17, by = 2)) -> clutch_cewl_dab_tmt_pub
```
####arrange
```{r}
ggarrange(neonate_DAB_osmol_pub, clutch_cewl_dab_tmt_pub ,
          ncol = 1, nrow = 2,
          labels = c("A", "B"),
          common.legend = TRUE,
          legend = "bottom",
          align = "v"
          ) -> neonate_cewl_osmol_dab_fig_pub

ggsave("Publication Figure 2.png", 
       plot = neonate_cewl_osmol_dab_fig_pub, 
       width = 5, 
       height = 12.5)
```

##****FIGURE 3
###mass raw fig
```{r}

mass_df_neo_final_2 <- mass_df_neo_final_2 %>% 
  mutate(Shed = str_replace_all(Shed, "Day After Birth", "At Birth"))

mass_df_neo_final_2$Shed <- factor(mass_df_neo_final_2$Shed, levels = c("At Birth", "After Shedding"))

ggplot() +
  geom_jitter(mass_df_neo_final_2, 
             mapping = aes(x = Shed, 
                 y = clutch_Mass_avg, 
                 color = Treatment,
                 shape = Treatment),
             size = 3,
             alpha = 0.5,
             show.legend = TRUE,
             position = position_jitter(height = 0, width = 0.3)) +
  theme_classic() +
#annotate(geom = "text", x = 2, y = 18, label = "*", 
      #     size = 8) +
 annotate(geom = "text", x = 2.5, y = 14.5, label = "*", 
           size = 10, color = "royalblue4") +
 annotate(geom = "text", x = 2.5, y = 12.5, label = "*", 
           size = 10, color = "orange2") +
 annotate(geom = "text", x = 1, y = 19.5, label = "NS", 
           size = 4) +
 annotate(geom = "text", x = 2, y = 19.5, label = "*", 
           size = 10, color = "black") +
  scale_color_manual(values = c("orange2", "royalblue4"), labels = c("C" = "Control", "W" = "Hydration Treatment"), name = NULL) +
  scale_shape_manual(values = c(15, 17), name = NULL, labels = c("C" = "Control", "W" = "Hydration Treatment")) +
  labs(x = "", y = "Clutch Avg. Mass (g)", color = "Treatment") +
  geom_line(data = new_mass_lm_neo_CI,
                aes(x = Shed,
                               y = emmean, 
                               width = .3,
                    group = Treatment,
                   # group = 1,
                    color = Treatment)) +
  geom_errorbar(data = new_mass_lm_neo_CI, 
                aes(x = Shed,
                               y = emmean, 
                               ymin = lower.CL, 
                               ymax = upper.CL,
                               width = .3,
                    color = Treatment)) +
  geom_point(data = new_mass_lm_neo_CI, 
             aes(x = Shed, 
                 y = emmean,
                 color = Treatment,
                 shape = Treatment), 
             size = 4) +
   theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right") +
  scale_y_continuous(limits = c(10, 19.5), 
                     breaks = seq(11, 19, by = 2)) -> neonate_mass_all_fig_pub
```
###change in mass fig

```{r}
#new
  ggplot(mass_df_neo_final_2, 
         aes(x = Shed, 
           y = delta_mass, 
           colour = Treatment,
           shape = Treatment)) +
  geom_hline(yintercept = 0, linetype = 'dashed', col = 'grey')+
  geom_point(data = mass_df_neo_final_2,
             aes(x = Shed, 
                 y = delta_mass, 
                 colour = Treatment),
                 size = 3,
                alpha = .5) +
  theme_classic() +
  annotate(geom = "text", x = 2.5, y = -1.25, label = "*", 
          size = 10, color = "royalblue4") +
  annotate(geom = "text", x = 2.5, y = -2, label = "*", 
           size = 10, color = "orange2") +
  annotate(geom = "text", x = 2, y = -0.25, label = "*", 
           size = 10, color = "black") +
  geom_line(aes(group = Mother_ID), alpha = 0.5) +
 # annotate(geom = "text", x = 1, y = 30, label = "p = 0.0048", 
    #       size = 5, color = "royalblue4") +
 # annotate(geom = "text", x = 1, y = -30, label = "p = 0.0011", 
   #        size = 5, color = "orange2") +
  scale_color_manual(values = c("orange2", "royalblue4"), labels = c("C" = "Control", "W" = "Hydration Treatment"), name = NULL) +
  scale_shape_manual(values = c(15, 17), name = NULL, labels = c("C" = "Control", "W" = "Hydration Treatment")) +
  labs(x = "", y = "Change in Mass (g)", colour = "Hydration Treatment") +
  theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right") -> change_mass_neo_indiv_pub
```

#```{r}
This is the old fig
  ggplot(data = mass_df_neo_final_2, 
         aes(x = change_mass_relative, 
           y = delta_mass, 
           colour = Treatment,
           shape = Treatment)) +
  geom_point(data = mass_df_neo_final,
             aes(x = change_mass_relative, 
                 y = delta_mass, 
                 colour = Treatment,
                 shape = Treatment),
                 size = 3,
                alpha = 1) +
  theme_classic() +
    geom_line(aes(group = Mother_ID), alpha = 0.5) +
  geom_hline(yintercept = 0, linetype = 'dashed', col = 'grey') +
 # annotate(geom = "text", x = 4.5, y = -0.3, label = "p = 0.0031", 
        #   size = 5, color = "royalblue4") +
 # annotate(geom = "text", x = 2, y = -2, label = "p = 0.0010", 
    #       size = 5, color = "orange2") +
  annotate(geom = "text", x = 10, y = -1, label = "*", 
          size = 10, color = "royalblue4") +
  annotate(geom = "text", x = 10, y = -2, label = "*", 
           size = 10, color = "orange2") +
  #annotate(geom = "text", x = 4, y = -0.25, label = "*", 
   #        size = 8) +
 scale_color_manual(values = c("orange2", "royalblue4"), 
                    labels = c("C" = "Control", "W" = "Hydration Treatment"), name = NULL) +
  scale_shape_manual(values = c(15, 17), name = NULL, 
                     labels = c("C" = "Control", "W" = "Hydration Treatment")) +
  labs(x = "", y = "Change in Mass (g)", colour = "Hydration Treatment") +
  theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right") +
  scale_x_continuous(limits = c(0, 10),
                  breaks = c(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10)) -> neonate_change_mass_idiv_pub


###osmol raw fig
```{r}
fig_df <- fig_df %>% 
  mutate(Shed = str_replace_all(Shed, "N", "At Birth")) %>%
  mutate(Shed = str_replace_all(Shed, "Y", "After Shedding"))

fig_df$Shed <- factor(fig_df$Shed, levels = c("At Birth", "After Shedding"))

ggplot() +
  geom_jitter(fig_df, 
             mapping = aes(x = Shed, 
                 y = clutch_osmol_avg, 
                 color = Treatment,
                 shape = Treatment),
             size = 3,
             alpha = 0.5,
             show.legend = TRUE,
             position = position_jitter(height = 0, width = 0.3)) +
  theme_classic() +
annotate(geom = "text", x = 2, y = 370, label = "*", 
           size = 10) +
 annotate(geom = "text", x = 2.5, y = 340, label = "*", 
           size = 10, color = "orange2") +
 annotate(geom = "text", x = 1, y = 372, label = "NS", 
           size = 4) +
 annotate(geom = "text", x = 2.5, y = 288, label = "NS", 
           size = 4, color = "royalblue4") +
# annotate(geom = "text", x = 2.5, y = 318, label = "//", 
    #       size = 6) +
  scale_color_manual(values = c("orange2", "royalblue4"), labels = c("C" = "Control", "W" = "Hydration Treatment"), name = NULL) +
  scale_shape_manual(values = c(15, 17), name = NULL, labels = c("C" = "Control", "W" = "Hydration Treatment")) +
  labs(x = "", y = "Clutch Avg. Osmol. (mmol kg-1)", color = "Treatment") +
  geom_line(data = neo_osmol_lmer_CI,
                aes(x = Shed,
                               y = emmean, 
                               width = .3,
                    group = Treatment,
                   # group = 1,
                    color = Treatment)) +
  geom_errorbar(data = neo_osmol_lmer_CI, 
                aes(x = Shed,
                               y = emmean, 
                               ymin = lower.CL, 
                               ymax = upper.CL,
                               width = .3,
                    color = Treatment)) +
  geom_point(data = neo_osmol_lmer_CI, 
             aes(x = Shed, 
                 y = emmean,
                 color = Treatment,
                 shape = Treatment), 
             size = 4) +
   theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right") +
  scale_y_continuous(limits = c(270, 375), 
                    breaks = seq(270, 375, by = 20)) -> neonate_osmol_all_fig_pub
```
###change in osmol fig
```{r}
#new



mass_df_neo_final_2_test <- mass_df_neo_final_2 %>%
  group_by(Mother_ID) %>%
  arrange(Shed) %>%
  mutate(delta_osmol = clutch_osmol_avg - lag(clutch_osmol_avg))

mass_df_neo_final_2_test$Shed <- factor(mass_df_neo_final_2_test$Shed, levels = c("At Birth", "After Shedding"))

mass_df_neo_final_2_test$delta_osmol[is.na(mass_df_neo_final_2_test$delta_osmol)] <- 0


  ggplot(mass_df_neo_final_2_test, 
         aes(x = Shed, 
           y = delta_osmol, 
           colour = Treatment,
           shape = Treatment)) +
  geom_hline(yintercept = 0, linetype = 'dashed', col = 'grey')+
  geom_point(data = mass_df_neo_final_2_test,
             aes(x = Shed, 
                 y = delta_osmol, 
                 colour = Treatment),
                 size = 3,
                alpha = .5) +
  theme_classic() +
 # annotate(geom = "text", x = 2.5, y = -1.25, label = "*", 
  #        size = 10, color = "royalblue4") +
 annotate(geom = "text", x = 2.5, y = 50, label = "*", 
          size = 10, color = "orange2") +
 annotate(geom = "text", x = 2, y = 80, label = "*", 
          size = 10) +
annotate(geom = "text", x = 2.5, y = -3, label = "NS", 
          size = 4, color = "royalblue4") +
  geom_line(aes(group = Mother_ID), alpha = 0.5) +
 # annotate(geom = "text", x = 1, y = 30, label = "p = 0.0048", 
    #       size = 5, color = "royalblue4") +
 # annotate(geom = "text", x = 1, y = -30, label = "p = 0.0011", 
   #        size = 5, color = "orange2") +
  scale_color_manual(values = c("orange2", "royalblue4"), labels = c("C" = "Control", "W" = "Hydration Treatment"), name = NULL) +
  scale_shape_manual(values = c(15, 17), name = NULL, labels = c("C" = "Control", "W" = "Hydration Treatment")) +
  labs(x = "", y = "Change in Osmol. (mmol kg-1)", colour = "Hydration Treatment") +
  theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right") +
   scale_y_continuous(limits = c(-20, 80),
                  breaks = c(-20, 0, 20, 40, 60, 80)) -> change_osmol_neo_pub
```
####arrange
```{r}
ggarrange(neonate_mass_all_fig_pub,
            change_mass_neo_indiv_pub,
            neonate_osmol_all_fig_pub,
          change_osmol_neo_pub,
          ncol = 2, nrow = 2,
          labels = c("A", "B", "C", "D"),
          common.legend = TRUE,
          legend = "bottom"
          ) -> neo_figure_3_publication

ggsave("Publication Figure 3.png", 
       plot = neo_figure_3_publication, 
       width = 10, 
       height = 12)
```

```{r}
#old osmol figure
ggplot(data = fig_df, 
              aes(x = Time_Msmt_Taken, 
                  y = clutch_osmol_avg, 
                  colour = Treatment,
                  shape = Treatment)) +
  geom_point(data = fig_df, 
              aes(x = Time_Msmt_Taken, 
                  y = clutch_osmol_avg, 
                  colour = Treatment,
                  shape = Treatment),
                 size = 2,
                alpha = 0.5) +
  theme_classic() +
  geom_line(aes(group = Mother_ID)) +
  annotate(geom = "text", x = 7.5, y = 350, label = "//", 
           size = 6, color = "orange2") +
  annotate(geom = "text", x = 3, y = 350, label = "*", 
           size = 8) +
 # annotate(geom = "text", x = 6.5, y = 275, label = "p = 0.68", 
    #       size = 5, color = "royalblue4") +
  #annotate(geom = "text", x = 3, y = 360, label = "p = 0.021", 
       #    size = 5, color = "orange2") +
  scale_color_manual(values = c("orange2", "royalblue4"), 
                    labels = c("C" = "Control", "W" = "Hydration Treatment"), name = NULL) +
  scale_shape_manual(values = c(15, 17), name = NULL, 
                     labels = c("C" = "Control", "W" = "Hydration Treatment")) +
  labs(x = "Days Since Birth", y = "Clutch Osmolality (mmol kg-1)") +
  theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right") +
  scale_y_continuous(limits = c(270, 370), breaks = seq(270, 370, by = 20)) +
  scale_x_continuous(limits = c(0, 8), breaks = seq(0, 8, by = 1)) -> clutches_change_osmol_pub
```

```{r}
ggarrange(neonate_change_mass_idiv_pub, clutches_change_osmol_pub,
          ncol = 1, nrow = 2,
          labels = c("A", "B"),
          common.legend = TRUE,
          legend = "bottom",
          align = "v"
          ) -> neonate_mass_osmol_chng_pub

ggsave("Clutch Mass and Osmol Change Pub.png", 
       plot = neonate_mass_osmol_chng_pub, 
       width = 5, 
       height = 11)
```

##****FIGURE 4

```{r}

  ggplot() +
  geom_jitter(data = neonate_analysis_df_ex,
              aes(x = mothers_cewl, 
                  y = clutch_CEWL_avg), 
             size = 3.5, 
             alpha = 1,
             color = "springgreen3") +
  annotate(geom = "text", x = 20, y = 4, label = "*", 
           size = 10) +
  theme_classic() +
  geom_smooth(data = neonate_analysis_df_ex,
              aes(x = mothers_cewl, 
                  y = clutch_CEWL_avg), 
              method = "lm", 
              se = TRUE,
              size = 1,
              color = "black") +
  labs(x = "Mother's CEWL (g m2h-1)", 
       y = "Clutch Avg. CEWL (g m2h-1)",
       color = "Treatment") +
  geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = "grey") +
  scale_color_manual(values = c("C" = "orange2", "W" = "dodgerblue")) +
  theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right",) +
 scale_x_continuous(breaks = seq(0, 28, by = 4), limits = c(0, 28)) +
  scale_y_continuous(limits = c(0, 20),
                  breaks = seq(0, 20, by = 4)) -> clutch_CEWL_dab_mothers_cewl

ggsave("Clutch CEWL vs Mothers CEWL.png", 
       plot =clutch_CEWL_dab_mothers_cewl, 
       width = 6, 
       height = 4)
```



##****FIGURE 5

###cewl raw fig
```{r}
ggplot() +
  geom_jitter(mass_df_neo_final_2, 
             mapping = aes(x = Shed, 
                 y = clutch_CEWL_avg, 
                 color = Treatment,
                 shape = Treatment),
             size = 4,
             alpha = 0.5,
             show.legend = TRUE,
             position = position_jitter(height = 0, width = 0.3)) +
  theme_classic() +
 annotate(geom = "text", x = 1, y = 20, label = "NS", 
           size = 4) +
 annotate(geom = "text", x = 2, y = 20, label = "NS", 
           size = 4) +
 annotate(geom = "text", x = 2.5, y = 16.25, label = "//", 
           size = 7) +
  scale_color_manual(values = c("orange2", "royalblue4"), labels = c("C" = "Control", "W" = "Hydration Treatment"), name = NULL) +
  scale_shape_manual(values = c(15, 17), name = NULL, labels = c("C" = "Control", "W" = "Hydration Treatment")) +
  labs(x = "", y = "Clutch Avg. CEWL (g m2h-1)", color = "Treatment") +
  geom_line(data = neo_cewl_lm_CI,
                aes(x = Shed,
                               y = emmean, 
                               width = .3,
                    group = Treatment,
                    color = Treatment)) +
  geom_errorbar(data = neo_cewl_lm_CI, 
                aes(x = Shed,
                               y = emmean, 
                               ymin = lower.CL, 
                               ymax = upper.CL,
                               width = .3,
                    color = Treatment)) +
  geom_point(data = neo_cewl_lm_CI, 
             aes(x = Shed, 
                 y = emmean,
                 color = Treatment,
                 shape = Treatment), 
             size = 4) +
   theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right") +
  scale_y_continuous(limits = c(7, 20), 
                     breaks = seq(7, 20, by = 2)) -> neonate_cewl_all_fig_pub
```
###change in cewl fig
```{r}
shed_analysis_df$Shed <- factor(shed_analysis_df$Shed, levels = c("Pre Shed", "Post Shed"), labels = c("At Birth", "After Shedding"))

#new
  ggplot(shed_analysis_df, 
         aes(x = Shed, 
           y = delta_cewl, 
           colour = Treatment,
           shape = Treatment)) +
  geom_hline(yintercept = 0, linetype = 'dashed', col = 'grey')+
  geom_point(shed_analysis_df,
             mapping = aes(x = Shed, 
                 y = delta_cewl, 
                 colour = Treatment),
                 size = 4,
                alpha = .5) +
  theme_classic() +
  annotate(geom = "text", x = 2, y = 11, label = "NS", 
           size = 4) +
  annotate(geom = "text", x = 2.4, y = 5.5, label = "//", 
           size = 7) +
  geom_line(aes(group = Mother_ID), alpha = 0.5) +
 # annotate(geom = "text", x = 1, y = 30, label = "p = 0.0048", 
    #       size = 5, color = "royalblue4") +
 # annotate(geom = "text", x = 1, y = -30, label = "p = 0.0011", 
   #        size = 5, color = "orange2") +
  scale_color_manual(values = c("orange2", "royalblue4"), labels = c("C" = "Control", "W" = "Hydration Treatment"), name = NULL) +
  scale_shape_manual(values = c(15, 17), name = NULL, labels = c("C" = "Control", "W" = "Hydration Treatment")) +
  labs(x = "", y = "Change in CEWL (g m2h-1)", colour = "Hydration Treatment") +
  theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right") +
  scale_y_continuous(limits = c(-2, 11), 
                     breaks = seq(-2, 11, by = 2))-> change_cewl_neo_pub
```
####arrange
```{r}
ggarrange(neonate_cewl_all_fig_pub, change_cewl_neo_pub,
          ncol = 2, nrow = 1,
          labels = c("A", "B"),
          common.legend = TRUE,
          legend = "bottom",
          align = "v"
          ) -> neonate_cewl_shed_pub_fig

ggsave("Neonate Ecdysis Pub Fig.png", 
       plot = neonate_cewl_shed_pub_fig, 
       width = 10, 
       height = 6)
```

```{r}
  ggplot(data = shed_analysis_df_temp, aes(x = Shed, 
           y = clutch_CEWL_avg, 
           colour = Treatment,
           shape = Treatment)) +
  geom_point(aes(x = Shed, 
           y = clutch_CEWL_avg, 
           colour = Treatment,
           shape = Treatment),
                 size = 2,
                alpha = 0.5) +
  theme_classic() +
  geom_line(aes(group = Mother_ID)) +
  annotate(geom = "text", x = 2.25, y = 16, label = "//", 
           size = 6) +
 #annotate(geom = "text", x = .75, y = 12, label = "p = 0.0088", 
         # size = 5, color = "black") +
  scale_color_manual(values = c("orange2", "royalblue4"), 
                    labels = c("C" = "Control", "W" = "Hydration\nTreatment"), name = NULL) +
  scale_shape_manual(values = c(15, 17), name = NULL, 
                     labels = c("C" = "Control", "W" = "Hydration\nTreatment")) +
  labs(x = "", y = "Clutch CEWL (g m2h-1)") +
  theme(text = element_text(color = "black",
                            size = 22),
        axis.text = element_text(color = "black", 
                                 size = 16),
        legend.text = element_text(color = "black",
                                 size = 22),
        plot.title = element_text(color = "black",
                                  size = 22),
        legend.text.align = 0,
        legend.position = "right",
        legend.spacing.y = unit(1, 'cm')) +
  scale_y_continuous(limits = c(7, 17.5), breaks = seq(7, 17, by = 2)) -> clutch_change_cewl_Fig_pub
  #scale_x_continuous(limits = c(1, 7.5), breaks = seq(1, 7, by = 1))

ggsave("Clutch Change in CEWL Pub Fig.png", 
       plot = clutch_change_cewl_Fig_pub, 
       width = 7, 
       height = 5)
```

