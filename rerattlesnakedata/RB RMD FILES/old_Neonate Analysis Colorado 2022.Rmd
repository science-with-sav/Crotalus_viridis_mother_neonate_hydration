---
title: "Neonate Analysis Colorado 2022"
author: "Robin Bedard"
date: '2022-12-03'
output: pdf_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library("ggplot2")
library("ggpubr")
library("lme4")
library("dplyr")
library("tidyverse")
library("stringr")
library("tidyr")
library("PerformanceAnalytics")
library("lmerTest")
library("readr")
library("AICcmodavg")
```

This includes the analysis for the neonates day after birth and dat after they shed. 

#NEONATES DAY AFTER BIRTH
##Reading in data
Reading in the data and merging the data sets. This includes all cewl data, osmolarity data, and all measurements.
```{r}
setwd("/Users/robinbedard/Desktop/Thesis/RDS_files")
#reading in the file of osmolarities for all neonates
neonate_dab_osmol <- readRDS("clean_Neonate_DAB_Osmolality.RDS")
#reading in all other body measurements of neonates
neonate_dab_all <- readRDS("FinalNeonateDAB.RDS")
#joinging them together to create 1 df
neonate_dab_all_final <- left_join(neonate_dab_all, neonate_dab_osmol, by = c("CEWL_Blood_Collect_Date", "Indiv_ID"))
#reading in CEWL data
all_data_CEWL <- readRDS("CEWL_data_all_clean.RDS")
#merging all together
neonate_dab_all_final <- left_join(neonate_dab_all_final, all_data_CEWL, by = c("Indiv_ID" = "individual_ID", "CEWL_Blood_Collect_Date" = "date"))
```


##Body Temperature Calibration

First, uploading the thermocouple calibration csv and the thermocouple reference csv. Join them together.
```{r}
setwd("/Users/robinbedard/Desktop/Thesis/csv files")
thermo_c <- read.csv("thermoc_calibration.csv")
thermo_coupl <- thermo_c %>%
  dplyr::select(Time, Value) %>% 
  mutate(Time = as.POSIXct(substr(Time, 1,5), format = "%H:%M"))

thermo_ref <- read.csv("thermalcouple_c_reference.csv") %>% 
  mutate(Time = as.POSIXct(Time, format = "%H:%M"))

thermo_c_final <- left_join(thermo_coupl, thermo_ref, by = "Time")
```

Now calibrate the data
```{r}
#Calibrate Thermocouple Data
#First, calculate and save regression curves:
# calculate regression curves
regression_a <- lm(data = thermo_c_final,
                   Value ~ Temp)

# create df to store calibration equations
TC_calibration <- data.frame(TC_A = (coef(regression_a))) %>%
  `rownames<-`(c("intercept", "slope"))

#Next, use calibration curves to correct the data we measured:
# this applies respective calibration equation
# to all cloacal thermocouple data points of that proper thermocouple
# 2=slope & 1=intercept

neonate_dab_all_final <- neonate_dab_all_final %>%
  mutate(calibrated_cloacal_temp = Tb_CEWL_c*TC_calibration$TC_A[2] +
           TC_calibration$TC_A[1])

summary(neonate_dab_all_final)
```
Now I have a new column with the calibrated cloacal temperature at the time the measurement was taken. 

##NEONATES NOT AS REPLICATES
###Osmolarity
Figure: Osmolarity by treatment group; ttest
```{r}
ggplot(data = neonate_dab_all_final) +
  geom_boxplot(aes(x = Treatment, y = Plasma_Osmol_Rep_mean), fill = "lightblue", color = "black", outlier.fill = "lightgreen", outlier.colour = "black", outlier.shape = 21, outlier.size = 2) +
  labs(title = "Plasma Osmolality of Neonates Day After Birth",
       subtitle = "by Treatment Group", 
       x = "Hydration Treatment",
       y = "Mean Osmolality (mmol/kg)") +
  stat_summary(aes(x = Treatment, y = Plasma_Osmol_Rep_mean), fun = "mean", color= "red", shape = 16) +
  scale_y_continuous(limits = c(250, 380),
                     breaks = seq(from = 250, to = 3650, by = 30)) +
  stat_compare_means(method = "t.test", aes(x = Treatment, y = Plasma_Osmol_Rep_mean))
```

Linear Model
```{r}
neonate_dab_osmol_lm <- lm(Plasma_Osmol_Rep_mean ~ Treatment, data = neonate_dab_all_final)
summary(neonate_dab_osmol_lm)
```

###CEWL

Figure: CEWL by treatment group
```{r}
ggplot(data = neonate_dab_all_final) +
  geom_boxplot(aes(x = Treatment, y = CEWL_g_m2h), fill = "lightblue", color = "black", outlier.fill = "lightgreen", outlier.colour = "black", outlier.shape = 21, outlier.size = 2) +
  labs(title = "CEWL of Neonates Day After Birth",
       subtitle = "by Treatment Group", 
       x = "Hydration Treatment",
       y = "CEWL") +
  stat_summary(aes(x = Treatment, y = CEWL_g_m2h), fun = "mean", color= "red", shape = 16) +
  #scale_y_continuous(limits = c(250, 380),
                    # breaks = seq(from = 250, to = 3650, by = 30)) +
  stat_compare_means(method = "t.test", aes(x = Treatment, y = CEWL_g_m2h))
```

Linear Model
```{r}
neonate_dab_cewl_lm <- lm(CEWL_g_m2h ~ Treatment, data = neonate_dab_all_final)
summary(neonate_dab_cewl_lm)
```

#CLUTCH AVERAGES: Day after birth

Fixing a mistake in the SVL. One individual has a SVL of 2.4 but it should be 24.0

```{r}
neonate_dab_all_final[53, 4] <- 24.0
```


#SMI (DAB)
Compute Scaled Mass Index. This is also known as the body condition index, or log-log residuals. I calculate as described by: Peig, J., & Green, A. J. (2009). New perspectives for estimating body condition from mass/length data: The scaled mass index as an alternative method. Oikos, 118(12), 1883â€“1891. https://doi.org/10.1111/j.1600-0706.2009.17643.x

##Step 1: Simple Linear Regression

```{r SMI SLR}

#Making linear model  to use in the creation of the SMI equations. 
DAB_SMI_LM <- lm(data = neonate_dab_all_final, Mass_g ~ SVL_cm)
summary(DAB_SMI_LM)

ggplot(data = DAB_SMI_LM,
       aes(x = SVL_cm, y = Mass_g)) +
geom_point()
```
##Step 2: Identify Outliers

```{r SMI equation outliers 1}
plot(DAB_SMI_LM)
#looks good enough
```
The conditions of linearity, equal error variance, and normality are all satisfied.
```{r SMI equation outliers 2}
boxplot(residuals(DAB_SMI_LM))
hist(residuals(DAB_SMI_LM)) 

boxplot(neonate_dab_all_final$SVL_cm)
hist(neonate_dab_all_final$SVL_cm)
```
Check average residual value:
```{r SMI equation outliers 3}
mean(residuals(DAB_SMI_LM))
median(residuals(DAB_SMI_LM))
```
Check for high leverage points:
```{r SMI equation outliers 4}
# compute values for observations  
high_leverage_dab <- data.frame(H = hatvalues(DAB_SMI_LM)) %>% 
  mutate(row = row_number())

# compute cutoff value 
h_bar <- (3*sum(high_leverage_dab$H))/nrow(high_leverage_dab)

# add to original dataframe 
# see which observations have extremely high leverage (if any)
#high_leverage_dat_females <- SLR_dat_Preg_female_only %>%
  #mutate(row = row_number()) %>%
  #left_join(., high_leverage_females, by = "row") %>%
 # dplyr::filter(H > h_bar) 

#high_leverage_dat_females
```
No points were indicated to be outliers based on residuals or a histogram, and there were no high leverage or influential points. Thus I can create a log-log model using the data as-is. Observation omissions are unlikely to increase generalizability.


 
##Step 3: log-log Regression

```{r SMI log log regression}
long_DAB_SMI_LM <- lm(data = neonate_dab_all_final, log(Mass_g) ~ log(SVL_cm))
summary(long_DAB_SMI_LM)
```
##Step 4: Extract Values
compute standardized major axis using the log-log regression equation:
```{r SMI equation}
r <- sqrt(0.4428) # Pearson's correlection coefficient (sqrt of R-squared)
b_OLS <- 2.2297 # regression slope
b_SMA <- b_OLS/r
```

mean length in capture data:
```{r mean SVL}
L0 <- mean(neonate_dab_all_final$SVL_cm, na.rm = TRUE)
```

##Step 5: Calculate Scaled Mass Index
Add SMI to an updated full_dat df - full_dat2
```{r join all data}
neonate_dab_all_final_temp <- neonate_dab_all_final %>%
  # compute SMI
  mutate(SMI = (22.66707/SVL_cm) ^ 3.350755)
                        
ggplot(SMI_values) + 
  geom_point(aes(x = Mass_g,
                 y = SMI))
```
#Creating clutch averages
Creating clutch averages for CEWL, Osmolarity, body temps, ambient temps, humidity. Since the neonates are technically replicates to get one value per mother, we have to average them 

Creating a new column with the averages of osmolarities in a clutch so the neonates are replicates. Then will add this to the mother analysis data frame. 
```{r}
neonate_dab_all_final2 <- neonate_dab_all_final_temp %>%                                  
  group_by(Mother_ID) %>%
  mutate(clutch_osmol_avg = mean(Plasma_Osmol_Rep_mean, na.rm = TRUE))
```

Creating a new column with the averages of CEWL, pee, body temps, ambient temps, humidity, SMI, Mass, and SVL in a clutch so the neonates are replicates. Then will add this to the mother analysis data frame
```{r}
neonate_dab_all_final3 <- neonate_dab_all_final2 %>%                                  
  group_by(Mother_ID) %>%
  mutate(clutch_CEWL_avg = mean(CEWL_g_m2h, na.rm = TRUE))

neonate_dab_all_final4 <- neonate_dab_all_final3 %>%
  mutate(Pee = as.factor(str_trim(Pee)))

neonate_dab_all_final5 <- neonate_dab_all_final4 %>%                                  
  group_by(Mother_ID) %>%
  mutate(Prop_Pee = sum(Pee == "Y")/sum(Pee == "Y" | Pee == "N"))

neonate_dab_all_final6 <- neonate_dab_all_final5 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_bodytemp_avg = mean(calibrated_cloacal_temp, na.rm = TRUE))

neonate_dab_all_final7 <- neonate_dab_all_final6 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_ambienttemp_avg = mean(msmt_temp_C, na.rm = TRUE))

neonate_dab_all_final8 <- neonate_dab_all_final7 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_ambienthumidity_avg = mean(msmt_RH_percent, na.rm = TRUE))

neonate_dab_all_final9 <- neonate_dab_all_final8 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_SVL_avg = mean(SVL_cm, na.rm = TRUE))

neonate_dab_all_final10 <- neonate_dab_all_final9 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_Mass_avg = mean(Mass_g, na.rm = TRUE))

neonate_dab_all_final11 <- neonate_dab_all_final10 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_SMI_avg = mean(SMI, na.rm = TRUE))
```

Making a dataframe that only has the relavent variables. Now there is only one value for each mother. This is what we want. 
```{r}
clutch_averages <- unique(neonate_dab_all_final11[ , c(8, 9, 19, 20, 21, 22, 23, 24, 25, 26, 27)])
summary(clutch_averages)

saveRDS(clutch_averages, "/Users/robinbedard/Desktop/Thesis/RDS_files/clutch_averages_RDS")
```

Adding a column for if neonates have shed (all no here)
```{r}
clutch_averages2 <- clutch_averages %>%
  mutate(Shed = "N")
```

This dataframe is now ready. I need to add the information from the post shed neonates. 

#NEONATES POST SHED
##Uploading Data
```{r}
neonate_postshed_clean <- readRDS("neonate_postshed_clean.RDS")
```

##Osmolarity Wrangling

I need to create a df with only the relevant osmolarity data information and a df with all other columns, save them both as RDS, then do the osmolarity wrangling. 

```{r}
neonate_postshed_final <- neonate_postshed_clean %>%
  dplyr::select(Indiv_ID, Date_Born, Tail_Length_cm, SVL_cm, Tail_SVL_Ratio, Mass_g, Sex, Mother_ID, Treatment, Tb_CEWL_c, Pee, CEWL_Blood_Collect_Date)

neonate_postshed_temp <- neonate_postshed_clean %>%
  dplyr::select(-c(Date_Born, Tail_Length_cm, SVL_cm, Tail_SVL_Ratio, Mass_g, Sex, Mother_ID, Treatment, Tb_CEWL_c, Pee))
```

```{r load data}
#Create a data frame called osml_reps_o.
osml_reps_0 <- neonate_postshed_temp 

#Creating a new df by selecting out all of the rep 1 values.
osml_reps_1 <- osml_reps_0 %>%
  dplyr::select(Indiv_ID, CEWL_Blood_Collect_Date, Date_Blood_Analyzed, Plasma_Osmol_Rep = Plasma_Osmol_Rep1) %>%
  mutate(Rep = "1") 

#Creating a new df by selecting out all of the rep 2 values. 
osml_reps_2 <- osml_reps_0 %>%
  dplyr::select(Indiv_ID, CEWL_Blood_Collect_Date, Date_Blood_Analyzed, Plasma_Osmol_Rep = Plasma_Osmol_Rep2) %>%
  mutate(Rep = "2") 

#Creating a new df by selecting out all of the rep 3 values.
osml_reps_3 <- osml_reps_0 %>%
  dplyr::select(Indiv_ID, CEWL_Blood_Collect_Date, Date_Blood_Analyzed, Plasma_Osmol_Rep = Plasma_Osmol_Rep3) %>%
  mutate(Rep = "3") 

#Creating a new df by selecting out all of the rep 4 values
osml_reps_4 <- osml_reps_0 %>%
  dplyr::select(Indiv_ID, CEWL_Blood_Collect_Date, Date_Blood_Analyzed, Plasma_Osmol_Rep = Plasma_Osmol_Rep4) %>%
  mutate(Rep = "4") 

#Rbinding all of the previously made df together so that all of the technical osmolarity replicates are in once column. They have to be like this for the analysis. Then, filter out all of the replicates so the data frame only consists of the complete cases. The incomplete cases are from the blood samples that didn't have enough plasma to run multiple replicates. 
osml_reps <- osml_reps_1 %>%
  rbind(osml_reps_2) %>%
  rbind(osml_reps_3) %>%
  rbind(osml_reps_4) %>%
dplyr::filter(complete.cases(Plasma_Osmol_Rep))

#View a summary of the osml_reps to see that all of the reps are in the same column
summary(osml_reps)
```

###Replicates

Now, I will try to identify outliers within the replicates for a given individual on a given date. There must be at least 3 replicates to do this, so the first thing I need to do is figure out which individuals/dates have enough replicates, then subset my data to be only those individuals.

###Individuals with 3+ Replicates

```{r separate data w enough reps to assess}

# identify the individuals with at least 3-4 osmolarity reps
enuf_reps <- osml_reps %>%
  group_by(Indiv_ID, CEWL_Blood_Collect_Date) %>%
  mutate(count = n()) %>%
  dplyr::filter(count > 2) %>%
  arrange(count)
enuf_reps

# identify individuals with 1-2 reps
not_reps <- osml_reps %>%
  group_by(Indiv_ID, CEWL_Blood_Collect_Date) %>%
  mutate(count = n()) %>%
  dplyr::filter(count < 3) %>%
  arrange(count)
not_reps

# check that the total number of observations still add to original 340
nrow(enuf_reps) + nrow(not_reps)
nrow(enuf_reps) + nrow(not_reps) == nrow(osml_reps)
```

### Assess Variation

We want the Coefficient of Variation (CV) among our technical replicates to be small. We need to calculate it to identify whether there may be outliers.

```{r calculate CVs}

#creating a variable cv to determine if there may be outliers. 
CVs <- enuf_reps %>%
  group_by(Indiv_ID, CEWL_Blood_Collect_Date) %>%
  summarise(mean = mean(Plasma_Osmol_Rep),
            SD = sd(Plasma_Osmol_Rep),
            CV = (SD/mean) *100,
            min = min(Plasma_Osmol_Rep),
            max = max(Plasma_Osmol_Rep),
            range = max - min
            )
summary(CVs)
hist(CVs$CV)
hist(CVs$range) 

#Not really any replicates here so cant really do this. 
```

Ideally, CV would be 10-15%. If it's larger, and one of the replicates is very different than the others, we can assume that the replicates that are closer together are more reliable. 

### Find Outliers

```{r create find outlier function}
# write function to find outliers for each individual on each date
find_outliers <- function(df) {
  
  # initiate dataframe to compile info and list to compile plots
  outliers <- data.frame()
  #boxplots <- list()

  # initiate a for loop to go through every who in df
  for(indiv_ch in unique(df$Indiv_ID)) {
    
    # select data for only the individual of interest
    df_sub <- df %>%
      dplyr::filter(Indiv_ID == as.numeric(indiv_ch))
    
    # make a boxplot
    df_sub %>%
      ggplot(.) +
      geom_boxplot(aes(x = as.factor(CEWL_Blood_Collect_Date),
                       y = Plasma_Osmol_Rep,
                       fill = as.factor(CEWL_Blood_Collect_Date))) +
      ggtitle(paste("Individual", indiv_ch)) +
      theme_classic() -> plot
    
    stats <- ggplot_build(plot)$data[[1]] %>%
  mutate(x = as.numeric(x))
    
    # print/save
    print(plot)
    #boxplots[[indiv_ch]] <- plot
    
    # extract outliers
    outs <- df_sub %>%
      group_by(Indiv_ID, CEWL_Blood_Collect_Date) %>%
      summarise(n=n()) %>%
      arrange(CEWL_Blood_Collect_Date) %>%
      mutate(x = seq(1, nrow(.))) %>%
      left_join(stats) %>%
      select(Indiv_ID, CEWL_Blood_Collect_Date, outliers)
    
    # add to running dataframe of outliers
    outliers <- outliers %>%
      rbind(outs)
  }
  #return(boxplots)
  return(outliers)
}

```




Now apply the function to the data:

```{r find outlier using boxplots, fig.show="hold", out.width="50%"}

#Running this will give boxplots for each individual with each date that blood samples were run. It will visually show if there are any outliers. 
par(mfrow = c(71, 2))
outliers_found <- find_outliers(enuf_reps)
outliers_found
par(mfrow = c(1, 1))



outliers_found %>%
  filter(outliers != "numeric(0)")
  
unique(outliers_found$outliers)
```

### Remove Outliers

```{r remove outlier}
#library(tidyverse)

#enuf_reps_trimmed$outliers[[1]]

# filter out the one NA
enuf_reps_trimmed <- enuf_reps %>%
  left_join(outliers_found, by = c("Indiv_ID", "CEWL_Blood_Collect_Date")) %>%
  dplyr::filter(outliers %nin% c("NULL")) %>% 
  dplyr::filter((Plasma_Osmol_Rep != outliers | outliers == "numeric(0)"))
```

### Average Remaining Replicates

Now that the outliers are removed from the technical replicates when there were enough replicates to identify them, I will average the remaining replicates of the rejoined data for lizards with 1-2 and 3-4 replicates.

```{r calculate means}
osml_means <- not_reps %>%
  rbind(enuf_reps_trimmed) %>%
  group_by(CEWL_Blood_Collect_Date, Indiv_ID) %>%
  summarise(Plasma_Osmol_Rep_mean = mean(Plasma_Osmol_Rep))
```

###Merging Dataframes
```{r}
neonate_postshed_all_final <- left_join(neonate_postshed_final, osml_means, by = c("CEWL_Blood_Collect_Date", "Indiv_ID"))
#reading in CEWL data
all_data_CEWL <- readRDS("CEWL_data_all_clean.RDS")
#merging all together
neonate_postshed_all_final <- left_join(neonate_postshed_all_final, all_data_CEWL, by = c("Indiv_ID" = "individual_ID", "CEWL_Blood_Collect_Date" = "date"))
```
 
Now the final dataframe has all of the neonate post shed measurements together. Now I will calibrate body temperature data. 

##Body Temperature Calibration

```{r}
setwd("/Users/robinbedard/Desktop/Thesis/csv files")
thermo_c <- read.csv("thermoc_calibration.csv")
thermo_coupl <- thermo_c %>%
  dplyr::select(Time, Value) %>% 
  mutate(Time = as.POSIXct(substr(Time, 1,5), format = "%H:%M"))

thermo_ref <- read.csv("thermalcouple_c_reference.csv") %>% 
  mutate(Time = as.POSIXct(Time, format = "%H:%M"))

thermo_c_final <- left_join(thermo_coupl, thermo_ref, by = "Time")
```

Calibrate Thermocouple Data
First, calculate and save regression curves: calculate regression curves
```{r}
regression_a <- lm(data = thermo_c_final,
                   Value ~ Temp)
```

Create df to store calibration equations
```{r}
TC_calibration <- data.frame(TC_A = (coef(regression_a))) %>%
  `rownames<-`(c("intercept", "slope"))
```

Next, use calibration curves to correct the data we measured:
this applies respective calibration equation to all cloacal thermocouple data points of that proper thermocouple. 2=slope & 1=intercept
```{r}
neonate_postshed_all_final_2 <- neonate_postshed_all_final %>%
  mutate(calibrated_cloacal_temp = Tb_CEWL_c*TC_calibration$TC_A[2] +
           TC_calibration$TC_A[1])
summary(neonate_postshed_all_final_2)
```

Body temperature data is complete.

##SMI (PS)
This equation was calculated above
```{r}
neonate_ps_all_final_temp <- neonate_postshed_all_final_2 %>%
  # compute SMI
  mutate(SMI = (22.66707/SVL_cm) ^ 3.350755)
```


##CLUTCH AVERAGES: Post Shed

Creating clutch averages for post shed
Creating clutch averages for CEWL, Osmolarity, ambient temp and humidity, body temp. Since the neonates are technically replicates to get one value per mother, we have to average them 

Creating a new column with the averages of osmolarities in a clutch so the neonates are replicates. Then will add this to the mother analysis data frame. 
```{r}
neonate_postshed_replicates <- neonate_ps_all_final_temp %>%                                  
  group_by(Mother_ID) %>%
  mutate(clutch_osmol_avg = mean(Plasma_Osmol_Rep_mean, na.rm = TRUE))
```

Creating a new column with the averages of CEWL, pee, ambient hum, ambient temp, cloacal temp, svl, mass, smi in a clutch so the neonates are replicates. Then will add this to the mother analysis data frame
```{r}
neonate_postshed_replicates2 <- neonate_postshed_replicates %>%                                  
  group_by(Mother_ID) %>%
  mutate(clutch_CEWL_avg = mean(CEWL_g_m2h, na.rm = TRUE))

neonate_postshed_replicates3 <- neonate_postshed_replicates2 %>%
  mutate(Pee = as.factor(str_trim(Pee)))

neonate_postshed_replicates4 <- neonate_postshed_replicates3 %>%                                  
  group_by(Mother_ID) %>%
  mutate(Prop_Pee = sum(Pee == "Y")/sum(Pee == "Y" | Pee == "N"))

neonate_postshed_replicates5 <- neonate_postshed_replicates4 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_bodytemp_avg = mean(calibrated_cloacal_temp, na.rm = TRUE))

neonate_postshed_replicates6 <- neonate_postshed_replicates5 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_ambienttemp_avg = mean(msmt_temp_C, na.rm = TRUE))

neonate_postshed_replicates7 <- neonate_postshed_replicates6 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_ambienthumidity_avg = mean(msmt_RH_percent, na.rm = TRUE))

neonate_postshed_replicates8 <- neonate_postshed_replicates7 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_SMI_avg = mean(SMI, na.rm = TRUE))

neonate_postshed_replicates9 <- neonate_postshed_replicates8 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_Mass_avg = mean(Mass_g, na.rm = TRUE))

neonate_postshed_replicates10 <- neonate_postshed_replicates9 %>%
  group_by(Mother_ID) %>%
  mutate(clutch_SVL_avg = mean(SVL_cm, na.rm = TRUE))
```

Making a dataframe that only has mother id, clutch cewl, and clutch osmolarity. Now there is only one value for each mother. This is what we want. 
```{r}
post_shed_clutch_averages <- unique(neonate_postshed_replicates10[ , c(8, 9, 19, 20, 21, 22, 23, 24, 25, 26, 27)])
summary(post_shed_clutch_averages)

saveRDS(post_shed_clutch_averages, "/Users/robinbedard/Desktop/Thesis/RDS_files/ps_clutch_averages_RDS")
```

Adding a column for if neonates have shed (all no here)
```{r}
post_shed_clutch_averages <- post_shed_clutch_averages %>%
  mutate(Shed = "Y")
```

#Joining the day after birth and post shed clutch average data frames

```{r}
all_clutch_averages <- full_join(post_shed_clutch_averages, clutch_averages2)
```
Adding columns for mothers osmolarity, cewl, and days mother was in treatment 

```{r}
Mother_ID <- as.factor(c(124, 124, 125, 125, 128, 128, 129, 129, 131, 131, 133, 133, 134, 134, 135, 135, 101, 103, 104, 105, 112, 114, 115, 119, 126, 127))

mothers_osmol <- as.numeric(c(300.75, NA, 288.99, 307.66, 305, 271.33, 314.66, 325, 310.5, NA, 329, NA, 304, NA, 301.25, 322.33, 326, 331.66, 318, 320.75, 281.66, 311.667, 357.25, 320.33, 309.25, 312.333 ))

mothers_cewl <- as.numeric(c(16.96, NA, 19.90, 13.8, 24, 23.115, 24.47, 15.38, 11.68, NA, 18.797, NA, 17.83, NA, 20.595, 14.914, 20.9125, 21.12, 18.405, 13.5, 19.7375, 16.2275, 21.254, 27.82, 10.265, 22.4625))

days_mom_in_tmt <- as.numeric(c(5, NA, 2, 9, 3, 10, 2, 9, 5, NA, 5, NA, 5, NA, 3, 9, 13, 15, 15, 14, 14, 14, 15, 13, 7, 9))

Shed <- c("N", "Y", "N", "Y", "N", "Y", "N", "Y", "N", "Y", "N", "Y", "N", "Y", "N", "Y", "N", "N", "N", "N", "N", "N", "N", "N", "N", "N")

mother_info <- data.frame(Mother_ID, mothers_osmol, mothers_cewl, days_mom_in_tmt, Shed)

neonate_analysis_df <- left_join(all_clutch_averages, mother_info, by = c("Mother_ID", "Shed"))
```

#ANALYSIS
#PLOTTING OSMOLARITY RAW DATA

##Osmolarity vs Treatment
###DAB and PS
```{r}
ggplot(data = neonate_analysis_df, aes(x = Treatment, y = clutch_osmol_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  labs(x = "Treatment", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```

###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = Treatment, y = clutch_osmol_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  labs(x = "Treatment", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
###Only PS
```{r}
neonate_analysis_df %>%
  filter(Shed == "Y") %>%
  ggplot(aes(x = Treatment, y = clutch_osmol_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  labs(x = "Treatment", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```

##Osmolarity vs CEWL
###DAB and PS
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_CEWL_avg, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "CEWL", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = clutch_CEWL_avg, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "CEWL", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
###Only PS
```{r}
neonate_analysis_df %>%
  filter(Shed == "Y") %>%
  ggplot(aes(x = clutch_CEWL_avg, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "CEWL", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```

##Osmoalarity vs Pee Proportions
Proportion of neonates in clutch that did pee
```{r}
  ggplot(data = neonate_analysis_df, aes(x = Prop_Pee, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Proportion of Neonates that 'Peed'", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
##Osmolarity vs. Body Temp
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_bodytemp_avg, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average Body Temp", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```

##Osmolarity vs Ambient Temp
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_ambienttemp_avg, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average Ambient Temp", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```

##Osmolarity vs Mother Osmolarity
Measurement taken on same day 
###DAB and PS
```{r}
  ggplot(data = neonate_analysis_df, aes(x = mothers_osmol, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Mother's Osmolarity", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = mothers_osmol, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Mother's Osmolarity", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
###Only PS
```{r}
neonate_analysis_df %>%
  filter(Shed == "Y") %>%
  ggplot(aes(x = mothers_osmol, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Mother's Osmolarity", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```

##Osmolarity vs Number of Days Mom in Treatment
###DAB and PS
```{r}
  ggplot(data = neonate_analysis_df, aes(x = days_mom_in_tmt, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Days Mother in Treatment", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = days_mom_in_tmt, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Days Mother in Treatment", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
##Osmolarity vs If Shed
```{r}
ggplot(data = neonate_analysis_df, aes(x = Shed, y = clutch_osmol_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  labs(x = "Post Shed Measurement", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
##Osmolarity vs SMI
###DAB and PS
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_SMI_avg, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average SMI", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```

###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = clutch_SMI_avg, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average SMI", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```
###Only PS
```{r}
neonate_analysis_df %>%
  filter(Shed == "Y") %>%
  ggplot(aes(x = clutch_SMI_avg, y = clutch_osmol_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average SMI", y = "Clutch Average Plasma Osmolarity (mmol/kg)")
```

#PLOTTING CEWL RAW DATA

##CEWL vs Treatment 
###DAB and PS
```{r}
ggplot(data = neonate_analysis_df, aes(x = Treatment, y = clutch_CEWL_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  labs(x = "Treatment", y = "Clutch Average CEWL")
```

```{r}
ggplot(data = neonate_analysis_df, aes(x = Treatment, y = clutch_CEWL_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  facet_wrap(~Shed) +
  labs(x = "Treatment", y = "Clutch Average CEWL")
```

###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = Treatment, y = clutch_CEWL_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  labs(x = "Treatment", y = "Clutch Average CEWL")
```
###Only PS
```{r}
neonate_analysis_df %>%
  filter(Shed == "Y") %>%
  ggplot(aes(x = Treatment, y = clutch_CEWL_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  labs(x = "Treatment", y = "Clutch Average CEWL")
```
##CEWL vs Osmolarity
###DAB and PS
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_osmol_avg, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Osmolarity", y = "Clutch Average CEWL")
```
###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = clutch_osmol_avg, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Osmolarity", y = "Clutch Average CEWL")
```
###Only PS
```{r}
neonate_analysis_df %>%
  filter(Shed == "Y") %>%
  ggplot(aes(x = clutch_osmol_avg, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Osmolarity", y = "Clutch Average CEWL")
```

##CEWL vs Body Temp
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_bodytemp_avg, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average Body Temp", y = "Clutch Average CEWL")
```
##CEWL vs Ambient Temp
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_ambienttemp_avg, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average Ambient Temp", y = "Clutch Average CEWL")
```
##CEWL vs Ambient Humidity
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_ambienthumidity_avg, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average Ambient Temp", y = "Clutch Average CEWL")
```
##CEWL vs Mother CEWL
Measurement taken on same day 
###DAB and PS
```{r}
  ggplot(data = neonate_analysis_df, aes(x = mothers_cewl, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Mother's CEWL", y = "Clutch Average CEWL")
```
###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = mothers_cewl, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Mother's CEWL", y = "Clutch Average CEWL")
```
###Only PS
```{r}
neonate_analysis_df %>%
  filter(Shed == "Y") %>%
  ggplot(aes(x = mothers_cewl, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Mother's CEWL", y = "Clutch Average CEWL")
```
##CEWL vs If Shed
```{r}
ggplot(data = neonate_analysis_df, aes(x = Shed, y = clutch_CEWL_avg, colour = Treatment)) +
  theme_classic() +
  geom_boxplot() +
  geom_point() +
  labs(x = "Post Shed Measurement", y = "Clutch Average CEWL")
```
##CEWL vs SMI
###DAB and PS
```{r}
  ggplot(data = neonate_analysis_df, aes(x = clutch_SMI_avg, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average SMI", y = "Clutch Average CEWL")
```

###Only DAB
```{r}
neonate_analysis_df %>%
  filter(Shed == "N") %>%
  ggplot(aes(x = clutch_SMI_avg, y = clutch_CEWL_avg, colour = Treatment)) +
  geom_point() +
  theme_classic() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(x = "Clutch Average SMI", y = "Clutch Average CEWL")
```

#Correlation Plot
Making a correlation plot to see which numerical variables are related to one another in this data set. First, selecting out all of the numerical variables since correlation plots are based on numerical variables only.

```{r}
summary(neonate_analysis_df)

correl_df <- neonate_analysis_df %>%
  mutate(Mother_ID = as.numeric(Mother_ID)) %>%
  ungroup() %>%
  dplyr::select(Mother_ID, clutch_osmol_avg, clutch_CEWL_avg, Prop_Pee, clutch_bodytemp_avg, clutch_ambienttemp_avg, clutch_ambienthumidity_avg, clutch_SMI_avg, clutch_Mass_avg, clutch_SVL_avg, mothers_osmol, mothers_cewl, days_mom_in_tmt)
```

Making the correlation chart
```{r}
chart.Correlation(correl_df, histogram=TRUE, pch=19)
```
#CEWL Model

##Categorical Variable Relationships
First, I have to find which categorical variables are related to CEWL. We only have treatment and shed.
```{r}
summary(neonate_analysis_df)

summary(lm(clutch_CEWL_avg ~ Treatment, data = neonate_analysis_df))
#not correlated, but I will still include in the model because this is what we are interested in. 

summary(lm(clutch_CEWL_avg ~ Shed, data = neonate_analysis_df))

summary(lm(clutch_CEWL_avg ~ clutch_SVL_avg, data = neonate_analysis_df))
summary(lm(clutch_CEWL_avg ~ clutch_Mass_avg, data = neonate_analysis_df))
summary(lm(clutch_CEWL_avg ~ clutch_SMI_avg, data = neonate_analysis_df))
#Very significant 
```
##Numerical Variable Relationships
Based on the correlation plot, the numerical variables that I will include in the CEWL model are body temp, osmolarity, smi, mass, svl. The categorical variables that I will include are both treatment and shed. I will also include relevant interactions that I think may be occurring. 

##Initial Models
```{r}
Neonates_CEWL_LMM_1 <- lm(data = neonate_analysis_df,
                      clutch_CEWL_avg ~
                        Treatment * 
                        clutch_osmol_avg +
                        Shed +
                        clutch_bodytemp_avg +
                        clutch_SMI_avg +
                        clutch_ambienthumidity_avg +
                        clutch_ambienttemp_avg +
                        mothers_cewl)
                        

summary(Neonates_CEWL_LMM_1)
#Lower t values are less significant
drop1(Neonates_CEWL_LMM_1)
Anova(Neonates_CEWL_LMM_1)
```
Lower AIC is better. So the row "AIC" shows what the AIC would be if that variable was dropped from the model. So, if a variable is outside of the +/- 2 range and the value would be lower if dropped, then it should be taken out of the model. When looking at the AIC, you want to drop the lowest AIC's that are outside of the +/- 2 range from the "none" dropped AIC. Then, rerun the model and do it again to see if any others should be dropped after dropping that one. Continue process until no more can be dropped or until no more are outside of the +/- 2 range. Once none are outside of that range, you create two models that are equivalent in their predicitive power. One is just simpler than the other one. 

I will be dropping variables from the model according to the AIC scores of drop 1. I will continue making models and dropping until I reach the null model. Then I will compare models with model selection for the snakes that did give birth. 

Based on model 1, the first variable that should be dropped is ambient temperature. 
```{r}
Neonates_CEWL_LMM_2 <- lm(data = neonate_analysis_df,
                      clutch_CEWL_avg ~
                        Treatment * 
                        clutch_osmol_avg +
                        Shed +
                        clutch_bodytemp_avg +
                        clutch_SMI_avg +
                        clutch_ambienthumidity_avg +
                        mothers_cewl)
                        

summary(Neonates_CEWL_LMM_2)
#Lower t values are less significant
drop1(Neonates_CEWL_LMM_2)
Anova(Neonates_CEWL_LMM_2)
```
Next to be dropped in humidity 
```{r}
Neonates_CEWL_LMM_3 <- lm(data = neonate_analysis_df,
                      clutch_CEWL_avg ~
                        Treatment * 
                        clutch_osmol_avg +
                        Shed +
                        clutch_bodytemp_avg +
                        clutch_SMI_avg +
                        mothers_cewl)
                        

summary(Neonates_CEWL_LMM_3)
#Lower t values are less significant
drop1(Neonates_CEWL_LMM_3)
Anova(Neonates_CEWL_LMM_3)
```
Next to be dropped is body temp 
```{r}
Neonates_CEWL_LMM_4 <- lm(data = neonate_analysis_df,
                      clutch_CEWL_avg ~
                        Treatment * 
                        clutch_osmol_avg +
                        Shed +
                        clutch_SMI_avg +
                        mothers_cewl)
                        

summary(Neonates_CEWL_LMM_4)
#Lower t values are less significant
drop1(Neonates_CEWL_LMM_4)
Anova(Neonates_CEWL_LMM_4)
```
Next variable to drop is SMI
```{r}
Neonates_CEWL_LMM_5 <- lm(data = neonate_analysis_df,
                      clutch_CEWL_avg ~
                        Treatment * 
                        clutch_osmol_avg +
                        Shed +
                        mothers_cewl)
                        

summary(Neonates_CEWL_LMM_5)
#Lower t values are less significant
drop1(Neonates_CEWL_LMM_5)
Anova(Neonates_CEWL_LMM_5)
```
Next variable to drop is the interaction 
Next variable to drop is SMI
```{r}
Neonates_CEWL_LMM_6 <- lm(data = neonate_analysis_df,
                      clutch_CEWL_avg ~
                        Treatment +
                        clutch_osmol_avg +
                        Shed +
                        mothers_cewl)
                        

summary(Neonates_CEWL_LMM_6)
#Lower t values are less significant
drop1(Neonates_CEWL_LMM_6)
Anova(Neonates_CEWL_LMM_6)
```
Next variable to drop is treatment
```{r}
Neonates_CEWL_LMM_7 <- lm(data = neonate_analysis_df,
                      clutch_CEWL_avg ~
                        clutch_osmol_avg +
                        Shed +
                        mothers_cewl)
                        

summary(Neonates_CEWL_LMM_7)
#Lower t values are less significant
drop1(Neonates_CEWL_LMM_7)
Anova(Neonates_CEWL_LMM_7)
car::vif(Neonates_CEWL_LMM_7)
```
Next variable to drop is shed :/
```{r}
Neonates_CEWL_LMM_8 <- lm(data = neonate_analysis_df,
                      clutch_CEWL_avg ~
                        clutch_osmol_avg +
                        mothers_cewl)
                        

summary(Neonates_CEWL_LMM_8)
#Lower t values are less significant
drop1(Neonates_CEWL_LMM_8)
Anova(Neonates_CEWL_LMM_8)
```
next is mothers cewl
```{r}
Neonates_CEWL_LMM_9 <- lm(data = neonate_analysis_df,
                      clutch_CEWL_avg ~
                        clutch_osmol_avg)
                        

summary(Neonates_CEWL_LMM_9)
#Lower t values are less significant
drop1(Neonates_CEWL_LMM_9)
Anova(Neonates_CEWL_LMM_9)
```

null
```{r}
Neonates_CEWL_LMM_null <- lm(data = neonate_analysis_df,
                      clutch_CEWL_avg ~ 1)
                        

summary(Neonates_CEWL_LMM_null)
#Lower t values are less significant
drop1(Neonates_CEWL_LMM_null)
Anova(Neonates_CEWL_LMM_null)
```

##Model Selection
```{r CEWL mod compare}
cewl_models <- list(Neonates_CEWL_LMM_1, Neonates_CEWL_LMM_2, Neonates_CEWL_LMM_3, Neonates_CEWL_LMM_4, Neonates_CEWL_LMM_5, Neonates_CEWL_LMM_6, Neonates_CEWL_LMM_7, Neonates_CEWL_LMM_8, Neonates_CEWL_LMM_9, Neonates_CEWL_LMM_null)

#specify model names
cewl_mod_names <- c('model1', 
                    'model2', 
                    'model3',
                    'model4',
                    'model5',
                    'model6',
                    'model7',
                    'model8',
                    'model9',
                    'modelnull')

#calculate AIC of each model
cewl_AICc <- data.frame(aictab(cand.set = cewl_models, 
                                 modnames = cewl_mod_names))
cewl_AICc
```
The best models for predicting CEWL in the neonates was 7 and 8. 
#CEWL Final Models

Best model
```{r}
Neonates_CEWL_Final_Model <- lm(data = neonate_analysis_df,
                      clutch_CEWL_avg ~
                        clutch_osmol_avg +
                        Shed +
                        mothers_cewl)
                        

summary(Neonates_CEWL_Final_Model)

Neonates_CEWL_SecondBest_Model <- lm(data = neonate_analysis_df,
                      clutch_CEWL_avg ~
                        clutch_osmol_avg +
                        mothers_cewl)
                        

summary(Neonates_CEWL_SecondBest_Model)
```
##Linear Model Assumptions
```{r model assumptions}
car::vif(Neonates_CEWL_Final_Model)
plot(Neonates_CEWL_Final_Model)
plot(residuals(Neonates_CEWL_Final_Model))
shapiro.test(residuals(Neonates_CEWL_Final_Model))
#doesn't deviate from normality 

car::vif(Neonates_CEWL_SecondBest_Model)
plot(Neonates_CEWL_SecondBest_Model)
plot(residuals(Neonates_CEWL_SecondBest_Model))
shapiro.test(residuals(Neonates_CEWL_SecondBest_Model))
```


#Osmolarity Model
```{r}
Neonates_Osmol_LMM_1 <- lm(data = neonate_analysis_df,
                      clutch_osmol_avg ~
                        Treatment *
                        (Prop_Pee + mothers_osmol + days_mom_in_tmt) +
                        clutch_CEWL_avg +
                        clutch_bodytemp_avg +
                        clutch_SMI_avg +
                        Shed)
                        

summary(Neonates_Osmol_LMM_1)
#Lower t values are less significant
drop1(Neonates_Osmol_LMM_1)
Anova(Neonates_Osmol_LMM_1)
```
Should first drop the interaction between treatment and days mom in tmt

```{r}
Neonates_Osmol_LMM_2 <- lm(data = neonate_analysis_df,
                      clutch_osmol_avg ~
                        Treatment *
                        (Prop_Pee + mothers_osmol) +
                        clutch_CEWL_avg +
                        clutch_bodytemp_avg +
                        clutch_SMI_avg +
                        days_mom_in_tmt +
                        Shed)
                        

summary(Neonates_Osmol_LMM_2)
#Lower t values are less significant
drop1(Neonates_Osmol_LMM_2)
Anova(Neonates_Osmol_LMM_2)
```
Now will drop body temperature 
```{r}
Neonates_Osmol_LMM_3 <- lm(data = neonate_analysis_df,
                      clutch_osmol_avg ~
                        Treatment *
                        (Prop_Pee + mothers_osmol) +
                        clutch_CEWL_avg +
                        clutch_SMI_avg +
                        days_mom_in_tmt +
                        Shed)
                        

summary(Neonates_Osmol_LMM_3)
#Lower t values are less significant
drop1(Neonates_Osmol_LMM_3)
Anova(Neonates_Osmol_LMM_3)
```
Now will drop days mom in tmt
```{r}
Neonates_Osmol_LMM_4 <- lm(data = neonate_analysis_df,
                      clutch_osmol_avg ~
                        Treatment *
                        (Prop_Pee + mothers_osmol) +
                        clutch_CEWL_avg +
                        clutch_SMI_avg +
                        Shed)
                        

summary(Neonates_Osmol_LMM_4)
#Lower t values are less significant
drop1(Neonates_Osmol_LMM_4)
Anova(Neonates_Osmol_LMM_4)
```
Now will drop shed 
Now will drop days mom in tmt
```{r}
Neonates_Osmol_LMM_5 <- lm(data = neonate_analysis_df,
                      clutch_osmol_avg ~
                        Treatment *
                        (Prop_Pee + mothers_osmol) +
                        clutch_CEWL_avg +
                        clutch_SMI_avg)
                        

summary(Neonates_Osmol_LMM_5)
#Lower t values are less significant
drop1(Neonates_Osmol_LMM_5)
Anova(Neonates_Osmol_LMM_5)
```
Now will drop the interaction between mothers osmol and treatment 
```{r}
Neonates_Osmol_LMM_6 <- lm(data = neonate_analysis_df,
                      clutch_osmol_avg ~
                        Treatment *
                        Prop_Pee +
                        clutch_CEWL_avg +
                        clutch_SMI_avg +
                        mothers_osmol)
                        

summary(Neonates_Osmol_LMM_6)
#Lower t values are less significant
drop1(Neonates_Osmol_LMM_6)
Anova(Neonates_Osmol_LMM_6)
```
Now will drop the interaction between treatment and prop pee
```{r}
Neonates_Osmol_LMM_7 <- lm(data = neonate_analysis_df,
                      clutch_osmol_avg ~
                        Treatment +
                        Prop_Pee +
                        clutch_CEWL_avg +
                        clutch_SMI_avg +
                        mothers_osmol)
                        

summary(Neonates_Osmol_LMM_7)
#Lower t values are less significant
drop1(Neonates_Osmol_LMM_7)
Anova(Neonates_Osmol_LMM_7)
```
Now will drop prop pee
```{r}
Neonates_Osmol_LMM_8 <- lm(data = neonate_analysis_df,
                      clutch_osmol_avg ~
                        Treatment +
                        clutch_CEWL_avg +
                        clutch_SMI_avg +
                        mothers_osmol)
                        

summary(Neonates_Osmol_LMM_8)
#Lower t values are less significant
drop1(Neonates_Osmol_LMM_8)
Anova(Neonates_Osmol_LMM_8)
```
Now will drop treatment :/
```{r}
Neonates_Osmol_LMM_9 <- lm(data = neonate_analysis_df,
                      clutch_osmol_avg ~
                        clutch_CEWL_avg +
                        clutch_SMI_avg +
                        mothers_osmol)
                        

summary(Neonates_Osmol_LMM_9)
#Lower t values are less significant
drop1(Neonates_Osmol_LMM_9)
Anova(Neonates_Osmol_LMM_9)
car::vif(Neonates_Osmol_LMM_9)
```
Now will drop smi
```{r}
Neonates_Osmol_LMM_10 <- lm(data = neonate_analysis_df,
                      clutch_osmol_avg ~
                        clutch_CEWL_avg +
                        mothers_osmol)
                        

summary(Neonates_Osmol_LMM_10)
#Lower t values are less significant
drop1(Neonates_Osmol_LMM_10)
Anova(Neonates_Osmol_LMM_10)
```
Now will drop mother osmol
```{r}
Neonates_Osmol_LMM_11 <- lm(data = neonate_analysis_df,
                      clutch_osmol_avg ~
                        clutch_CEWL_avg)
                        

summary(Neonates_Osmol_LMM_11)
#Lower t values are less significant
drop1(Neonates_Osmol_LMM_11)
Anova(Neonates_Osmol_LMM_11)
```
null
```{r}
Neonates_Osmol_LMM_null <- lm(data = neonate_analysis_df,
                      clutch_osmol_avg ~ 1)
                        

summary(Neonates_Osmol_LMM_null)
#Lower t values are less significant
drop1(Neonates_Osmol_LMM_null)
Anova(Neonates_Osmol_LMM_null)
```

##Model Selection
```{r CEWL mod compare}
osmol_models <- list(Neonates_Osmol_LMM_1, Neonates_Osmol_LMM_2, Neonates_Osmol_LMM_3, Neonates_Osmol_LMM_4, Neonates_Osmol_LMM_5, Neonates_Osmol_LMM_6, Neonates_Osmol_LMM_7, Neonates_Osmol_LMM_8, Neonates_Osmol_LMM_9, Neonates_Osmol_LMM_10, Neonates_Osmol_LMM_11, Neonates_Osmol_LMM_null)

#specify model names
osmol_mod_names <- c('model1', 
                    'model2', 
                    'model3',
                    'model4',
                    'model5',
                    'model6',
                    'model7',
                    'model8',
                    'model9',
                    'model10',
                    'model11',
                    'modelnull')

#calculate AIC of each model
osmol_AICc <- data.frame(aictab(cand.set = osmol_models, 
                                 modnames = osmol_mod_names))
osmol_AICc
```




#x
#x
#x


Now I will redo the analysis and plots above with the neonates as replicates for the mothers and only one value per mother. 

##Osmolarity

###Figure: Osmolarity by treatment group; pvalue
```{r}
ggplot(data = clutch_averages) +
  geom_boxplot(aes(x = Treatment, y = clutch_osmol_avg), fill = "lightblue", color = "black", outlier.fill = "lightgreen", outlier.colour = "black", outlier.shape = 21, outlier.size = 2) +
  labs(title = "Plasma Osmolality of Neonates Day After Birth",
       subtitle = "by Treatment Group with Neonates as Replicates", 
       x = "Hydration Treatment",
       y = "Osmolality (mmol/kg)") +
  stat_summary(aes(x = Treatment, y = clutch_osmol_avg), fun = "mean", color= "red", shape = 16) +
  scale_y_continuous(limits = c(260, 380),
                     breaks = seq(from = 260, to = 3650, by = 30)) +
  annotate("text", x=1.5, y=370, label= "p = 0.03726")
```

###Linear Model
```{r}
neonate_dab_osmol_lm <- lm(clutch_osmol_avg ~ Treatment, data = clutch_averages)
summary(neonate_dab_osmol_lm)
```
p = 0.03726 ; significant difference 

##CEWL

###Figure: CEWL by treatment group; pvalue
```{r}
ggplot(data = clutch_averages) +
  geom_boxplot(aes(x = Treatment, y = clutch_CEWL_avg), fill = "lightblue", color = "black", outlier.fill = "lightgreen", outlier.colour = "black", outlier.shape = 21, outlier.size = 2) +
  labs(title = "CEWL of Neonates Day After Birth",
       subtitle = "by Treatment Group with Neonates as Replicates", 
       x = "Hydration Treatment",
       y = "CEWL") +
  stat_summary(aes(x = Treatment, y = clutch_CEWL_avg), fun = "mean", color= "red", shape = 16) +
  scale_y_continuous(limits = c(4, 18),
                     breaks = seq(from = 4, to = 18, by = 3)) +
  annotate("text", x=1.5, y=17.5, label= "p = 0.2192")
```

###Linear Model
```{r}
neonate_cewl_osmol_lm <- lm(clutch_CEWL_avg ~ Treatment, data = clutch_averages)
summary(neonate_cewl_osmol_lm)
```
p = 0.2192 ; not significantly different 

##Pee

###Proportions
Getting the proportion of neonates that did bee in a clutch.
```{r}
pee_proportions <- data.frame(prop.table(table(neonate_dab_all_final$Mother_ID, neonate_dab_all_final$Pee))) %>%
dplyr::select(Indiv_ID = Var1, Pee = Var2, Freq = Freq)
  
trmts <- neonate_dab_all_final[ , c(8, 9)]

pee_proportions <- unique(left_join(pee_proportions, trmts, by = c("Indiv_ID" = "Mother_ID")))

table(clutch_averages$Treatment, clutch_averages$Prop_Pee)
```

###Figure: Frequency of neonates that peed by treatment
```{r}
ggplot(data = pee_proportions) +
  geom_boxplot(aes(x = Pee, y = Freq, fill = Treatment)) +
  facet_wrap(~Treatment) +
  stat_compare_means(method = "pair", aes(x = Pee, y = Freq)) +
  theme_classic() +
  scale_y_continuous(limits = c(0, 0.065))
```

###Figure: Proportion of neonates in a clutch that peed by treatment
```{r}
ggplot(clutch_averages, aes(x = Treatment, y = Prop_Pee, fill = Treatment)) +
  geom_boxplot() +
  theme(axis.ticks.x = element_blank(),
        axis.text.x = element_blank()) +
  labs(x = "Treatment",
       y = "Proportion of neonates in a clutch that did 'pee'") +
  stat_summary(fun = "mean")
```















